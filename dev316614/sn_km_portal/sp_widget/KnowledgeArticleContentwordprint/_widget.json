{
    "instance": {
        "name": "dev316614",
        "url": "https://dev316614.service-now.com",
        "g_ck": "1c233b06c32132106b68770d0501311ce80a454ffac28b2ee2d7b2555bbb7bbb97e3dc78"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "Knowledge Article Content (word/print)",
    "sys_id": "e571ec5e9793d510bcbbbbc3f153af9d",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div class=\"kb-article-wrapper\">\n  <div ng-if=\"data.versionWarningMessage && c.options.show_version_info != 'false'\" class=\"alert alert-info alert-dismissible\" role=\"alert\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n    <div ng-bind-html=\"data.versionWarningMessage\">\n    </div>\n  </div>\n\t<div ng-if=\"c.data.replacementArticleId\" class=\"alert alert-info alert-dismissible\" role=\"alert\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n    <div ng-bind-html=\"c.data.replacementAlert\">\n    </div>\n  </div>\n  <div ng-if=\"::data.isValid\" ng-class=\"{'kb-mobile' : c.isMobile, 'panel panel-default kb-desktop' : !c.isMobile, 'mesp-ui' : c.data.isMESP}\">\n    <div class=\"kb-panel-heading\" ng-class=\"{'panel-heading' : !c.isMobile}\">\n      <span ng-class=\"{'panel-title' : !c.isMobile}\">\n        <div class=\"row\">\n          <span class=\"col-md-5 kb-panel-title-header\"> \n            <div class=\"kb-number-info\">\n              <span>{{data.number}}</span>\n              <span ng-if=\"data.isKBAdmin && data.isArticleExpired\">${(Expired)}</span>\n              <span ng-if=\"!c.isMobile && data.showHistory && c.options.show_version_info != 'false'\"> - \n                <div class=\"dropdown inline\" role=\"list\">\n                  <button id=\"kbVersionButton\" aria-expanded=\"{{!c.showVersions}}\" class=\"btn btn-default kb-version dropdown-toggle kb-dropdown-button transparent-button\" data-toggle=\"dropdown\" ng-click=\"c.toggleVersions()\" aria-label=\"{{data.versionInfoLabel}}\"> {{data.versionInfo}}\n                    <i class=\"fa fa-chevron-down\" aria-hidden=\"true\"></i>\n                  </button>\n              <span ng-if=\"!c.isMobile && data.workflowState\">{{data.workflowState}}</span>\n                  \n                  <ul id=\"kbVersionMenuList\" class=\"dropdown-menu dropdown-menu-left version-menu-list\">\n                    <li class=\"kb-version\" ng-repeat=\"version in data.versionList\">\n                      <a ng-if=\"!version.isCurrent && data.viewAsUser.length == 0\" href=\"?id=kb_article_view&sys_kb_id={{version.sysId}}\" \n                         aria-label=\"${{{version.versionLabel}} - {{version.versionText}}}\">{{version.versionNumber}} - {{version.versionText}}</a>\n                      <a ng-if=\"!version.isCurrent && data.viewAsUser.length > 0\" href=\"?id=kb_article_view&sys_kb_id={{version.sysId}}&view_as_user={{data.viewAsUser}}\" \n                         aria-label=\"${{{version.versionLabel}} - {{version.versionText}}}\">{{version.versionNumber}} - {{version.versionText}}</a>\n                      <span ng-if=\"version.isCurrent\"><b>{{version.versionNumber}} - {{version.versionText}}</b></span>\n                    </li>\n                  </ul>\n                </div>\n\t\t\t  </span>\n            </div>            \n          </span>\n            \n          <div ng-if=\"!c.isMobile && !$root.hideFeedbackOptions && c.options.hide_all_actions != 'true'\" class=\"col-md-7 kb-end-buttons\">\n            <div class=\"dropdown kb-end-buttons\">\n              <span class=\"pull-left\">\n                <sp-widget widget=\"data.favoriteWidget\"></sp-widget>\n              </span>\n              <span class=\"hidden-sm hidden-xs\" ng-if=\"!data.externalArticle\">\n                <button ng-mouseover=\"c.handleSubscribeButtonFocus()\"\n                   ng-if=\"data.properties.isSubscriptionEnabled\"\n                   ng-mouseleave=\"c.handleSubscribeButtonBlur()\"\n                   ng-focus=\"c.handleSubscribeButtonFocus()\"\n                   ng-blur=\"c.handleSubscribeButtonBlur()\"\n                   class=\"btn btn-default kb-subscribe kb-sub-icon apply-brand-color\" ng-click=\"c.handleSubscription()\">\n                    {{data.subscribeLabel}}\n                </button>\n              </span>\n              <button ng-if=\"c.showAttachArticle()\" class=\"btn btn-default\" type=\"button\" ng-click=\"c.attachToTask()\" aria-label=\"{{::data.messages.ATTACH_TO_TASK_LABEL}}\">{{::data.messages.ATTACH_TO_TASK_LABEL}}</button>\n              <button id=\"actionMenuLabel\" ng-if=\"c.showActionMenu() && !$root.readOnly\" \n                      class=\"btn btn-default dropdown-toggle kb-dropdown-button more-actions-menu apply-brand-color\" type=\"button\" data-toggle=\"dropdown\" aria-label=\"{{::data.messages.ACTION_MENU}}\">\n                {{::data.messages.ACTION_MENU_LABEL}}\n                <i class=\"fa fa-chevron-down\" aria-hidden=\"true\"></i>\n              </button>\n              <ul id=\"kbActionMenuList\" class=\"dropdown-menu dropdown-menu-right moreActionsMenuList\">\n                <li class=\"kb-menu-entry hidden-md hidden-lg visible-sm visible-xs\" ng-if=\"data.properties.isSubscriptionEnabled && !data.externalArticle\">\n                  <a ng-mouseover=\"c.handleSubscribeButtonFocus()\"\n                     ng-if=\"data.properties.isSubscriptionEnabled && c.options.hide_subscription != 'true'\"\n                     ng-mouseleave=\"c.handleSubscribeButtonBlur()\"\n                     ng-focus=\"c.handleSubscribeButtonFocus()\"\n                     ng-blur=\"c.handleSubscribeButtonBlur()\"\n                     href=\"javascript&colon;void(6)\"\n                     ng-click=\"c.handleSubscription()\">\n                    <span  class=\"kb-sub-icon\" aria-label=\"{{data.subscribeLabel}}\">\n                      {{data.subscribeLabel}}\n                    </span>\n                  </a>\n                </li>\n                <li class=\"kb-menu-entry\" ng-if=\"c.showFlagArticle\"><a id=\"flagArticleButton\" href=\"javascript&colon;void(1)\" data-toggle=\"modal\" ng-click=\"c.launchFlagModal($event)\">{{data.messages.FLAG_ARTICLE}}</a></li>\n                <li class=\"kb-menu-entry\" ng-if=\"c.showCreateIncident\"><a target=\"_blank\" href=\"{{c.createIncidentURL}}\">{{c.createIncidentLabel}}</a></li>\n                <li class=\"kb-menu-entry\" ng-if=\"data.properties.isEditable\" ><a target=\"_blank\" href=\"{{c.editUrl}}\">{{data.messages.EDIT}}</a></li>\n\t\t\t\t\t\t\t\t<li class=\"kb-menu-entry\" ng-if=\"data.kbDocSysId\"><a target=\"_blank\" href=\"sys_attachment.do?sys_id={{data.kbDocSysId}}\">{{data.messages.DOWNLOAD_DOCUMENT}}</a></li>\n                <li class=\"kb-menu-entry\"><a ng-click=\"c.printArticle('myPrint')\">Print</a></li>\n              </ul>\n            </div>\n            <!-- Flag article modal -->\n          </div>\n        </div>\n      </span>\n    </div>\n    <div id=\"myPrint\">\n    <div class=\"kb-wrapper\" ng-class=\"c.isMobile ? 'kb-mobile' : 'panel-body kb-desktop'\">\n      <h1 class=\"widget-header kb-title-header\">{{::data.shortDesc}}</h1>\n      <div class=\"kb-language-block pad-right text-nowrap\" ng-if=\"data.langList.length > 1\" ng-cloak>\n        <div class=\"kb-language\">\n          <div class=\"dropdown\">\n            <button class=\"dropdown-toggle transparent-button trim-padding-right kb-lang-dropdown-btn\" aria-label=\"${Language: {{c.selectedLanguage.label}}}. Select to choose other available languages to view this article.\" aria-haspopup=\"true\" data-toggle=\"dropdown\">\n              <span class=\"lang-icon\" aria-hidden=\"true\"><i class=\"fa fa-globe\"></i></span>\n              <span class=\"lang-data\" ng-class=\"{'hidden-xs':!c.isMobile}\">${{{c.selectedLanguage.label}}}</span>\n            </button>\n            <ul class=\"dropdown-menu dd-right-menu\" role=\"list\">\n              <li ng-repeat=\"item in data.langList\" role=\"listitem\">\n                 <a ng-click=\"c.selectLanguage($index)\">${{{item.label}}}</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n      <div class=\"title-secondary-data\">\n        <span ng-if=\"!c.isMobile\" class=\"sr-only\">Article metadata.</span>\n        <span ng-if=\"data.revisionString\" class=\"author pad-right text-nowrap\">\n          <span ng-if=\"!c.isMobile && data.langList.length > 1\" class=\"pad-right\" aria-hidden=\"true\">&#8226;</span>\n          <i class=\"fa fa-user pad-right\" aria-hidden=\"true\"/>\n          {{data.revisionString}}\n        </span>\n        <span ng-if=\"!c.isMobile && data.externalArticle\" class=\"pad-right text-nowrap\">\n          {{data.messages.EXTERNAL_CONTENT}}\n        </span>\n        <br class=\"visible-xs\" aria-hidden=\"true\"/>\n        <div class=\"published published-date pad-right text-nowrap\">\n          <span class=\"sr-only\">This article was updated</span>\n          <span class=\"pad-right hidden-xs\" ng-if=\"!c.isMobile\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-calendar pad-right\" aria-hidden=\"true\"/>\n          <sn-time-ago timestamp=\"data.sys_updated_on\"/>\n        </div>\n        <span ng-if=\"data.viewCount == 1\" class=\"views pad-right text-nowrap\">\n          <span class=\"sr-only\">This article has {{::data.viewCount}} view.</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-eye pad-right\" aria-hidden=\"true\"/>\n          <span aria-hidden=\"true\">${{{::data.viewCount}} View}</span>\n        </span>\n        <span ng-if=\"data.viewCount > 1\" class=\"views pad-right text-nowrap\">\n          <span class=\"sr-only\">This article has {{::data.viewCount}} views.</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-eye pad-right\" aria-hidden=\"true\"/>\n          <span aria-hidden=\"true\">${{{::data.viewCount}} Views}</span>\n        </span>\n        <span class=\"text-nowrap str-rating\" ng-if=\"data.properties.showKBStarRating && data.properties.showKBRatingOptions && data.avgRating >= 0\">\n          <span class=\"sr-only\">${This article has average rating: {{::data.avgRating}} out of 5 stars}</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> \n          <span class=\"kb-rating-stars\" ng-if=\"::c.KBRatingStyle\" aria-hidden=\"true\">\n            <uib-rating sp-rating ng-model=\"::data.avgRating\" max=\"5\" aria-label=\"{{::data.messages.ARTICLE_RATING}}\" readonly=\"true\"/>\n          </span>\n          <span class=\"sp-stars\" ng-if=\"!c.KBRatingStyle\" aria-hidden=\"true\">\n            <span uib-rating sp-rating ng-model=\"::data.avgRating\" max=\"5\" readonly=\"true\" aria-label=\"{{::data.messages.ARTICLE_RATING}}\" state-on=\"'fa fa-star kb-star-on'\" state-off=\"'fa fa-star kb-star-off'\" />\n        </span>\n      </span>&nbsp\n        <span ng-if=\"data.viewCount > 1\" class=\"views pad-right text-nowrap\">\n          <span aria-hidden=\"true\">Word Count: {{c.data.wordCount}}</span>\n        </span>\n      </div>\n      <div class=\"row community-attribution\" ng-if=\"!c.isMobile && data.hInfo\">\n        <div class=\"contributor pad-right\" ng-if=\"data.hInfo.contributor && data.hInfo.contributor.userId\">\n          <i class=\"fa fa-globe\" aria-hidden=\"true\"></i>\n          <span class=\"pad-lr pad-right\" ng-bind-html=\"data.hInfo.profileMessage\"></span>\n          <span class=\"discussion-published pad-right pre-bullet-icon text-nowrap\" ng-if=\"data.hInfo.postedOn\">\n            ${Posted}<sn-day-ago date=\"data.hInfo.postedOn\"/>\n          </span>\n          <span class=\"discussion-link pad-right pre-bullet-icon text-nowrap\" ng-if=\"data.hInfo.title\">\n            <a href=\"?id=community_question&sys_id={{data.hInfo.sourceRoot}}\" target=\"_blank_cm1\">${Link to Discussion}</a>\n          </span>\n        </div>\n      </div>\n      <div ng-if=\"c.isMobile && !c.isAgentApp\" class=\"kb-favorite\" ng-click=\"toggleFavorite($event)\">\n              <sp-widget widget=\"data.favoriteWidget\"></sp-widget>\n              <span ng-if = \"showFavorite\">\n                <span class=\"favorite-text\" ng-if=\"isFavorite === true\">${Favorited}</span>\n                <span class=\"favorite-text\" ng-if=\"isFavorite === false\">${Favorite}</span>\n        \t  </span>\n      </div>\n   \n      <hr class=\"kb-header-line\" aria-hidden=\"true\"/>\n      <article class=\"kb-article-content\" ng-if=\"::data.articleType != 'wiki'\">\n        <section ng-if=\"::!c.data.kbContentData.isTemplate\" ng-bind-html=\"::c.data.kbContentData.data\" ng-class=\"{'word-addin-mobile' : c.data.wordOnlineUrl && c.data.wordOnlineUrl.length>0}\"/>\n        <section ng-if=\"::c.data.kbContentData.isTemplate\" ng-repeat=\"field in c.data.kbContentData.data track by $index\" ng-attr-style=\"{{field.field_style}}\">\n          <h3 ng-if=\"::!field.collapsible\" ng-attr-style=\"{{field.heading_style}}\">{{field.label}}</h3>\n          <header class=\"collapsible-title\" ng-if=\"::field.collapsible\">\n            <h3 ng-attr-style=\"{{::field.heading_style}}\">\n              <button aria-expanded=\"{{!field.collapsed}}\"\n                      aria-controls=\"{{::field.column}}\"\n                      class=\"transparent-button accordion-trigger\"\n                      ng-click=\"c.toggleSection(field)\">    \n                        {{field.label}}\n                        <i class=\"fa fa-chevron-up rotate\" ng-class=\"{'down': field.collapsed}\" aria-hidden=\"true\"/>\n              </button> \n             </h3>\n          </header>\n          <p id=\"{{::field.column}}\" ng-if=\"::field.type != 'html' && field.collapsed\" style=\"display:none;\">{{field.content}}</p>\n          <p id=\"{{::field.column}}\" ng-if=\"::field.type != 'html' && !field.collapsed\">{{field.content}}</p>\n          <section id=\"{{::field.column}}\" ng-if=\"::field.type == 'html' && field.collapsed\" style=\"display:none;\" ng-bind-html=\"::field.content\"/>\n          <section id=\"{{::field.column}}\" ng-if=\"::field.type == 'html' && !field.collapsed\" ng-bind-html=\"::field.content\"/>\n        </section>\n      </article>   \n      <article class=\"kb-article-content\" ng-if=\"::data.articleType == 'wiki'\" ng-bind-html=\"::data.kbWiki\"></article>\n      <hr class=\"kb-permalink-separator\" ng-if=\"::!c.isMobile\" aria-hidden=\"true\"/>\n      <p class=\"pull-right kb-permalink\" ng-if=\"::!c.isMobile\">\n        <button class=\"transparent-button\" ng-click=\"c.copyPermalink()\">{{::data.messages.COPY_PERMALINK}}</button>\n      </p>\n    </div>\n  </div>\n  <div ng-if=\"!data.isValid && !data.knowledgeExists\" class=\"col-sm-12 panel-danger\">\n    <div class=\"panel-heading\">{{data.messages.RECORD_NOT_FOUND}}</div>\n  </div>\n  <div ng-if=\"!data.isValid && data.knowledgeExists && !data.isArticleExpired\" class=\"col-sm-12 panel-warning\">\n    <div class=\"panel-heading kb-font-color-black\">{{data.messages.INSUFFICIENT_PREVILEGES}}</div>\n  </div>\n  <div ng-if=\"!data.isKBAdmin && data.isArticleExpired\" class=\"col-sm-12 panel-warning\">\n    <div class=\"panel-heading kb-font-color-black\">{{data.messages.ARTICLE_EXPIRED}}</div>\n  </div>\n</div>\n</div>\n<style>\n  #uiNotificationContainer{\n    top : 10px;\n  }\n  .kb-article-wrapper .kb-desktop .kb-panel-title-header{\n    padding-left: 25px;\n  }\n  .kb-article-wrapper .app-modal-window .modal-dialog {\n    margin-top: 110px;\n  }\n  .kb-article-wrapper .kb-mobile{\n    letter-spacing: .6px;\n  }\n  .kb-article-wrapper .kb-mobile .title-secondary-data{\n    word-spacing:1px;\n  }\n  .kb-article-wrapper .kb-mobile .author{\n    margin-bottom: 17px;\n  }\n  .kb-article-content dl {\n    margin-top: .2em;\n    margin-bottom: .5em;\n  }\n  .kb-article-content dd { \n    line-height: 1.5em;\n    margin-left: 2em;\n    margin-bottom: .1em;\n  }\n  @media only screen and (max-width :992px){\n    .kb-article-wrapper .kb-desktop{\n      margin-top:15px;\n    }\n    .kb-article-wrapper .kb-wrapper{\n      padding : 10px !important;\n    }\n    .kb-article-wrapper .kb-menu-entry{\n      padding-top: 2px;\n      padding-bottom: 2px;\n    }\n    .kb-article-wrapper .kb-version-info{\n      margin-top : 5px !important;\n    }\n    .kb-article-wrapper .kb-desktop .kb-number-info{\n      margin-top : 6px !important;\n      padding-left: 10px;\n    }\n    .kb-article-wrapper .kb-mobile .kb-panel-title-header{\n      padding-left: 16px;\n    }\n    .kb-article-wrapper .kb-desktop .kb-panel-title-header{\n      padding-left: 0px;\n    }\n  }\n  @media only screen and (max-width :768px){\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 25px !important;\n    }\n  }\n  @media only screen and (max-width: 750px) {\n    .kb-article-wrapper .kb-mobile .author{\n      margin-bottom: 0px;\n    }\n  }\n  @media only screen and (min-width: 992px) {\n    .kb-article-wrapper .app-modal-window .modal-dialog {\n      width: 750px;\n    }\n    .kb-article-wrapper .control-label{\n      float :right;\n    }\n    .kb-article-wrapper .left-col-padding{\n      padding-right : 30px !important;\n    }\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 5px !important;\n    }\n  }\n  @media only screen and (min-width:768px) and (max-width: 992px) {\n    .kb-article-wrapper .app-modal-window .modal-dialog {\n      width: 600px;\n    }\n    .kb-article-wrapper .control-label{\n      float :right;\n    }\n    .kb-article-wrapper .left-col-padding{\n      padding-right : 5px !important;\n    }\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 5px !important;\n    }\n  }\n  @media only screen and (max-width: 400px) {\n    .pad-right{\n      padding-right:0px !important;\n    }\n  }\n\n  @media only screen and (max-width: 376px) {\n    .kb-article-wrapper .kb-mobile{\n      letter-spacing: 0px;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data{\n      word-spacing:0px;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data .str-rating{\n      margin-top: 17px;\n      display: block;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data .str-rating .pad-right{\n      display: none;\n    }\n  }\n  /*Versions dropdown screen width adjustment*/\n  @media only screen and (min-width: 500px) {\n     .version-menu-list li,.version-menu-list{\n         font-size: 14px !important;\n         margin: auto;\n         min-width: 410px !important;\n    }\n     .version-menu-list li a,.version-menu-list li span{\n         display:block;\n         padding: 3px 10px !important;\n         white-space: normal !important;\n    }\n  }\n  @media only screen and (max-width: 500px) {\n     .version-menu-list li,.version-menu-list{\n         font-size: 14px !important;\n         margin: auto;\n         min-width: 200px !important;\n         width:100% !important;\n    }\n     .version-menu-list li a, .version-menu-list li span{\n         display:block;\n         padding: 3px 10px !important;\n         white-space: normal !important;\n    }\n  }\n</style>\n",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div class=\"kb-article-wrapper\">\n  <div ng-if=\"data.versionWarningMessage && c.options.show_version_info != 'false'\" class=\"alert alert-info alert-dismissible\" role=\"alert\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n    <div ng-bind-html=\"data.versionWarningMessage\">\n    </div>\n  </div>\n\t<div ng-if=\"c.data.replacementArticleId\" class=\"alert alert-info alert-dismissible\" role=\"alert\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n    <div ng-bind-html=\"c.data.replacementAlert\">\n    </div>\n  </div>\n  <div ng-if=\"::data.isValid\" ng-class=\"{'kb-mobile' : c.isMobile, 'panel panel-default kb-desktop' : !c.isMobile, 'mesp-ui' : c.data.isMESP}\">\n    <div class=\"kb-panel-heading\" ng-class=\"{'panel-heading' : !c.isMobile}\">\n      <span ng-class=\"{'panel-title' : !c.isMobile}\">\n        <div class=\"row\">\n          <span class=\"col-md-5 kb-panel-title-header\"> \n            <div class=\"kb-number-info\">\n              <span>{{data.number}}</span>\n              <span ng-if=\"data.isKBAdmin && data.isArticleExpired\">${(Expired)}</span>\n              <span ng-if=\"!c.isMobile && data.showHistory && c.options.show_version_info != 'false'\"> - \n                <div class=\"dropdown inline\" role=\"list\">\n                  <button id=\"kbVersionButton\" aria-expanded=\"{{!c.showVersions}}\" class=\"btn btn-default kb-version dropdown-toggle kb-dropdown-button transparent-button\" data-toggle=\"dropdown\" ng-click=\"c.toggleVersions()\" aria-label=\"{{data.versionInfoLabel}}\"> {{data.versionInfo}}\n                    <i class=\"fa fa-chevron-down\" aria-hidden=\"true\"></i>\n                  </button>\n              <span ng-if=\"!c.isMobile && data.workflowState\">{{data.workflowState}}</span>\n                  \n                  <ul id=\"kbVersionMenuList\" class=\"dropdown-menu dropdown-menu-left version-menu-list\">\n                    <li class=\"kb-version\" ng-repeat=\"version in data.versionList\">\n                      <a ng-if=\"!version.isCurrent && data.viewAsUser.length == 0\" href=\"?id=kb_article_view&sys_kb_id={{version.sysId}}\" \n                         aria-label=\"${{{version.versionLabel}} - {{version.versionText}}}\">{{version.versionNumber}} - {{version.versionText}}</a>\n                      <a ng-if=\"!version.isCurrent && data.viewAsUser.length > 0\" href=\"?id=kb_article_view&sys_kb_id={{version.sysId}}&view_as_user={{data.viewAsUser}}\" \n                         aria-label=\"${{{version.versionLabel}} - {{version.versionText}}}\">{{version.versionNumber}} - {{version.versionText}}</a>\n                      <span ng-if=\"version.isCurrent\"><b>{{version.versionNumber}} - {{version.versionText}}</b></span>\n                    </li>\n                  </ul>\n                </div>\n\t\t\t  </span>\n            </div>            \n          </span>\n            \n          <div ng-if=\"!c.isMobile && !$root.hideFeedbackOptions && c.options.hide_all_actions != 'true'\" class=\"col-md-7 kb-end-buttons\">\n            <div class=\"dropdown kb-end-buttons\">\n              <span class=\"pull-left\">\n                <sp-widget widget=\"data.favoriteWidget\"></sp-widget>\n              </span>\n              <span class=\"hidden-sm hidden-xs\" ng-if=\"!data.externalArticle\">\n                <button ng-mouseover=\"c.handleSubscribeButtonFocus()\"\n                   ng-if=\"data.properties.isSubscriptionEnabled\"\n                   ng-mouseleave=\"c.handleSubscribeButtonBlur()\"\n                   ng-focus=\"c.handleSubscribeButtonFocus()\"\n                   ng-blur=\"c.handleSubscribeButtonBlur()\"\n                   class=\"btn btn-default kb-subscribe kb-sub-icon apply-brand-color\" ng-click=\"c.handleSubscription()\">\n                    {{data.subscribeLabel}}\n                </button>\n              </span>\n              <button ng-if=\"c.showAttachArticle()\" class=\"btn btn-default\" type=\"button\" ng-click=\"c.attachToTask()\" aria-label=\"{{::data.messages.ATTACH_TO_TASK_LABEL}}\">{{::data.messages.ATTACH_TO_TASK_LABEL}}</button>\n              <button id=\"actionMenuLabel\" ng-if=\"c.showActionMenu() && !$root.readOnly\" \n                      class=\"btn btn-default dropdown-toggle kb-dropdown-button more-actions-menu apply-brand-color\" type=\"button\" data-toggle=\"dropdown\" aria-label=\"{{::data.messages.ACTION_MENU}}\">\n                {{::data.messages.ACTION_MENU_LABEL}}\n                <i class=\"fa fa-chevron-down\" aria-hidden=\"true\"></i>\n              </button>\n              <ul id=\"kbActionMenuList\" class=\"dropdown-menu dropdown-menu-right moreActionsMenuList\">\n                <li class=\"kb-menu-entry hidden-md hidden-lg visible-sm visible-xs\" ng-if=\"data.properties.isSubscriptionEnabled && !data.externalArticle\">\n                  <a ng-mouseover=\"c.handleSubscribeButtonFocus()\"\n                     ng-if=\"data.properties.isSubscriptionEnabled && c.options.hide_subscription != 'true'\"\n                     ng-mouseleave=\"c.handleSubscribeButtonBlur()\"\n                     ng-focus=\"c.handleSubscribeButtonFocus()\"\n                     ng-blur=\"c.handleSubscribeButtonBlur()\"\n                     href=\"javascript&colon;void(6)\"\n                     ng-click=\"c.handleSubscription()\">\n                    <span  class=\"kb-sub-icon\" aria-label=\"{{data.subscribeLabel}}\">\n                      {{data.subscribeLabel}}\n                    </span>\n                  </a>\n                </li>\n                <li class=\"kb-menu-entry\" ng-if=\"c.showFlagArticle\"><a id=\"flagArticleButton\" href=\"javascript&colon;void(1)\" data-toggle=\"modal\" ng-click=\"c.launchFlagModal($event)\">{{data.messages.FLAG_ARTICLE}}</a></li>\n                <li class=\"kb-menu-entry\" ng-if=\"c.showCreateIncident\"><a target=\"_blank\" href=\"{{c.createIncidentURL}}\">{{c.createIncidentLabel}}</a></li>\n                <li class=\"kb-menu-entry\" ng-if=\"data.properties.isEditable\" ><a target=\"_blank\" href=\"{{c.editUrl}}\">{{data.messages.EDIT}}</a></li>\n\t\t\t\t\t\t\t\t<li class=\"kb-menu-entry\" ng-if=\"data.kbDocSysId\"><a target=\"_blank\" href=\"sys_attachment.do?sys_id={{data.kbDocSysId}}\">{{data.messages.DOWNLOAD_DOCUMENT}}</a></li>\n                <li class=\"kb-menu-entry\"><a ng-click=\"c.printArticle('myPrint')\">Print</a></li>\n              </ul>\n            </div>\n            <!-- Flag article modal -->\n          </div>\n        </div>\n      </span>\n    </div>\n    <div id=\"myPrint\">\n    <div class=\"kb-wrapper\" ng-class=\"c.isMobile ? 'kb-mobile' : 'panel-body kb-desktop'\">\n      <h1 class=\"widget-header kb-title-header\">{{::data.shortDesc}}</h1>\n      <div class=\"kb-language-block pad-right text-nowrap\" ng-if=\"data.langList.length > 1\" ng-cloak>\n        <div class=\"kb-language\">\n          <div class=\"dropdown\">\n            <button class=\"dropdown-toggle transparent-button trim-padding-right kb-lang-dropdown-btn\" aria-label=\"${Language: {{c.selectedLanguage.label}}}. Select to choose other available languages to view this article.\" aria-haspopup=\"true\" data-toggle=\"dropdown\">\n              <span class=\"lang-icon\" aria-hidden=\"true\"><i class=\"fa fa-globe\"></i></span>\n              <span class=\"lang-data\" ng-class=\"{'hidden-xs':!c.isMobile}\">${{{c.selectedLanguage.label}}}</span>\n            </button>\n            <ul class=\"dropdown-menu dd-right-menu\" role=\"list\">\n              <li ng-repeat=\"item in data.langList\" role=\"listitem\">\n                 <a ng-click=\"c.selectLanguage($index)\">${{{item.label}}}</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n      <div class=\"title-secondary-data\">\n        <span ng-if=\"!c.isMobile\" class=\"sr-only\">Article metadata.</span>\n        <span ng-if=\"data.revisionString\" class=\"author pad-right text-nowrap\">\n          <span ng-if=\"!c.isMobile && data.langList.length > 1\" class=\"pad-right\" aria-hidden=\"true\">&#8226;</span>\n          <i class=\"fa fa-user pad-right\" aria-hidden=\"true\"/>\n          {{data.revisionString}}\n        </span>\n        <span ng-if=\"!c.isMobile && data.externalArticle\" class=\"pad-right text-nowrap\">\n          {{data.messages.EXTERNAL_CONTENT}}\n        </span>\n        <br class=\"visible-xs\" aria-hidden=\"true\"/>\n        <div class=\"published published-date pad-right text-nowrap\">\n          <span class=\"sr-only\">This article was updated</span>\n          <span class=\"pad-right hidden-xs\" ng-if=\"!c.isMobile\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-calendar pad-right\" aria-hidden=\"true\"/>\n          <sn-time-ago timestamp=\"data.sys_updated_on\"/>\n        </div>\n        <span ng-if=\"data.viewCount == 1\" class=\"views pad-right text-nowrap\">\n          <span class=\"sr-only\">This article has {{::data.viewCount}} view.</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-eye pad-right\" aria-hidden=\"true\"/>\n          <span aria-hidden=\"true\">${{{::data.viewCount}} View}</span>\n        </span>\n        <span ng-if=\"data.viewCount > 1\" class=\"views pad-right text-nowrap\">\n          <span class=\"sr-only\">This article has {{::data.viewCount}} views.</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> <i class=\"fa fa-eye pad-right\" aria-hidden=\"true\"/>\n          <span aria-hidden=\"true\">${{{::data.viewCount}} Views}</span>\n        </span>\n        <span class=\"text-nowrap str-rating\" ng-if=\"data.properties.showKBStarRating && data.properties.showKBRatingOptions && data.avgRating >= 0\">\n          <span class=\"sr-only\">${This article has average rating: {{::data.avgRating}} out of 5 stars}</span>\n          <span class=\"pad-right\" aria-hidden=\"true\">&#8226;</span> \n          <span class=\"kb-rating-stars\" ng-if=\"::c.KBRatingStyle\" aria-hidden=\"true\">\n            <uib-rating sp-rating ng-model=\"::data.avgRating\" max=\"5\" aria-label=\"{{::data.messages.ARTICLE_RATING}}\" readonly=\"true\"/>\n          </span>\n          <span class=\"sp-stars\" ng-if=\"!c.KBRatingStyle\" aria-hidden=\"true\">\n            <span uib-rating sp-rating ng-model=\"::data.avgRating\" max=\"5\" readonly=\"true\" aria-label=\"{{::data.messages.ARTICLE_RATING}}\" state-on=\"'fa fa-star kb-star-on'\" state-off=\"'fa fa-star kb-star-off'\" />\n        </span>\n      </span>&nbsp\n        <span ng-if=\"data.viewCount > 1\" class=\"views pad-right text-nowrap\">\n          <span aria-hidden=\"true\">Word Count: {{c.data.wordCount}}</span>\n        </span>\n      </div>\n      <div class=\"row community-attribution\" ng-if=\"!c.isMobile && data.hInfo\">\n        <div class=\"contributor pad-right\" ng-if=\"data.hInfo.contributor && data.hInfo.contributor.userId\">\n          <i class=\"fa fa-globe\" aria-hidden=\"true\"></i>\n          <span class=\"pad-lr pad-right\" ng-bind-html=\"data.hInfo.profileMessage\"></span>\n          <span class=\"discussion-published pad-right pre-bullet-icon text-nowrap\" ng-if=\"data.hInfo.postedOn\">\n            ${Posted}<sn-day-ago date=\"data.hInfo.postedOn\"/>\n          </span>\n          <span class=\"discussion-link pad-right pre-bullet-icon text-nowrap\" ng-if=\"data.hInfo.title\">\n            <a href=\"?id=community_question&sys_id={{data.hInfo.sourceRoot}}\" target=\"_blank_cm1\">${Link to Discussion}</a>\n          </span>\n        </div>\n      </div>\n      <div ng-if=\"c.isMobile && !c.isAgentApp\" class=\"kb-favorite\" ng-click=\"toggleFavorite($event)\">\n              <sp-widget widget=\"data.favoriteWidget\"></sp-widget>\n              <span ng-if = \"showFavorite\">\n                <span class=\"favorite-text\" ng-if=\"isFavorite === true\">${Favorited}</span>\n                <span class=\"favorite-text\" ng-if=\"isFavorite === false\">${Favorite}</span>\n        \t  </span>\n      </div>\n   \n      <hr class=\"kb-header-line\" aria-hidden=\"true\"/>\n      <article class=\"kb-article-content\" ng-if=\"::data.articleType != 'wiki'\">\n        <section ng-if=\"::!c.data.kbContentData.isTemplate\" ng-bind-html=\"::c.data.kbContentData.data\" ng-class=\"{'word-addin-mobile' : c.data.wordOnlineUrl && c.data.wordOnlineUrl.length>0}\"/>\n        <section ng-if=\"::c.data.kbContentData.isTemplate\" ng-repeat=\"field in c.data.kbContentData.data track by $index\" ng-attr-style=\"{{field.field_style}}\">\n          <h3 ng-if=\"::!field.collapsible\" ng-attr-style=\"{{field.heading_style}}\">{{field.label}}</h3>\n          <header class=\"collapsible-title\" ng-if=\"::field.collapsible\">\n            <h3 ng-attr-style=\"{{::field.heading_style}}\">\n              <button aria-expanded=\"{{!field.collapsed}}\"\n                      aria-controls=\"{{::field.column}}\"\n                      class=\"transparent-button accordion-trigger\"\n                      ng-click=\"c.toggleSection(field)\">    \n                        {{field.label}}\n                        <i class=\"fa fa-chevron-up rotate\" ng-class=\"{'down': field.collapsed}\" aria-hidden=\"true\"/>\n              </button> \n             </h3>\n          </header>\n          <p id=\"{{::field.column}}\" ng-if=\"::field.type != 'html' && field.collapsed\" style=\"display:none;\">{{field.content}}</p>\n          <p id=\"{{::field.column}}\" ng-if=\"::field.type != 'html' && !field.collapsed\">{{field.content}}</p>\n          <section id=\"{{::field.column}}\" ng-if=\"::field.type == 'html' && field.collapsed\" style=\"display:none;\" ng-bind-html=\"::field.content\"/>\n          <section id=\"{{::field.column}}\" ng-if=\"::field.type == 'html' && !field.collapsed\" ng-bind-html=\"::field.content\"/>\n        </section>\n      </article>   \n      <article class=\"kb-article-content\" ng-if=\"::data.articleType == 'wiki'\" ng-bind-html=\"::data.kbWiki\"></article>\n      <hr class=\"kb-permalink-separator\" ng-if=\"::!c.isMobile\" aria-hidden=\"true\"/>\n      <p class=\"pull-right kb-permalink\" ng-if=\"::!c.isMobile\">\n        <button class=\"transparent-button\" ng-click=\"c.copyPermalink()\">{{::data.messages.COPY_PERMALINK}}</button>\n      </p>\n    </div>\n  </div>\n  <div ng-if=\"!data.isValid && !data.knowledgeExists\" class=\"col-sm-12 panel-danger\">\n    <div class=\"panel-heading\">{{data.messages.RECORD_NOT_FOUND}}</div>\n  </div>\n  <div ng-if=\"!data.isValid && data.knowledgeExists && !data.isArticleExpired\" class=\"col-sm-12 panel-warning\">\n    <div class=\"panel-heading kb-font-color-black\">{{data.messages.INSUFFICIENT_PREVILEGES}}</div>\n  </div>\n  <div ng-if=\"!data.isKBAdmin && data.isArticleExpired\" class=\"col-sm-12 panel-warning\">\n    <div class=\"panel-heading kb-font-color-black\">{{data.messages.ARTICLE_EXPIRED}}</div>\n  </div>\n</div>\n</div>\n<style>\n  #uiNotificationContainer{\n    top : 10px;\n  }\n  .kb-article-wrapper .kb-desktop .kb-panel-title-header{\n    padding-left: 25px;\n  }\n  .kb-article-wrapper .app-modal-window .modal-dialog {\n    margin-top: 110px;\n  }\n  .kb-article-wrapper .kb-mobile{\n    letter-spacing: .6px;\n  }\n  .kb-article-wrapper .kb-mobile .title-secondary-data{\n    word-spacing:1px;\n  }\n  .kb-article-wrapper .kb-mobile .author{\n    margin-bottom: 17px;\n  }\n  .kb-article-content dl {\n    margin-top: .2em;\n    margin-bottom: .5em;\n  }\n  .kb-article-content dd { \n    line-height: 1.5em;\n    margin-left: 2em;\n    margin-bottom: .1em;\n  }\n  @media only screen and (max-width :992px){\n    .kb-article-wrapper .kb-desktop{\n      margin-top:15px;\n    }\n    .kb-article-wrapper .kb-wrapper{\n      padding : 10px !important;\n    }\n    .kb-article-wrapper .kb-menu-entry{\n      padding-top: 2px;\n      padding-bottom: 2px;\n    }\n    .kb-article-wrapper .kb-version-info{\n      margin-top : 5px !important;\n    }\n    .kb-article-wrapper .kb-desktop .kb-number-info{\n      margin-top : 6px !important;\n      padding-left: 10px;\n    }\n    .kb-article-wrapper .kb-mobile .kb-panel-title-header{\n      padding-left: 16px;\n    }\n    .kb-article-wrapper .kb-desktop .kb-panel-title-header{\n      padding-left: 0px;\n    }\n  }\n  @media only screen and (max-width :768px){\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 25px !important;\n    }\n  }\n  @media only screen and (max-width: 750px) {\n    .kb-article-wrapper .kb-mobile .author{\n      margin-bottom: 0px;\n    }\n  }\n  @media only screen and (min-width: 992px) {\n    .kb-article-wrapper .app-modal-window .modal-dialog {\n      width: 750px;\n    }\n    .kb-article-wrapper .control-label{\n      float :right;\n    }\n    .kb-article-wrapper .left-col-padding{\n      padding-right : 30px !important;\n    }\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 5px !important;\n    }\n  }\n  @media only screen and (min-width:768px) and (max-width: 992px) {\n    .kb-article-wrapper .app-modal-window .modal-dialog {\n      width: 600px;\n    }\n    .kb-article-wrapper .control-label{\n      float :right;\n    }\n    .kb-article-wrapper .left-col-padding{\n      padding-right : 5px !important;\n    }\n    .kb-article-wrapper .right-col-padding{\n      padding-left : 5px !important;\n    }\n  }\n  @media only screen and (max-width: 400px) {\n    .pad-right{\n      padding-right:0px !important;\n    }\n  }\n\n  @media only screen and (max-width: 376px) {\n    .kb-article-wrapper .kb-mobile{\n      letter-spacing: 0px;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data{\n      word-spacing:0px;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data .str-rating{\n      margin-top: 17px;\n      display: block;\n    }\n    .kb-article-wrapper .kb-mobile .title-secondary-data .str-rating .pad-right{\n      display: none;\n    }\n  }\n  /*Versions dropdown screen width adjustment*/\n  @media only screen and (min-width: 500px) {\n     .version-menu-list li,.version-menu-list{\n         font-size: 14px !important;\n         margin: auto;\n         min-width: 410px !important;\n    }\n     .version-menu-list li a,.version-menu-list li span{\n         display:block;\n         padding: 3px 10px !important;\n         white-space: normal !important;\n    }\n  }\n  @media only screen and (max-width: 500px) {\n     .version-menu-list li,.version-menu-list{\n         font-size: 14px !important;\n         margin: auto;\n         min-width: 200px !important;\n         width:100% !important;\n    }\n     .version-menu-list li a, .version-menu-list li span{\n         display:block;\n         padding: 3px 10px !important;\n         white-space: normal !important;\n    }\n  }\n</style>\n",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".kb-language, .kb-language-block{\n  display: inline-block;\n}\n.kb-subscribe{\n  min-width : 100px;\n  margin-left : 5px;\n}\n.kb-panel-heading{\n  padding-top : 6px;\n  padding-bottom : 6px;\n}\nsummary{\n  display : list-item;\n}\n.kb-dropdown-button{\n  margin-left : 5px;\n  display: inline-block;\n  height:34px\n}\n.kb-permalink-separator{\n  margin : 0px;\n}\n.kb-number-info{\n  display : inline-block;\n}\n\n.kb-article-content{\n  overflow-x:auto;\n  img{\n    cursor:pointer;\n  }\n  img:focus{\n    outline: 5px auto -webkit-focus-ring-color;\n    outline-offset: -2px;\n  }\n}\n\n/*To fix contents are not shown when we created article in word add-in*/\n.word-addin-mobile{\n  overflow-x:auto;\n  min-width:650pt;\n}\n\n.collapsible-title {\n  border-bottom: 1px solid $gray-dark;\n  margin-bottom: 10px;\n  vertical-align: middle;\n  cursor: pointer;\n  display: block;\n  color: inherit;\n\n  .fa {\n    float: right;\n    color: $gray-dark;\n  }\n}\n\n.collapsible-title:focus {\n  outline: none;\n  border: 1px solid #1f8476;\n  -webkit-box-shadow: 0px 0px 5px #1f8476;\n  box-shadow: 0px 0px 5px #1f8476;\n}\n\nheader h3 {\n  outline: none;\n  margin: 0px;\n  padding-top: 18px;\n  padding-bottom: 9px;\n}\n\nheader h3:focus{\n  border: none;\n  box-shadow: none;\n  -webkit-box-shadow: none;\n}\n\nheader i {\n  outline: none;\n  border: none !important;\n  box-shadow: none !important;\n}\n\n\n.rotate {\n  -ms-transition: all 0.25s linear;\n  -moz-transition: all 0.25s linear;\n  -webkit-transition: all 0.25s linear;\n  transition: all 0.25s linear;\n}\n\n.rotate.down{\n  -ms-transform: rotate(180deg);\n  -moz-transform: rotate(180deg);\n  -webkit-transform: rotate(180deg);\n  transform: rotate(180deg);\n}\n\n.kb-sub-icon{\n  //color: $brand-primary;//#428bca;\n}\n.kb-language-choice{\n  display : inline-block;\n  width : auto;\n}\n.kb-title-header{\n  margin-top : 0px;\n  line-height : 1;\n  overflow-wrap: break-word;\n}\n.kb-action-menu-padding{\n  margin-top : 2px;\n}\n.kb-panel-title-header{\n  margin-top : 6px;\n  vertical-align : middle;\n}\n.kb-version-info{\n  margin-top : -5px;\n  padding-bottom : 15px;\n}\n\n.modal-title{\n  text-align: start;\n}\n.modal-content{\n  text-align : start;\n}\n.kb-end-buttons{\n  float:right;\n}\n.kb-fav-padding{\n  padding-right:3px;\n}\n\n.kb-header-row{\n  margin-left : 0px;\n  margin-right : 0px;\n}\n\n.kb-version{\n  //margin-left : 15px;\n  //margin-right : 15px;\n}\n\n.kb-header-line,.kb-permalink-separator{\n  margin-top: 10px;\n  margin-left: -5px;\n  margin-right: -5px;\n  margin-bottom : 10px;\n}\n\n.kb-menu-entry{\n}\n.kb-star-on {\n  text-shadow: $fav-star-outline;\n}\n.kb-star-off {\n  color: $fav-star-color-off !important;\n  text-shadow: $fav-star-outline;\n}\n.rating-stars [role=\"button\"] {\n  cursor: text;\n}\n\n.disabled{\n  text-decoration:none;\n  cursor:default;\n  color:$text-color;\n}\n\n.community-attribution{\n  .contributor{\n    padding-top: 10px;\n    .pre-bullet-icon::before{\n      content: '\\2022';\n      padding-right: 4px;\n    }\n  }\n  .discussion-info{\n    padding: 0px 18px;\n  }\n  .pad-lr{\n    margin: 0px 2px;\n  }\n  margin-bottom: 20px;\n  margin-left: 0px;\n}\n.title-secondary-data{\n  .author .fa{\n    position:relative;\n    bottom:0.8px;\n    font-size:14px;\n  }\n   .published-date{\n    display:inline;\n  }\n\n  .published .fa{\n    position: relative;\n    bottom: 1.5px;\n    font-size: 12px;\n  }\n  .views .fa{\n    font-size:14px;\n  }\n  .str-rating i{\n    position:relative;\n    top:1px;\n    font-size:14px;\n  }\n}\n.kb-desktop{\n  &.kb-wrapper{\n    padding : 25px 25px 0px 25px ;\n  }\n  &.panel{\n    border:1px solid $panel-default-border !important;\n  }\n}\n.kb-mobile{\n  color: $text-muted;\n  .author{\n    display: block;\n    margin-top: 7px;\n  }\n  .title-secondary-data{\n    font-size: 17px !important;\n    font-weight: 400;\n    line-height: 1;\n    .str-rating{\n      font-size: 15px !important;\n    }\n  }\n  .kb-number-info{\n    font-size: 17px;\n    font-weight: 400;\n  }\n  .kb-title-header{\n    line-height: 1.2;\n    font-size: 32px !important;\n  }\n  .kb-header-line{\n    border-color: #ccc;\n    margin: 25px -25px !important;\n  }\n  &.mesp-ui{\n    .kb-header-line{\n       margin: 25px -25px 25px -26px !important;\n    }\n  }\n  .kb-article-content{\n    font-size: 15px;\n  }\n  .kb-lang-dropdown-btn{\n    font-size: 17px;\n    font-weight: 400;\n    padding:11px 0px;\n    color:$primary;\n  }\n  .kb-language-block{\n    word-spacing: 3px;\n    a{\n      font-size: 17px !important;\n      font-weight: 400 !important;\n    }\n    .dropdown-menu{\n      top: 0 !important;\n      bottom: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      position: fixed !important;\n      padding: 0px !important;\n      margin: 0px !important;\n      overflow-y: auto;\n\n      li{\n        width: 100% !important;\n        height: 50px !important;\n        font-size: 15px !important;\n        border-bottom: 1px solid $gray-lighter !important;\n\n        a{\n          padding: 12px 20px !important;\n          font-size: 18px !important;\n        }\n      }\n    }\n  }\n  .kb-favorite {\n     margin-top:24px;\n     width: fit-content;\n     width: -moz-fit-content;\n     .v523f6529532d0110fedfddeeff7b1298{\n      float: left;\n    }\n    .favorite-button{\n      width : auto;\n      height: auto;\n      background-color: transparent;\n      outline: transparent;\n      box-shadow: none;\n      .fa{\n        color: $tropical-rain;\n      }\n    }\n    .favorite-text{\n      margin-left: 8px;\n      font-size: 14px;\n      font-weight: 600;\n      color: $tropical-rain;\n    }\n}\n}\n.kb-font-color-black{\n\tcolor:$close-color;\n}\n.transparent-button {\n    background-color: transparent;\n    background-repeat:no-repeat;\n    border: none;\n    cursor:pointer;\n    overflow: hidden;\n    color: $brand-primary-darker;\n }\n.apply-brand-color{\n  color: $brand-primary-darker;\n}\n.moreActionsMenuList{\n  z-index: 1000 !important;\n}\n.trim-padding-right{\n  padding-right: 0px !important;\n}\n.moreActionsMenuList li a:focus,.version-menu-list li a:focus{\n     background-color:$brand-primary-dark;\n     color:$body-bg;\n}\n .kb-version{\n     padding:0px !important;\n     margin-top:-2px !important;\n     font-size:16px !important;\n}\n .kb-version:focus{\n     padding:0px !important;\n     margin:0px !important;\n     font-size:16px !important;\n}\n.kb-version i,.more-actions-menu i{\n  padding-left:3px;\n}\n/*used in Flag modal: to avoid horizontal resize*/\n.resize-vertical{\n    resize: vertical;\n  }\n.accordion-trigger {\n  position: relative;\n  text-align: left;\n  width: 100%;\n  color:$text-color;\n}\n.accordion-trigger:focus{\n  box-shadow: 0px 0px 5px $brand-primary-dark;\n  outline-color: $brand-primary-dark;\n  outline-offset: -2px;\n  border: 1px solid $brand-primary-dark;\n}\n.accordion-trigger:hover{\n  background-color:$breadcrumb-bg;\n}",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".kb-language, .kb-language-block{\n  display: inline-block;\n}\n.kb-subscribe{\n  min-width : 100px;\n  margin-left : 5px;\n}\n.kb-panel-heading{\n  padding-top : 6px;\n  padding-bottom : 6px;\n}\nsummary{\n  display : list-item;\n}\n.kb-dropdown-button{\n  margin-left : 5px;\n  display: inline-block;\n  height:34px\n}\n.kb-permalink-separator{\n  margin : 0px;\n}\n.kb-number-info{\n  display : inline-block;\n}\n\n.kb-article-content{\n  overflow-x:auto;\n  img{\n    cursor:pointer;\n  }\n  img:focus{\n    outline: 5px auto -webkit-focus-ring-color;\n    outline-offset: -2px;\n  }\n}\n\n/*To fix contents are not shown when we created article in word add-in*/\n.word-addin-mobile{\n  overflow-x:auto;\n  min-width:650pt;\n}\n\n.collapsible-title {\n  border-bottom: 1px solid $gray-dark;\n  margin-bottom: 10px;\n  vertical-align: middle;\n  cursor: pointer;\n  display: block;\n  color: inherit;\n\n  .fa {\n    float: right;\n    color: $gray-dark;\n  }\n}\n\n.collapsible-title:focus {\n  outline: none;\n  border: 1px solid #1f8476;\n  -webkit-box-shadow: 0px 0px 5px #1f8476;\n  box-shadow: 0px 0px 5px #1f8476;\n}\n\nheader h3 {\n  outline: none;\n  margin: 0px;\n  padding-top: 18px;\n  padding-bottom: 9px;\n}\n\nheader h3:focus{\n  border: none;\n  box-shadow: none;\n  -webkit-box-shadow: none;\n}\n\nheader i {\n  outline: none;\n  border: none !important;\n  box-shadow: none !important;\n}\n\n\n.rotate {\n  -ms-transition: all 0.25s linear;\n  -moz-transition: all 0.25s linear;\n  -webkit-transition: all 0.25s linear;\n  transition: all 0.25s linear;\n}\n\n.rotate.down{\n  -ms-transform: rotate(180deg);\n  -moz-transform: rotate(180deg);\n  -webkit-transform: rotate(180deg);\n  transform: rotate(180deg);\n}\n\n.kb-sub-icon{\n  //color: $brand-primary;//#428bca;\n}\n.kb-language-choice{\n  display : inline-block;\n  width : auto;\n}\n.kb-title-header{\n  margin-top : 0px;\n  line-height : 1;\n  overflow-wrap: break-word;\n}\n.kb-action-menu-padding{\n  margin-top : 2px;\n}\n.kb-panel-title-header{\n  margin-top : 6px;\n  vertical-align : middle;\n}\n.kb-version-info{\n  margin-top : -5px;\n  padding-bottom : 15px;\n}\n\n.modal-title{\n  text-align: start;\n}\n.modal-content{\n  text-align : start;\n}\n.kb-end-buttons{\n  float:right;\n}\n.kb-fav-padding{\n  padding-right:3px;\n}\n\n.kb-header-row{\n  margin-left : 0px;\n  margin-right : 0px;\n}\n\n.kb-version{\n  //margin-left : 15px;\n  //margin-right : 15px;\n}\n\n.kb-header-line,.kb-permalink-separator{\n  margin-top: 10px;\n  margin-left: -5px;\n  margin-right: -5px;\n  margin-bottom : 10px;\n}\n\n.kb-menu-entry{\n}\n.kb-star-on {\n  text-shadow: $fav-star-outline;\n}\n.kb-star-off {\n  color: $fav-star-color-off !important;\n  text-shadow: $fav-star-outline;\n}\n.rating-stars [role=\"button\"] {\n  cursor: text;\n}\n\n.disabled{\n  text-decoration:none;\n  cursor:default;\n  color:$text-color;\n}\n\n.community-attribution{\n  .contributor{\n    padding-top: 10px;\n    .pre-bullet-icon::before{\n      content: '\\2022';\n      padding-right: 4px;\n    }\n  }\n  .discussion-info{\n    padding: 0px 18px;\n  }\n  .pad-lr{\n    margin: 0px 2px;\n  }\n  margin-bottom: 20px;\n  margin-left: 0px;\n}\n.title-secondary-data{\n  .author .fa{\n    position:relative;\n    bottom:0.8px;\n    font-size:14px;\n  }\n   .published-date{\n    display:inline;\n  }\n\n  .published .fa{\n    position: relative;\n    bottom: 1.5px;\n    font-size: 12px;\n  }\n  .views .fa{\n    font-size:14px;\n  }\n  .str-rating i{\n    position:relative;\n    top:1px;\n    font-size:14px;\n  }\n}\n.kb-desktop{\n  &.kb-wrapper{\n    padding : 25px 25px 0px 25px ;\n  }\n  &.panel{\n    border:1px solid $panel-default-border !important;\n  }\n}\n.kb-mobile{\n  color: $text-muted;\n  .author{\n    display: block;\n    margin-top: 7px;\n  }\n  .title-secondary-data{\n    font-size: 17px !important;\n    font-weight: 400;\n    line-height: 1;\n    .str-rating{\n      font-size: 15px !important;\n    }\n  }\n  .kb-number-info{\n    font-size: 17px;\n    font-weight: 400;\n  }\n  .kb-title-header{\n    line-height: 1.2;\n    font-size: 32px !important;\n  }\n  .kb-header-line{\n    border-color: #ccc;\n    margin: 25px -25px !important;\n  }\n  &.mesp-ui{\n    .kb-header-line{\n       margin: 25px -25px 25px -26px !important;\n    }\n  }\n  .kb-article-content{\n    font-size: 15px;\n  }\n  .kb-lang-dropdown-btn{\n    font-size: 17px;\n    font-weight: 400;\n    padding:11px 0px;\n    color:$primary;\n  }\n  .kb-language-block{\n    word-spacing: 3px;\n    a{\n      font-size: 17px !important;\n      font-weight: 400 !important;\n    }\n    .dropdown-menu{\n      top: 0 !important;\n      bottom: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      position: fixed !important;\n      padding: 0px !important;\n      margin: 0px !important;\n      overflow-y: auto;\n\n      li{\n        width: 100% !important;\n        height: 50px !important;\n        font-size: 15px !important;\n        border-bottom: 1px solid $gray-lighter !important;\n\n        a{\n          padding: 12px 20px !important;\n          font-size: 18px !important;\n        }\n      }\n    }\n  }\n  .kb-favorite {\n     margin-top:24px;\n     width: fit-content;\n     width: -moz-fit-content;\n     .v523f6529532d0110fedfddeeff7b1298{\n      float: left;\n    }\n    .favorite-button{\n      width : auto;\n      height: auto;\n      background-color: transparent;\n      outline: transparent;\n      box-shadow: none;\n      .fa{\n        color: $tropical-rain;\n      }\n    }\n    .favorite-text{\n      margin-left: 8px;\n      font-size: 14px;\n      font-weight: 600;\n      color: $tropical-rain;\n    }\n}\n}\n.kb-font-color-black{\n\tcolor:$close-color;\n}\n.transparent-button {\n    background-color: transparent;\n    background-repeat:no-repeat;\n    border: none;\n    cursor:pointer;\n    overflow: hidden;\n    color: $brand-primary-darker;\n }\n.apply-brand-color{\n  color: $brand-primary-darker;\n}\n.moreActionsMenuList{\n  z-index: 1000 !important;\n}\n.trim-padding-right{\n  padding-right: 0px !important;\n}\n.moreActionsMenuList li a:focus,.version-menu-list li a:focus{\n     background-color:$brand-primary-dark;\n     color:$body-bg;\n}\n .kb-version{\n     padding:0px !important;\n     margin-top:-2px !important;\n     font-size:16px !important;\n}\n .kb-version:focus{\n     padding:0px !important;\n     margin:0px !important;\n     font-size:16px !important;\n}\n.kb-version i,.more-actions-menu i{\n  padding-left:3px;\n}\n/*used in Flag modal: to avoid horizontal resize*/\n.resize-vertical{\n    resize: vertical;\n  }\n.accordion-trigger {\n  position: relative;\n  text-align: left;\n  width: 100%;\n  color:$text-color;\n}\n.accordion-trigger:focus{\n  box-shadow: 0px 0px 5px $brand-primary-dark;\n  outline-color: $brand-primary-dark;\n  outline-offset: -2px;\n  border: 1px solid $brand-primary-dark;\n}\n.accordion-trigger:hover{\n  background-color:$breadcrumb-bg;\n}",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function(scope,$timeout) {\n\tvar c = scope.c,\n\t\t\t$uibModal = $injector.get('$uibModal'),\n\t\t\t$rootScope = $injector.get(\"$rootScope\");\n\tvar options = {\n\t\tscope: scope,\n\t\tkeyboard: true,\n\t\ttemplateUrl: 'knowledge-image-modal.html'\n\t};\n\tsetTimeout(function(){\n\t\tvar p=$(\".kb-article-content\").find(\"img\");\n\t\tp.attr(\"tabindex\",\"0\");\n\t\tp.attr(\"role\",\"button\");\n\t\tvar timer = 0;\n\t\tvar prevent = false;\n\t\tvar element;\n\n\t\t$(\".kb-article-content\").on(\"click keypress\",\"img\", function() {\n\t\t\telement = this;\n\t\t\tvar parentTag = $(this).parent().get(0).tagName;\n\t\t\tif(parentTag!='A')\n\t\t\t{\n\t\t\ttimer = setTimeout(function() {\n\t\t\t\tif (!prevent)\n\t\t\t\t\topenModal(element);\n\t\t\t\tprevent=false;\n\t\t\t}, 200);\n\t\t\t}\n\t\t});\n\n\t\t$(\".kb-article-content\").on(\"dblclick\",\"img\", function() {\n\t\t\telement = this;\n\t\t\tprevent = true;\n\t\t\tclearTimeout(timer);\n\t\t\topenModal(element);\n\t\t});\n\n\t});\n\n\tfunction openModal(element){\n\t\tif( c.imageInstance == '' ||  c.imageInstance.closed.$$state.status == 1 ){\n\t\t\tvar pageRoot = angular.element('.sp-page-root');\n\t\t\tvar src= element.src;\n\t\t\tvar title=element.title;\n\t\t\tvar alt=element.alt;\n\t\t\tc.imageInstance = $uibModal.open(options);\n\t\t\tc.imageInstance.rendered.then(function() {\n\t\t\t\t//hide the root page headings when modal is active\n\t\t\t\tpageRoot.attr('aria-hidden', 'true');\n\t\t\t\t$('#modal-close').focus();\n\t\t\t});\n\t\t\tc.imageInstance.closed.then(function(){\n\t\t\t\tpageRoot.attr('aria-hidden', 'false');\n\t\t\t});\n\t\t\tvar orignalWidth = $(element).prop('naturalWidth');\n\t\t\tvar orignalHeight = $(element).prop('naturalHeight');\n\t\t\tsetTimeout(function(){\n\t\t\t\tvar modal = document.getElementById('knowledgeImageModal'),\n\t\t\t\t\t\tmodalImg = $('#modalImage')[0];\n\t\t\t\tmodal.style.display = \"block\";\n\t\t\t\tmodalImg.src = src;\n\t\t\t\tmodalImg.title = title;\n\t\t\t\tmodalImg.alt = alt;\n\t\t\t\tc.imagesrc = src;\n\t\t\t\tmodalImg.width = orignalWidth > c.minImageWidth ? orignalWidth : c.minImageWidth;\n\t\t\t\tmodalImg.style.minHeight = orignalHeight > c.minImageHeight ? orignalHeight : c.minImageHeight +\"px\";\n\t\t\t\t$('.modal-dialog').width(modalImg.width);\n\t\t\t\t$('#modal-close').focus();\n\n\t\t\t});\n\t\t}\n\t}\n\n\tc.showAttachArticle = function(){\n\t\ttry{\n\t\t\tif(window.opener && window.opener.document.getElementById(\"section_form_id\") != null && c.data.params.sysparm_kb_search_table && c.data.isTaskTable){\n\t\t\t\t$('.kb_container-left').removeClass('col-md-9').addClass('col-md-12');\n\t\t\t\tif(c.data.displayAttachments == 'true' && c.data.attachments.length > 0) {\n\t\t\t\t\t$('.kb_container-right').children('span').children('div').children(\"div:not(.kb-panel-attach)\").css('display','none');\n\t\t\t\t\t$('.kb_container-right').removeClass('col-md-3').addClass('col-md-12');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$('.kb_container-right').css('display','none').removeClass('col-md-3');\n\t\t\t\t}\n\t\t\t\t$('.kb-article-content').find('a').attr(\"target\",\"_blank\");\n\t\t\t\tif($rootScope.properties.readOnlyPage == \"true\") {\n\t\t\t\t\t$rootScope.readOnly = true;\n\t\t\t\t\t$(\"[ng-click='c.toggleVersions()']\").off(\"click\").addClass(\"disabled\");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}catch(e){\n\t\t\treturn false;\n\t\t}\n\t\treturn false;\n\t};\n\n\tc.attachToTask = function(){\n\t\tself = window;\n\t\tif (self.opener) {\n\t\t\tvar lastSaved = self.opener.document.getElementById(\"onLoad_sys_updated_on\").value;\n\t\t\tif (!lastSaved) {\n\t\t\t\tself.close();\n\t\t\t\tself.opener.g_form.addErrorMessage(\"Invalid action: Record needs to be saved first\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar e = self.opener.document.getElementById(\"sys_uniqueValue\");\n\t\t\tvar taskID = e.value;\n\n\n\t\t\tvar articleID = c.data.article_sys_id;\n\t\t\tvar args = [];\n\t\t\targs.push(articleID);\n\t\t\targs.push(c.data.properties.attachFields);\n\n\t\t\tc.server.get({action : 'kbAttachArticle', value : articleID + \",\" + taskID}).then(function(resp){\n\t\t\t\tvar fieldName = self.opener.fillField;\n\t\t\t\tvar tableName = fieldName.split('.')[0];\n\t\t\t\tvar targetFields = c.data.properties.attachFields;\n\n        var articleContent = resp.data.articleContent;\n\n\t\t\t\tvar names = [];\n\t\t\t\tif (targetFields) {\n\t\t\t\t\tvar parts = targetFields.split(\",\");\n\t\t\t\t\tfor(var i=0; i<parts.length; i++)\n\t\t\t\t\t\tnames.push(parts[i]);\n\t\t\t\t}\n\t\t\t\tnames.push('comments');\n\t\t\t\tnames.push('description');\n\n\t\t\t\tvar target = null;\n\t\t\t\tvar targetName = null;\n\t\t\t\tfor (var i=0;i<names.length; i++) {\n\t\t\t\t\ttargetName = names[i];\n\t\t\t\t\ttarget = self.opener.document.getElementById(tableName + \".\" + targetName);\n\t\t\t\t\tif (target){\n\t\t\t\t\t\tvar ed = self.opener.g_form.getGlideUIElement(targetName);\n\t\t\t\t\t\tif (ed && ed.type == 'reference') {\n\t\t\t\t\t\t\tself.opener.g_form.setValue(targetName, articleID);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar newValue = \"\";\n\t\t\t\t\t\t\tif (target.value == \"\")\n\t\t\t\t\t\t\t\tnewValue = articleContent;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tnewValue = target.value + \"\\n\" + articleContent;\n\t\t\t\t\t\t\t\tself.opener.g_form.setValue(targetName, newValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\tself.close();\n\t\t\t})\n\t\t}\n\t};\n}",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function(scope,$timeout) {\n\tvar c = scope.c,\n\t\t\t$uibModal = $injector.get('$uibModal'),\n\t\t\t$rootScope = $injector.get(\"$rootScope\");\n\tvar options = {\n\t\tscope: scope,\n\t\tkeyboard: true,\n\t\ttemplateUrl: 'knowledge-image-modal.html'\n\t};\n\tsetTimeout(function(){\n\t\tvar p=$(\".kb-article-content\").find(\"img\");\n\t\tp.attr(\"tabindex\",\"0\");\n\t\tp.attr(\"role\",\"button\");\n\t\tvar timer = 0;\n\t\tvar prevent = false;\n\t\tvar element;\n\n\t\t$(\".kb-article-content\").on(\"click keypress\",\"img\", function() {\n\t\t\telement = this;\n\t\t\tvar parentTag = $(this).parent().get(0).tagName;\n\t\t\tif(parentTag!='A')\n\t\t\t{\n\t\t\ttimer = setTimeout(function() {\n\t\t\t\tif (!prevent)\n\t\t\t\t\topenModal(element);\n\t\t\t\tprevent=false;\n\t\t\t}, 200);\n\t\t\t}\n\t\t});\n\n\t\t$(\".kb-article-content\").on(\"dblclick\",\"img\", function() {\n\t\t\telement = this;\n\t\t\tprevent = true;\n\t\t\tclearTimeout(timer);\n\t\t\topenModal(element);\n\t\t});\n\n\t});\n\n\tfunction openModal(element){\n\t\tif( c.imageInstance == '' ||  c.imageInstance.closed.$$state.status == 1 ){\n\t\t\tvar pageRoot = angular.element('.sp-page-root');\n\t\t\tvar src= element.src;\n\t\t\tvar title=element.title;\n\t\t\tvar alt=element.alt;\n\t\t\tc.imageInstance = $uibModal.open(options);\n\t\t\tc.imageInstance.rendered.then(function() {\n\t\t\t\t//hide the root page headings when modal is active\n\t\t\t\tpageRoot.attr('aria-hidden', 'true');\n\t\t\t\t$('#modal-close').focus();\n\t\t\t});\n\t\t\tc.imageInstance.closed.then(function(){\n\t\t\t\tpageRoot.attr('aria-hidden', 'false');\n\t\t\t});\n\t\t\tvar orignalWidth = $(element).prop('naturalWidth');\n\t\t\tvar orignalHeight = $(element).prop('naturalHeight');\n\t\t\tsetTimeout(function(){\n\t\t\t\tvar modal = document.getElementById('knowledgeImageModal'),\n\t\t\t\t\t\tmodalImg = $('#modalImage')[0];\n\t\t\t\tmodal.style.display = \"block\";\n\t\t\t\tmodalImg.src = src;\n\t\t\t\tmodalImg.title = title;\n\t\t\t\tmodalImg.alt = alt;\n\t\t\t\tc.imagesrc = src;\n\t\t\t\tmodalImg.width = orignalWidth > c.minImageWidth ? orignalWidth : c.minImageWidth;\n\t\t\t\tmodalImg.style.minHeight = orignalHeight > c.minImageHeight ? orignalHeight : c.minImageHeight +\"px\";\n\t\t\t\t$('.modal-dialog').width(modalImg.width);\n\t\t\t\t$('#modal-close').focus();\n\n\t\t\t});\n\t\t}\n\t}\n\n\tc.showAttachArticle = function(){\n\t\ttry{\n\t\t\tif(window.opener && window.opener.document.getElementById(\"section_form_id\") != null && c.data.params.sysparm_kb_search_table && c.data.isTaskTable){\n\t\t\t\t$('.kb_container-left').removeClass('col-md-9').addClass('col-md-12');\n\t\t\t\tif(c.data.displayAttachments == 'true' && c.data.attachments.length > 0) {\n\t\t\t\t\t$('.kb_container-right').children('span').children('div').children(\"div:not(.kb-panel-attach)\").css('display','none');\n\t\t\t\t\t$('.kb_container-right').removeClass('col-md-3').addClass('col-md-12');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$('.kb_container-right').css('display','none').removeClass('col-md-3');\n\t\t\t\t}\n\t\t\t\t$('.kb-article-content').find('a').attr(\"target\",\"_blank\");\n\t\t\t\tif($rootScope.properties.readOnlyPage == \"true\") {\n\t\t\t\t\t$rootScope.readOnly = true;\n\t\t\t\t\t$(\"[ng-click='c.toggleVersions()']\").off(\"click\").addClass(\"disabled\");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}catch(e){\n\t\t\treturn false;\n\t\t}\n\t\treturn false;\n\t};\n\n\tc.attachToTask = function(){\n\t\tself = window;\n\t\tif (self.opener) {\n\t\t\tvar lastSaved = self.opener.document.getElementById(\"onLoad_sys_updated_on\").value;\n\t\t\tif (!lastSaved) {\n\t\t\t\tself.close();\n\t\t\t\tself.opener.g_form.addErrorMessage(\"Invalid action: Record needs to be saved first\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar e = self.opener.document.getElementById(\"sys_uniqueValue\");\n\t\t\tvar taskID = e.value;\n\n\n\t\t\tvar articleID = c.data.article_sys_id;\n\t\t\tvar args = [];\n\t\t\targs.push(articleID);\n\t\t\targs.push(c.data.properties.attachFields);\n\n\t\t\tc.server.get({action : 'kbAttachArticle', value : articleID + \",\" + taskID}).then(function(resp){\n\t\t\t\tvar fieldName = self.opener.fillField;\n\t\t\t\tvar tableName = fieldName.split('.')[0];\n\t\t\t\tvar targetFields = c.data.properties.attachFields;\n\n        var articleContent = resp.data.articleContent;\n\n\t\t\t\tvar names = [];\n\t\t\t\tif (targetFields) {\n\t\t\t\t\tvar parts = targetFields.split(\",\");\n\t\t\t\t\tfor(var i=0; i<parts.length; i++)\n\t\t\t\t\t\tnames.push(parts[i]);\n\t\t\t\t}\n\t\t\t\tnames.push('comments');\n\t\t\t\tnames.push('description');\n\n\t\t\t\tvar target = null;\n\t\t\t\tvar targetName = null;\n\t\t\t\tfor (var i=0;i<names.length; i++) {\n\t\t\t\t\ttargetName = names[i];\n\t\t\t\t\ttarget = self.opener.document.getElementById(tableName + \".\" + targetName);\n\t\t\t\t\tif (target){\n\t\t\t\t\t\tvar ed = self.opener.g_form.getGlideUIElement(targetName);\n\t\t\t\t\t\tif (ed && ed.type == 'reference') {\n\t\t\t\t\t\t\tself.opener.g_form.setValue(targetName, articleID);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar newValue = \"\";\n\t\t\t\t\t\t\tif (target.value == \"\")\n\t\t\t\t\t\t\t\tnewValue = articleContent;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tnewValue = target.value + \"\\n\" + articleContent;\n\t\t\t\t\t\t\t\tself.opener.g_form.setValue(targetName, newValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\tself.close();\n\t\t\t})\n\t\t}\n\t};\n}",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "Knowledge Article Content",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "Knowledge Article Content",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "[\n  {\n    \"hint\": \"Hide all article actions (Subscribe, Edit, Create Incident, Flag Article)\",\n    \"name\": \"hide_all_actions\",\n    \"default_value\": \"false\",\n    \"section\": \"other\",\n    \"label\": \"Hide All Actions\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Show Article Versioning Information\",\n    \"name\": \"show_version_info\",\n    \"default_value\": \"true\",\n    \"section\": \"other\",\n    \"label\": \"Show Version Information\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Show the Create Incident action\",\n    \"name\": \"show_create_incident_action\",\n    \"default_value\": \"false\",\n    \"section\": \"other\",\n    \"label\": \"Show Create Incident Action\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Label for the Create Incident action\",\n    \"name\": \"create_task_prompt\",\n    \"section\": \"other\",\n    \"label\": \"Create Incident Action Label\",\n    \"type\": \"string\"\n  },\n  {\n    \"hint\": \"Change the url for the create incident action to any custom task form (default url is populated based on glide.knowman.create_incident_link system property)\",\n    \"name\": \"create_task_url\",\n    \"section\": \"other\",\n    \"label\": \"Create Incident Action URL\",\n    \"type\": \"string\"\n  },\n  {\n    \"hint\": \"If there's a new version of the article available, it will redirect to the latest version. You must have Show Article Versioning disabled\",\n    \"name\": \"redirect_latest\",\n    \"section\": \"other\",\n    \"default_value\": \"false\",\n    \"label\": \"Redirect to the latest article\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"If the instance option is set to true, the page title is set dynamically from the widget. It will also override any existing title set on the page.\",\n    \"name\": \"set_page_title\",\n    \"section\": \"other\",\n    \"default_value\": \"true\",\n    \"label\": \"Set the page title\",\n    \"type\": \"boolean\"\n  }\n]",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "[\n  {\n    \"hint\": \"Hide all article actions (Subscribe, Edit, Create Incident, Flag Article)\",\n    \"name\": \"hide_all_actions\",\n    \"default_value\": \"false\",\n    \"section\": \"other\",\n    \"label\": \"Hide All Actions\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Show Article Versioning Information\",\n    \"name\": \"show_version_info\",\n    \"default_value\": \"true\",\n    \"section\": \"other\",\n    \"label\": \"Show Version Information\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Show the Create Incident action\",\n    \"name\": \"show_create_incident_action\",\n    \"default_value\": \"false\",\n    \"section\": \"other\",\n    \"label\": \"Show Create Incident Action\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"Label for the Create Incident action\",\n    \"name\": \"create_task_prompt\",\n    \"section\": \"other\",\n    \"label\": \"Create Incident Action Label\",\n    \"type\": \"string\"\n  },\n  {\n    \"hint\": \"Change the url for the create incident action to any custom task form (default url is populated based on glide.knowman.create_incident_link system property)\",\n    \"name\": \"create_task_url\",\n    \"section\": \"other\",\n    \"label\": \"Create Incident Action URL\",\n    \"type\": \"string\"\n  },\n  {\n    \"hint\": \"If there's a new version of the article available, it will redirect to the latest version. You must have Show Article Versioning disabled\",\n    \"name\": \"redirect_latest\",\n    \"section\": \"other\",\n    \"default_value\": \"false\",\n    \"label\": \"Redirect to the latest article\",\n    \"type\": \"boolean\"\n  },\n  {\n    \"hint\": \"If the instance option is set to true, the page title is set dynamically from the widget. It will also override any existing title set on the page.\",\n    \"name\": \"set_page_title\",\n    \"section\": \"other\",\n    \"default_value\": \"true\",\n    \"label\": \"Set the page title\",\n    \"type\": \"boolean\"\n  }\n]",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "data.tsQueryId = $sp.getParameter(\"sysparm_tsqueryId\") || \"\";\nvar isMESP = (options.is_mobile && options.is_mobile == \"true\") || ($sp.getParameter(\"id\") == \"me_kb_view\") || false;\ndata.isMESP = isMESP;\noptions.kb_rating_style = options.kb_rating_style ? options.kb_rating_style == \"true\" : true;\nvar portalRecord = $sp.getPortalRecord();\nvar portal = portalRecord.getUniqueValue();\ndata.showKbHomeLink = (portal != '45d6680fdb52220099f93691f0b8f5ad');\n\nif(!input){\n\tvar kbViewModel = new global.KBViewModel();\n\tdata.isCrawlerBot = kbViewModel.checkCrawlerBot();\n\tdata.messages = {};\n\tpopulateParameters();\n\n\tif(data.isCrawlerBot){\n\t\tkbViewModel.findKnowledgeById(GlideAppCache.get(\"articleSysId\"));\n\t\tvar knowledgeRecord = kbViewModel.knowledgeRecord;\n\t\tvar isValidRecord = kbViewModel.isValid;\n\t\tif (options.redirect_latest == 'true' && isValidRecord && knowledgeRecord && !knowledgeRecord.article_id.nil()) {\n\t\t\tvar latest = kbViewModel.getLatestAccessibleVersionFromId(knowledgeRecord.article_id);\n\t\t\tvar newVersionAvailable = !gs.nil(latest) && (latest.getValue('version')!=knowledgeRecord.getValue('version'));\n\t\t\tif(newVersionAvailable){\n\t\t\t\tdata.params.sys_kb_id = latest.getValue('sys_id');\n\t\t\t\tdata.redirect = data.params.sys_kb_id;\n\t\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t\t\tknowledgeRecord = kbViewModel.knowledgeRecord;\n\t\t\t}\n\t\t}\t\n\t\tdata.knowledgeExists = kbViewModel.knowledgeExists;\n\t\tif (isValidRecord && knowledgeRecord) {\n\t\t\tdata.isKBAdmin = kbViewModel.isAdminUser(knowledgeRecord);\n\t\t\tdata.isArticleExpired = kbViewModel.isArticleExpired(knowledgeRecord);\n\t\t\tif (data.isArticleExpired && !data.isKBAdmin) {\n\t\t\t\tdata.messages.ARTICLE_EXPIRED = gs.getMessage(\"This knowledge item has expired\");\n\t\t\t} \n\t\t\telse {data.isKBOwner = (gs.getUserID() == knowledgeRecord.kb_knowledge_base.owner);\n\t\t\t\tpopulateDataForCrawler();\n\t\t\t\tkbViewModel.setTableName(knowledgeRecord.getTableName() + \"\");\n\t\t\t\tdata.attachments = kbViewModel.getAttachments();\n\t\t\t\tpopulateMessages();\n\t\t\t\tdata.page_title = getPageTitle();\n\t\t\t\tdata.meta_tag = getMetaTag();\n\n\t\t\t\tif(data.articleType === 'wiki'){\n\t\t\t\t\tinitGlideWiki();\n\t\t\t\t}\n\n\t\t\t\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = gs.getMessage(\"You do not have sufficient privileges to access this knowledge item\");\n\t\t\tdata.messages.RECORD_NOT_FOUND = gs.getMessage(\"Knowledge record not found\");\n\t\t}\n\t}\n\t\n\telse{\n\t\n\t\tvar hasViewAsUserAccess = true;\n\t\t\n\t\tif(!gs.nil(data.params.view_as_user)){\n\t\t\tvar response = isUserAllowedToViewAs(data.params.sys_kb_id, data.params.view_as_user, data.params.extension_type);\n\t\t\t\n\t\t\tif(response.hasAccess == false){\n\t\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = response.message;\n\t\t\tdata.isValid = false;\n\t\t\tdata.knowledgeExists = true;\n\t\t\t\thasViewAsUserAccess = false;\n\t\t\t}\n\t\t}\n\t\t\t\n\t\tif(hasViewAsUserAccess){\n\t\tkbViewModel.setShowVersionHistory(options.show_version_info);\n\t\tkbViewModel.getInfoForSP(data.params);\n\n\t\tvar isValidRecord = kbViewModel.isValid;\n\t\t\tvar canAdminOverrideRedirect = ($sp.getParameter('sysparm_redirect') + '' === 'false') && kbViewModel.isAdminUser(kbViewModel.knowledgeRecord);\n\t\t\t\n\t\t\tif(isValidRecord && !canAdminOverrideRedirect) {\n\t\t\t\tvar articleIdentifier = !gs.nil(data.params.sys_kb_id) ? 'sys_kb_id' : !gs.nil(data.params.sysparm_article) ? 'sysparm_article' : 'sys_id'\n\t\t\t\tvar baseArticleURL = $sp.getPortalRecord().getDisplayValue('url_suffix') + '?id=' + $sp.getParameter('id') + '&' + articleIdentifier + '=' + data.params[articleIdentifier] + '&sysparm_redirect=false';\n\t\t\t\t\n\t\t\t\tif(kbViewModel.isAdminUser(kbViewModel.knowledgeRecord)) {\n\t\t\t\t\tdata.replacementAlert = gs.getMessage(\"The article <a href={0}>{1}</a> has been retired and replaced with the current article.\", [baseArticleURL, kbViewModel.knowledgeRecord.getValue('number')]);\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tdata.replacementAlert = gs.getMessage(\"The article {0} has been retired and replaced with the current article.\", [kbViewModel.knowledgeRecord.getValue('number')]);\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twhile(isValidRecord && kbViewModel.hasReplacementAvailable()) {\n\t\t\t\t\tif(articleIdentifier === 'sysparm_article') {\n\t\t\t\t\t\tdata.params[articleIdentifier] = kbViewModel.knowledgeRecord.getElement('replacement_article.number') + '';\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.params[articleIdentifier] = kbViewModel.knowledgeRecord.getValue('replacement_article');\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t\tdata.replacementArticleId = data.params[articleIdentifier];\n\t\t\t\t\t\n\t\t\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\t\t\tkbViewModel.setShowVersionHistory(options.show_version_info);\n\t\t\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\t\t\t\n\t\t\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\tif (options.redirect_latest == 'true' && isValidRecord && kbViewModel.knowledgeRecord && kbViewModel.versioningInfo.newVersionAvailable) {\t\n\t\t\tdata.params.sys_kb_id = kbViewModel.versioningInfo.newVersion.getValue('sys_id');\n\t\t\tdata.redirect = data.params.sys_kb_id;\n\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t}\t\n\t\t\n\t\t\tvar knowledgeRecord = kbViewModel.knowledgeRecord;\n\t\t\t\n\t\t\tif(isValidRecord && data.params.view_as_user.length > 0 && knowledgeRecord.getValue(\"view_as_allowed\") == 0)\n\t\t\t\tisValidRecord = false;\n\t\t\t\n\t\tvar kbPortal = new KBPortalService();\n\t\tdata.knowledgeExists = kbViewModel.knowledgeExists;\n\t\tdata.kb_knowledge_page = $sp.getDisplayValue(\"kb_knowledge_page\") || \"kb_view2\";\n\t\tdata.langList = [];\n\t\tvar tsQueryId = $sp.getParameter(\"sysparm_tsqueryId\");\n\t\tvar rank = $sp.getParameter(\"sysparm_rank\");\n\t\tif(tsQueryId && rank && tsQueryId != \"\"){\n\t\t\tkbViewModel.updateTsQueryKbWithRank(tsQueryId,rank);\n\t\t}\n\n\t\toptions.knowledge_bases = options.knowledge_bases || String(kbPortal.getServicePortalKnowledgeBases($sp.getPortalRecord().url_suffix)) || \"\";\n\t\t\n\t\t\n\t\tif(options.knowledge_bases && knowledgeRecord && knowledgeRecord.kb_knowledge_base ){\n\t\t\tif(options.knowledge_bases.indexOf(knowledgeRecord.kb_knowledge_base) == -1)\n\t\t\t\tisValidRecord = false;\n\t\t}\n\t\t\t\n\t\tdata.isArticleExpired = false;\n\t\t\tdata.viewAsUser = data.params.view_as_user;\n\n\t\tif (isValidRecord && knowledgeRecord) {\n\t\t\tdata.isKBAdmin = kbViewModel.isAdminUser(knowledgeRecord);\n\t\t\tdata.isArticleExpired = kbViewModel.isArticleExpired(knowledgeRecord);\n\t\t\tif (data.isArticleExpired && !data.isKBAdmin) {\n\t\t\t\tdata.messages.ARTICLE_EXPIRED = gs.getMessage(\"This knowledge item has expired\");\n\t\t\t} else {\n\t\t\t\tdata.isKBOwner = (gs.getUserID() == knowledgeRecord.kb_knowledge_base.owner);\n\t\t\t\tpopulateDataFromKBViewModel();\n\t\t\t\t// fetching default page title to support km seo\n\t\t\t\tdata.page_title = getPageTitle();\n\t\t\t\t\tdata.meta_tag = getMetaTag();\n\t\t\t\tpopulateMessages();\n\t\t\t\tpopulateCommonProperties();\n\t\t\t\tif(!isMESP){\n\t\t\t\tpopulateBreadCrumbs();\n\t\t\t\tpopulateVersionInfo();\n\t\t\t\t}\n\t\t\t\thandleViewCountIncrement();\n\t\t\t\tif(!isMESP)\n\t\t\t\tpopulateContributorInfo();\n\n\n\t\t\t\tif(data.articleType === 'wiki'){\n\t\t\t\t\tinitGlideWiki();\n\t\t\t\t}\n\n\t\t\t\tdata.sys_updated_on = \"\";\n\t\t\t\tif (kbViewModel.publishedRecord) {\n\t\t\t\t\tpublished = kbViewModel.publishedRecord.published;\n\t\t\t\t\tdata.sys_updated_on = kbViewModel.publishedRecord.sys_updated_on + \"\";\n\t\t\t\t}\n\n\t\t\t\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\n\t\t\t\tpopulateSystemProperties();\n\t\t\t\tgetFeedbackReasonValues();\n\t\t\t\tif(data.properties.showAffectedProducts === 'true' || data.properties.showAffectedProducts === true){\n\t\t\t\t\tpopulateAffectedProducts();\n\t\t\t\t}\n\n\t\t\t\tif(data.properties.showAttachedTasks === true || data.properties.showAttachedTasks === 'true'){\n\t\t\t\t\tpopulateAttachedTasks();\n\t\t\t\t}\n\n\t\t\tdata.favoriteWidget = $sp.getWidget('ec_favorite', {'table': 'kb_knowledge', 'sys_id': data.article_sys_id});\n\n\t\t\t\t$sp.logStat('KB Article View', \"kb_knowledge\", knowledgeRecord.sys_id, knowledgeRecord.short_description);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = gs.getMessage(\"You do not have sufficient privileges to access this knowledge item\");\n\t\t\tdata.messages.RECORD_NOT_FOUND = gs.getMessage(\"Knowledge record not found\");\n\t\t}\n\t}\n}\n}\n\nif(input){\n\tif(input.action === 'saveFlagComment'){\n\t\tvar kbPortal = new KBPortalService();\n\t\tvar params = {};\n\t\tparams.sysparm_id = input.article_sys_id;\n\t\tparams.feedback = input.comment;\n\t\tparams.sysparm_flag = \"true\";\n\t\tparams.ts_queryId = data.tsQueryId;\n\t\tvar response = kbPortal.kbWriteCommentWithParams(params);\n\t\tvar resp = new global.JSON().decode(response);\n\n\t\tdata.feedbackSuccess=resp.success;\n\t}\n\tif(input.action == 'createFeedbackTask'){\n\t\tvar response;\n\t\tvar kbPortal = new KBPortalService();\n\t\tvar successMessage = options.feedback_message ? options.feedback_message : gs.getMessage('Thank you, we appreciate your feedback');\n\t\tvar max_daily_comments = gs.getProperty(\"glide.knowman.max_comments_per_user_daily\",'0');\n\t\tvar failureMessage = parseInt(max_daily_comments)>0? gs.getMessage(\"You have reached the daily limit for comments posted by a user.\"):gs.getMessage('Failed to save feedback');\n\t\tvar params = buildParams();\n\t\tparams.reason = input.reason;\n\t\tparams.comments = input.details;\n\t\tif(input.feedback_action == \"useful_no\"){\n\t\t\tparams.useful = \"no\";\n\t\t\tresponse = kbPortal.saveUsefulWithParams(params) + '';\n\t\t}else if(input.feedback_action == \"rating\"){\n\t\t\tparams.rating = input.rating;\n\t\t\tresponse = kbPortal.saveStarRatingWithParams(params) + '';\n\t\t}\n\t\tdata.responseMessage = response.includes('true') ? successMessage : failureMessage;\n\t\tvar resp = new global.JSON().decode(response);\n\t\tdata.feedbackSuccess = resp.success;\n\t}\n\tif(input.action === 'subscribe'){\n\t\tvar subResult = subscribeObject('Article', input.articleSysId, gs.getUserID());\n\t\tif(subResult){\n\t\t\tdata.responseMessage = gs.getMessage(\"You are now subscribed to {0}. You will be notified of any new activity according to your notification settings.\", input.articleNum);\n\t\t}\n\t}\n\tif(input.action === 'unsubscribe'){\n\n\t\tvar subResult = false;\n\t\tif(input.unsubscribeKB){\n\t\t\tsubResult = unsubscribeObject('KB', input.articleSysId, input.kbSysId);\n\t\t\tif(subResult === 'Article'){\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscriptions to {0} Knowledge Base and {1} have been removed.\", [input.kbName, input.articleNum]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscription to {0} Knowledge Base has been removed.\", input.kbName);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tsubResult = unsubscribeObject('Article', input.articleSysId, null);\n\t\t\tif(subResult){\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscription to {0} has been removed.\", input.articleNum);\n\t\t\t}\n\t\t}\n\t}\n\n\t if(input.action == 'kbAttachArticle'){\n\t\tvar kAjax = new global.KnowledgeAjax();\n\t\tdata.articleContent = kAjax.kbAttachArticleImpl(input.value);\n\t}\n}\n\nfunction buildParams(){\n\tvar params = {};\n\tparams.article = input.article_sys_id;\n\tparams.sysparm_id = input.article_sys_id;\n\tparams.ts_queryId = data.tsQueryId;\n\tparams.session_id = gs.getSessionID();\n\tparams.user = gs.getUserID();\n\treturn params;\n}\n\nfunction subscribeObject(type, sysId, userId){\n\tvar kAjax = new global.KnowledgeAjax();\n\treturn kAjax.subscribeKbArticle(sysId, \"7d8f537453003200fa9bd7b08cc5872c\");\n}\n\nfunction unsubscribeObject(type, articleSysId, kbSysId){\n\tvar kAjax = new global.KnowledgeAjax();\n\tif(type === 'Article'){\n\t\treturn kAjax.unsubscribeKbArticle(articleSysId);\n\t}\n\telse{\n\t\treturn kAjax.unsubscribeKB(articleSysId, kbSysId);\n\t}\n}\n\nfunction populateMessages(){\n\n\tdata.messages.REASON = gs.getMessage(\"Reason\");\n\tdata.messages.DETAILS = gs.getMessage(\"Details\");\n\tdata.messages.FEEDBACK = gs.getMessage(\"Feedback\");\n\tdata.messages.THANKYOU_FEEDBACK = gs.getMessage(\"Thank you for the feedback\");\n\tdata.messages.ADDTIONAL_DETAILS = gs.getMessage(\"Please provide additional details\");\n\tdata.messages.NO_THANKS = gs.getMessage(\"No thanks\");\n\tdata.messages.ADD_DETAIL = gs.getMessage(\"Add a Detail Comment\");\n\tdata.messages.ARTICLE_FLAGGED = gs.getMessage(\"Article has been flagged\");\n\tdata.messages.FLAG_THIS_ARTICLE = gs.getMessage(\"Flag this article\");\n\tdata.messages.ADD_COMMENT = gs.getMessage(\"Add a comment (mandatory)\");\n\tdata.messages.NOT_RETIRED = gs.getMessage(\"Article not retired\");\n\tdata.messages.NOT_PUBLISHED = gs.getMessage(\"Article not published\");\n\tdata.messages.NOT_SAVED = gs.getMessage(\"Article not saved\");\n\tdata.messages.SAVED = gs.getMessage(\"Article saved\");\n\tdata.messages.HOME = gs.getMessage('Home');\n\tdata.messages.DISCARDED = gs.getMessage(\"Article changes discarded\");\n\tdata.messages.SUBMITTED = gs.getMessage(\"Your article has been submitted\");\n\tdata.messages.PREVIEW = gs.getMessage(\" Preview \");\n\tdata.messages.PREVIEW_HINT = gs.getMessage(\"Preview changes\");\n\tdata.messages.DELETE = gs.getMessage(\"Delete\");\n\tdata.messages.CONFIRM_DELETE = gs.getMessage(\"Confirm deletion of this article?\");\n\tdata.messages.TITLE_CANCEL = gs.getMessage(\"Cancel changes\");\n\tdata.messages.MESSAGE_CANCEL = gs.getMessage(\"Discard all changes?\");\n\tdata.messages.TITLE_RETIRE = gs.getMessage(\"Retire\");\n\tdata.messages.MESSAGE_RETIRE = gs.getMessage(\"Retire this article?\");\n\t// Status messages for the message bar.\n\tdata.messages.DRAFT_MSG = gs.getMessage(\"This knowledge item has been created\");\n\tdata.messages.REVIEW_MSG = gs.getMessage(\"This knowledge item has been published\");\n\tdata.messages.PUBLISHED_MSG = gs.getMessage(\"This knowledge item has been published\");\n\tdata.messages.PEND_RETIRE_MSG = gs.getMessage(\"This knowledge item has been retired\");\n\tdata.messages.RETIRED_MSG = gs.getMessage(\"This knowledge item has been retired\");\n\tdata.messages.DELETE_FAIL_MSG = gs.getMessage(\"This article could not be deleted\");\n\tdata.messages.TXT_PLACEHOLDER = gs.getMessage(\"Add content\");\n\tdata.messages.LATEST_VERSION = gs.getMessage(\"Latest version\");\n\tdata.messages.SUBSCRIBE = gs.getMessage(\"Subscribe\");\n\tdata.messages.UNSUBSCRIBE = gs.getMessage(\"Unsubscribe\");\n\tdata.messages.COPY_PERMALINK = gs.getMessage(\"Copy Permalink\");\n\tdata.messages.SUBMIT = gs.getMessage('Submit');\n\tdata.messages.COMMENTS = gs.getMessage('Comments');\n\tdata.messages.AFFECTED_PRODUCTS = gs.getMessage('Affected Products');\n\tdata.messages.OUTDATED = gs.getMessage('Outdated');\n\tdata.messages.KNOWLEDGE_BASE = gs.getMessage('Knowledge Base');\n\tdata.messages.KNOWLEDGE = gs.getMessage('Knowledge');\n\tdata.messages.ATTACHED_INCIDENTS = gs.getMessage(\"Most recent tasks\");\n\tdata.messages.THANK_YOU = gs.getMessage(\"Thank you\");\n\tdata.messages.RATE_LIMIT_REACHED = gs.getMessage(\"You have reached the daily limit for comments posted by a user.\");\n\tdata.messages.NO_ATTACHMENTS = gs.getMessage(\"No attachments found\");\n\tdata.messages.NO_INCIDENTS = gs.getMessage(\"No tasks found\");\n\tdata.messages.NO_PRODUCTS = gs.getMessage(\"No affected products found\");\n\tdata.messages.EDIT = gs.getMessage(\"Edit Article\");\n\tdata.messages.ATTACHMENTS = gs.getMessage('Attachments');\n\tdata.messages.CREATE_INCIDENT = gs.getMessage(\"Create Incident\");\n\tdata.messages.FLAG_ARTICLE = gs.getMessage(\"Flag Article\");\n\tdata.messages.PERMALINK_COPIED = gs.getMessage(\"Permalink copied successfully\");\n\tdata.messages.SUBSCRIPTION_CONFIRMATION = gs.getMessage(\"You are now subscribed to {0}. You will be notified of any new activity according to your notification settings\", data.number);\n\tdata.messages.SUBSCRIBED = gs.getMessage(\"Subscribed\");\n\tdata.messages.YES = gs.getMessage(\"Yes\");\n\tdata.messages.NO = gs.getMessage(\"No\");\n\tdata.messages.UNSUBSCRIBE_CONTENT = gs.getMessage(\"In order to unsubsrcibe from this article, you will need to unsubscribe from the parent knowledge base: {0}. \", data.kbName);\n\tdata.messages.UNSUBSCRIBE_CONFIRMATION = gs.getMessage(\"Would you like to unsubscribe from {0}\", data.kbName);\n\tdata.messages.CANCEL = gs.getMessage(\"Cancel\");\n\tdata.messages.ACTION_MENU = gs.getMessage(\"More actions.\");\n\tdata.messages.ACTION_MENU_LABEL = gs.getMessage(\"Actions\");\n\tdata.messages.CLOSE = gs.getMessage(\"Close\");\n\tdata.messages.JUST_NOW = gs.getMessage(\"just now\");\n\tdata.messages.ARTICLE_RATING = gs.getMessage(\"Average article rating - {0} out of 5 stars\", data.avgRating);\n\tdata.messages.EXTERNAL_CONTENT = gs.getMessage(gs.getProperty(\"sn_km_intg.glide.knowman.external.ui_label_for_external_content\", \"External Content\"));\n\tdata.messages.DOWNLOAD_DOCUMENT = gs.getMessage('Download as Word (.docx)');\n\tdata.messages.COLLAPSED_FIELD = gs.getMessage('section is in collapsed mode');\n\tdata.messages.EXPANDED_FIELD = gs.getMessage('section is in expanded mode');\n\t\n\tif(data.params.sysparm_kb_search_table){\n\t\tvar label = new GlideRecord(data.params.sysparm_kb_search_table).getLabel();\n\t\tif(label)\n\t\t\tdata.messages.ATTACH_TO_TASK_LABEL = gs.getMessage(\"Attach to {0}\", label);\n\t\telse\n\t\t\tdata.messages.ATTACH_TO_TASK_LABEL = gs.getMessage(\"Attach to record\");\n\t}\n}\n\nfunction populateParameters(){\n\tdata.params = {};\n\tdata.params.sysparm_article = $sp.getParameter('sysparm_article');\n\tdata.params.sysparm_language = $sp.getParameter('sysparm_language');\n\tdata.params.sys_kb_id = $sp.getParameter('sys_kb_id') || $sp.getParameter('sys_id');\n\tdata.params.sysparm_no_update = $sp.getParameter('sysparm_no_update');\n\tdata.params.sysparm_no_suggest = $sp.getParameter('sysparm_no_suggest');\n\tdata.params.sysparm_no_info = $sp.getParameter('sysparm_no_info');\n\tdata.params.sysparm_no_create_incident = $sp.getParameter('sysparm_no_create_incident');\n\tdata.params.sysparm_ts_queryId = $sp.getParameter('sysparm_tsqueryId');\n\tdata.params.sysparm_article_view_page_id = $sp.getParameter('id');\n\tdata.params.view_as_user = $sp.getParameter('view_as_user') || '';\n\tdata.params.extension_type = $sp.getParameter('extension_type') || '';\n\t\n\tif(data.params.view_as_user.length > 0)\n\t\tdata.params.override_LoggedInUser_Access = true;\n\n\tdata.params.sysparm_kb_search_table = $sp.getParameter('sysparm_kb_search_table')||'';\n}\n\nfunction populateSystemProperties(){\n\tdata.properties = {};\n\n\tdata.properties.showStarRating = getProperty(\"glide.knowman.show_star_rating\", \"show_star_rating\", true, true);\n\tdata.properties.showRatingOptions = getProperty(\"glide.knowman.show_rating_options\", \"show_rating_options\", true, true);\n\tdata.properties.showYesNoRatings = getProperty(\"glide.knowman.show_yn_rating\", \"show_yn_rating\", true, true);\n\t//data.properties.showFlagArticle = getProperty(\"glide.knowman.show_flag\", \"show_flag\", true, true);\n\t//data.properties.showFlagArticle = data.properties.showFlagArticle && !params.sysparm_no_suggest && !knowledgeRecord.disable_suggesting;\n\n\tdata.properties.showUserComments = getProperty(\"glide.knowman.show_user_feedback\", \"show_user_feedback\", 'onload');\n\tdata.properties.showAffectedProducts = gs.getProperty('glide.knowman.affected_products.display','true');\n\tdata.properties.showAttachedTasks = gs.getProperty('glide.knowman.recent_tasks.display','true');\n\n\tdata.properties.attachFields = gs.getProperty('glide.knowman.attach.fields');\n\tif(data.properties.showAttachedTasks === 'true'){\n\t\tdata.properties.showAttachedTasks = gs.hasRole('itil') || gs.hasRole('knowledge');\n\t}\n\tdata.properties.showCreateIncident = !kbViewModel.isInPopup && !data.params.sysparm_no_create_incident;\n\tdata.properties.createIncidentURL = getProperty('glide.knowman.create_incident_link', 'create_incident_link', '', false);\n\tdata.properties.isSubscriptionEnabled = kbViewModel.isSubscriptionEnabled;\n\n\n\tdata.properties.isEditable = kbViewModel.isEditable;\n\tdata.properties.showFeedBack = kbViewModel.showKBFeedback;\n\tdata.properties.showKBRatingOptions =\tkbViewModel.showKBRatingOptions;\n\n\tdata.properties.showKBHelpfullRating =\tkbViewModel.showKBHelpfullRating;\n\tdata.properties.showKBStarRating = kbViewModel.showKBStarRating;\n\n\tdata.properties.showKBCreateIncident =\tkbViewModel.showKBCreateIncident;// && !kbViewModel.isInPopup && !params.sysparm_no_create_incident;\n\tdata.properties.showKBFlagArticle = kbViewModel.showKBFlagArticle && !data.params.sysparm_no_suggest && !knowledgeRecord.disable_suggesting;\n\tdata.properties.showKBUpdateAction =\tkbViewModel.showKBUpdateAction;\n\t\n\tdata.properties.readOnlyPage = gs.getProperty('glide.knowman.contextual_search.show_read_only_article','false');\n}\nfunction getPolicyDetails(articleSysId){\n\tvar policyDetails = {};\n\tif(gs.nil(articleSysId))\n\t\treturn policyDetails;\n\n\tvar policyGR = new GlideRecord('sn_compliance_policy');\n\tpolicyGR.addQuery('kb_article', articleSysId);\n\tpolicyGR.setLimit(1);\n\tpolicyGR.query();\n\n\tif(policyGR.next()){\n\t\tpolicyDetails.number = policyGR.getDisplayValue('number');\n\t\tpolicyDetails.type = policyGR.getDisplayValue('type');\n\t\tpolicyDetails.name = policyGR.getDisplayValue('name');\n\t\tpolicyDetails.policy_category = policyGR.getDisplayValue('policy_category');\n\t\tpolicyDetails.grading_level = policyGR.getDisplayValue('u_graderingsniv');\n\t\tpolicyDetails.valid_from = policyGR.getDisplayValue('valid_from');\n\t\tpolicyDetails.approvers = policyGR.getDisplayValue('approvers');\n\t\tpolicyDetails.owner = policyGR.getDisplayValue('owner');\n\t\tpolicyDetails.state = policyGR.getDisplayValue('state');\n\t\tvar articleVersion = policyGR.getDisplayValue('kb_article.version');\n\t\tif(gs.nil(articleVersion) && knowledgeRecord)\n\t\t\tarticleVersion = knowledgeRecord.getDisplayValue('version');\n\t\tpolicyDetails.article_version = articleVersion;\n\t}\n\n\treturn policyDetails;\n}\n\nfunction getLogoDataUrl(kbRecord){\n\tvar logoDataUrl = '';\n\ttry{\n\t\tvar gsa = new GlideSysAttachment();\n\t\tvar encoder = GlideStringUtil;\n\n\t\t// Prefer the knowledge base icon from the current knowledge record\n\t\tif(kbRecord && kbRecord.kb_knowledge_base){\n\t\t\tvar kbBase = kbRecord.kb_knowledge_base;\n\t\t\tvar iconId = kbBase.icon + '';\n\t\t\tif(!gs.nil(iconId)){\n\t\t\t\t// Try reading the icon as bytes\n\t\t\t\tvar iconBytes = gsa.getBytes(iconId);\n\t\t\t\tif(iconBytes){\n\t\t\t\t\tlogoDataUrl = 'data:image/png;base64,' + encoder.base64Encode(iconBytes);\n\t\t\t\t}\n\t\t\t\t// Fallback to direct attachment URL\n\t\t\t\tif(!logoDataUrl){\n\t\t\t\t\tlogoDataUrl = '/sys_attachment.do?sys_id=' + iconId;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback: look up the policy and dot-walk to its knowledge base icon\n\t\tif(!logoDataUrl && kbRecord){\n\t\t\tvar policy = new GlideRecord('sn_compliance_policy');\n\t\t\tpolicy.addQuery('kb_article', kbRecord.sys_id);\n\t\t\tpolicy.setLimit(1);\n\t\t\tpolicy.query();\n\t\t\tif(policy.next() && policy.kb_knowledge_base){\n\t\t\t\tvar fallbackIconId = policy.kb_knowledge_base.icon + '';\n\t\t\t\tif(!gs.nil(fallbackIconId)){\n\t\t\t\t\tvar fallbackBytes = gsa.getBytes(fallbackIconId);\n\t\t\t\t\tif(fallbackBytes){\n\t\t\t\t\t\tlogoDataUrl = 'data:image/png;base64,' + encoder.base64Encode(fallbackBytes);\n\t\t\t\t\t}\n\t\t\t\t\tif(!logoDataUrl){\n\t\t\t\t\t\tlogoDataUrl = '/sys_attachment.do?sys_id=' + fallbackIconId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// No db_image fallback; rely on base64/icon or client-side inline fallback\n\t}catch(e){\n\t\t// ignore logo load failures to keep print working\n\t}\n\treturn logoDataUrl;\n}\nfunction getProperty(propertyName, optionName, defaultValue, checkRoles){\n\tvar optionVal = options[optionName];\n\tif(!optionVal || optionVal === 'use_system' || !(optionVal === 'yes' || optionVal === 'no') ){\n\t\tvar propValue = gs.getProperty(propertyName, defaultValue);\n\t\tif(propValue && checkRoles){\n\t\t\tvar roles = gs.getProperty(propertyName + '.roles');\n\t\t\tif (roles != null && roles != ''){\n\t\t\t\tpropValue = gs.hasRole(roles);\n\t\t\t}\n\t\t}\n\t\treturn propValue;\n\t}\n\telse {\n\t\treturn optionVal === 'yes' ? true : false;\n\t}\n}\n\nfunction populateCommonProperties(){\n\tdata.isMobileView = ($sp.getParameter('sysparm_device') != \"\" && $sp.getParameter('sysparm_device') == \"mobile\");\n\tdata.isKBLanguagesNewUI = GlidePluginManager.isActive('com.glideapp.knowledge.i18n2');\n\tif(data.isKBLanguagesNewUI){\n\t\tdata.langList = kbViewModel.getLanguagesToDisplay(knowledgeRecord);\n\t}\n}\n\nfunction populateDataForCrawler(){\n\tdata.isValid = true;\n\tdata.article_sys_id = knowledgeRecord.sys_id + '';\n\tdata.kbContentData = kbViewModel.getArticleViewData();//.getArticleContentBySysId(data.article_sys_id);\n\tdata.number = knowledgeRecord.number + '';\n\tdata.articleType = knowledgeRecord.article_type + '';\n\tdata.attachments = kbViewModel.attachments;\n\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\tdata.authorUserName = knowledgeRecord.getDisplayValue('author.user_name');\n\tdata.authorDepartment = knowledgeRecord.getDisplayValue('author.department');\n\tdata.authorEmail = knowledgeRecord.getDisplayValue('author.email');\n\tdata.policyInfo = getPolicyDetails(knowledgeRecord.sys_id + '');\n\tdata.logoDataUrl = getLogoDataUrl(knowledgeRecord);\n\tdata.displayAttachments = knowledgeRecord.display_attachments + '';\n\tdata.kbSysId = knowledgeRecord.kb_knowledge_base.sys_id + '';\n\tdata.hasComments = false;\n\tdata.tableName = knowledgeRecord.sys_class_name + '';\n}\n\nfunction populateDataFromKBViewModel(){\n\tdata.isValid = true;\n\tdata.isLoggedInUser = gs.getSession().isLoggedIn();\n\tdata.canContributeToKnowledge = kbViewModel.canContributeToKnowledgeBase; //canContributeHelper.canContribute(kbViewModel.knowledgeRecord);\n\tdata.article_sys_id = knowledgeRecord.sys_id + '';\n\tdata.authorTitle = kbViewModel.authorTitle || kbViewModel.getAuthorInfo(\"author.title\");\n\tdata.authorUserName = knowledgeRecord.getDisplayValue('author.user_name');\n\tdata.authorDepartment = knowledgeRecord.getDisplayValue('author.department');\n\tdata.authorEmail = knowledgeRecord.getDisplayValue('author.email');\n\tdata.policyInfo = getPolicyDetails(knowledgeRecord.sys_id + '');\n\tdata.logoDataUrl = getLogoDataUrl(knowledgeRecord);\n\tdata.kbContentData = kbViewModel.getArticleViewData();\n\tdata.avgRating = Math.round(knowledgeRecord.rating);\n\tdata.number = knowledgeRecord.number + '';\n\tdata.articleType = knowledgeRecord.article_type + '';\n\tdata.permalink = kbViewModel.permalink;\n\tdata.category = knowledgeRecord.category;\n\tdata.attachments = kbViewModel.attachments;\n\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\tdata.viewCount = knowledgeRecord.getDisplayValue('sys_view_count');\n\tdata.displayAttachments = knowledgeRecord.display_attachments + '';\n\tdata.tableName = knowledgeRecord.sys_class_name + '';\n\tdata.disableSuggesting = knowledgeRecord.disable_suggesting;\n\tdata.revisionString = kbViewModel.revisionString;\n\tdata.articleTemplate = kbViewModel.articleTemplateName;\n\tdata.isSubscriptionEnabled = kbViewModel.isSubscriptionEnabled;\n\tdata.helpfulContent = kbViewModel.helpfulText;\n\tif(data.isSubscriptionEnabled === true && !isMESP){\n\t\tdata.isArticleSubscribed = (new global.ActivitySubscriptionContext().getSubscriptionService().isSubscribed(knowledgeRecord.sys_id).subscriptionId) ? true : false;//kbViewModel.isArticleSubscribed;\n\t\tdata.isArticleSubscribedAtKB = (new global.ActivitySubscriptionContext().getSubscriptionService().isSubscribed(knowledgeRecord.kb_knowledge_base).subscriptionId) ? true : false;//kbViewModel.isArticleSubsrcibedAtKB;\n\t}\n\telse{\n\t\tdata.isArticleSubscribed = false;\n\t\tdata.isArticleSubscribedAtKB = false;\n\t}\n\n\tdata.kbSysId = knowledgeRecord.kb_knowledge_base.sys_id + '';\n\tdata.kbName = knowledgeRecord.kb_knowledge_base.getDisplayValue() + '';\n\tdata.externalArticle = kbViewModel.externalArticle;\n\tdata.hasComments = !kbViewModel.feedbackEntryInitialDisplay;\n\tdata.isTaskTable = data.params.sysparm_kb_search_table ? kbViewModel.isTaskTable(data.params.sysparm_kb_search_table) : false;\n\tdata.kbDocSysId = kbViewModel.kbDocSysId;\n\tdata.wordOnlineUrl = kbViewModel.wordOnlineUrl;\n\n}\n\nfunction populateBreadCrumbs(){\n\tvar breadCrumb = kbViewModel.getBreadcrumb();\n\tdata.breadCrumb = [];\n\tdata.breadCrumb.push({label: knowledgeRecord.kb_knowledge_base.title + ' (' + data.messages.KNOWLEDGE_BASE + ')', type: 'kb_knowledge_base', values: {kb_knowledge_base: knowledgeRecord.kb_knowledge_base.sys_id + ''}});\n\tvar ctg = '';\n\tfor(var i = 0; i < breadCrumb.length; i++){\n\t\tctg += breadCrumb[i].name;\n\t\tif(i != breadCrumb.length - 1){\n\t\t\tctg += ' - ';\n\t\t}\n\t}\n\tif(ctg !== '' && breadCrumb && breadCrumb.length > 0){\n\t\tdata.breadCrumb.push({label: ctg + '', type: 'kb_category', values: {kb_knowledge_base: breadCrumb[breadCrumb.length - 1].knowledge_base + '', kb_category:  breadCrumb[breadCrumb.length - 1].value + ''}});\n\t}\n}\n\nfunction handleViewCountIncrement(){\n\tvar incrementedViewCount = new global.KBViewModel().incrementAndReturnKBView(knowledgeRecord);\n\tif(incrementedViewCount)\n\t\tdata.viewCount = parseInt(incrementedViewCount);\n}\n\nfunction initGlideWiki(){\n\ttry{\n\t\tdata.kbWiki = kbViewModel.getWikiContent();\n\t}\n\tcatch(e){\n\t\tdata.kbWiki = '';\n\t}\n}\n\nfunction populateAttachedTasks(){\n\tdata.attachedIncidents = [];\n\tdata.attachedIncidents = kbViewModel.getAttachedTasks();\n}\n\nfunction populateAffectedProducts(){\n\tdata.affectedProducts = [];\n\tdata.affectedProducts = kbViewModel.getAffectedProducts();\n}\n\nfunction populateVersionInfo(){\n\tdata.isVersioningEnabled = kbViewModel.versioningInfo.isEnabled;\n\tdata.versionList = kbViewModel.versioningInfo.history;\n\tdata.version = knowledgeRecord.getDisplayValue('version');\n\tdata.isLatestVersion = !(kbViewModel.versioningInfo.newVersionAvailable === true);\n\tdata.workflowState = (knowledgeRecord.workflow_state != 'published') ? ('(' + knowledgeRecord.workflow_state.getDisplayValue() + ')') : '';\n\tdata.versionInfo = kbViewModel.versioningInfo.versionDisplay;//((kbViewModel.versioningInfo.newVersionAvailable === true) ? 'v' + data.version  : data.messages.LATEST_VERSION);\n\tdata.versionInfoLabel = kbViewModel.versioningInfo.versionDisplayLabel;\n\tdata.showHistory = kbViewModel.versioningInfo.showHistory;\n\tdata.hideFeedbackOptions = kbViewModel.hideFeedbackOptions;\n\tdata.versionWarningMessage = kbViewModel.versioningInfo.warningMessage;\n\tif(data.versionWarningMessage){\n\t\tdata.versionWarningMessage = data.versionWarningMessage.replace('kb_view.do?', '?id='+data.params.sysparm_article_view_page_id+'&');\n\t}\n}\n\n\nfunction populateContributorInfo(){\n\tif(!GlidePluginManager.isActive('com.sn_communities')) return;\n\tif(sn_communities.CommunityKnowledgeHarvest){\n\t\tvar h = new sn_communities.CommunityKnowledgeHarvest();\n\t\tvar res = h.getHarvestedContentInfo(''+knowledgeRecord.sys_id);\n\t\tif(res && res.status == 200){\n\t\t\tdata.hInfo = res.data;\n\t\t\tif(data.hInfo){\n\t\t\t\tvar message = gs.getMessage(\"Created from the Community by {0}\");\n\t\t\t\tvar contributor = data.hInfo.contributor;\n\t\t\t\tvar profile = gs.getMessage('Community user');\n\t\t\t\tif(contributor){\n\t\t\t\t\tprofile = contributor.name.length > 0 ? contributor.name : profile;\n\t\t\t\t\tif(contributor.userId)\n\t\t\t\t\t\tprofile = '<a href=\"?id=community_user_profile&user='+contributor.userId+'\" target=\"_blank_cm1\" >'+profile+'</a>';\n\t\t\t\t}\n\t\t\t\tmessage = message.replace('{0}', profile);\n\t\t\t\tdata.hInfo.profileMessage = message;\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nfunction getFeedbackReasonValues(){\n\tdata.feedback_reasons=[];\n\tvar kbFbTask = new global.KBFeedbackTask();\n\tvar response = kbFbTask.getReasonValues();\n\tif(response){\n\t\tdata.feedback_reasons = new global.JSON().decode(response);\n\t}\n}\n\nfunction getPageTitle() {\n\n\tvar title = gs.getMessage(\"Knowledge Article View\");\n\n\tif (!gs.nil(data.article_sys_id)) // kb record found\n\t\ttitle = knowledgeRecord.kb_knowledge_base.getDisplayValue() + \" - \" + data.shortDesc; // kb name - kb short_desc\n\telse if (!gs.nil(data.params.sysparm_article_view_page_id)) {\n\t\t// kb record NOT found - fetching the kb_article_view portal page title\n\t\tvar kbPage = new GlideRecord('sp_page');\n\t\tkbPage.addQuery(\"id\",data.params.sysparm_article_view_page_id+\"\");\n\t\tkbPage.query();\n\t\tif(kbPage.next())\n\t\t\ttitle = kbPage.getValue('title');\n\t}\n\n\treturn title;\n}\n\nfunction getMetaTag() {\n\n\tvar content = '';\n\n\t// kb record found\n\tif (!gs.nil(data.article_sys_id)){\n\t\tcontent = knowledgeRecord.kb_knowledge_base.getDisplayValue() + \" - \"\n\t\t\t+ knowledgeRecord.kb_category.getDisplayValue() + \" - \"\n\t\t\t+ knowledgeRecord.meta_description.getDisplayValue();\n\t}\n\treturn content;\n}\n\nfunction isUserAllowedToViewAs(articleSysId, userId, extensionType){\n\treturn new KBPortalService().isUserAllowedToViewAs(userId, extensionType, articleSysId);\n}\n",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "data.tsQueryId = $sp.getParameter(\"sysparm_tsqueryId\") || \"\";\nvar isMESP = (options.is_mobile && options.is_mobile == \"true\") || ($sp.getParameter(\"id\") == \"me_kb_view\") || false;\ndata.isMESP = isMESP;\noptions.kb_rating_style = options.kb_rating_style ? options.kb_rating_style == \"true\" : true;\nvar portalRecord = $sp.getPortalRecord();\nvar portal = portalRecord.getUniqueValue();\ndata.showKbHomeLink = (portal != '45d6680fdb52220099f93691f0b8f5ad');\n\nif(!input){\n\tvar kbViewModel = new global.KBViewModel();\n\tdata.isCrawlerBot = kbViewModel.checkCrawlerBot();\n\tdata.messages = {};\n\tpopulateParameters();\n\n\tif(data.isCrawlerBot){\n\t\tkbViewModel.findKnowledgeById(GlideAppCache.get(\"articleSysId\"));\n\t\tvar knowledgeRecord = kbViewModel.knowledgeRecord;\n\t\tvar isValidRecord = kbViewModel.isValid;\n\t\tif (options.redirect_latest == 'true' && isValidRecord && knowledgeRecord && !knowledgeRecord.article_id.nil()) {\n\t\t\tvar latest = kbViewModel.getLatestAccessibleVersionFromId(knowledgeRecord.article_id);\n\t\t\tvar newVersionAvailable = !gs.nil(latest) && (latest.getValue('version')!=knowledgeRecord.getValue('version'));\n\t\t\tif(newVersionAvailable){\n\t\t\t\tdata.params.sys_kb_id = latest.getValue('sys_id');\n\t\t\t\tdata.redirect = data.params.sys_kb_id;\n\t\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t\t\tknowledgeRecord = kbViewModel.knowledgeRecord;\n\t\t\t}\n\t\t}\t\n\t\tdata.knowledgeExists = kbViewModel.knowledgeExists;\n\t\tif (isValidRecord && knowledgeRecord) {\n\t\t\tdata.isKBAdmin = kbViewModel.isAdminUser(knowledgeRecord);\n\t\t\tdata.isArticleExpired = kbViewModel.isArticleExpired(knowledgeRecord);\n\t\t\tif (data.isArticleExpired && !data.isKBAdmin) {\n\t\t\t\tdata.messages.ARTICLE_EXPIRED = gs.getMessage(\"This knowledge item has expired\");\n\t\t\t} \n\t\t\telse {data.isKBOwner = (gs.getUserID() == knowledgeRecord.kb_knowledge_base.owner);\n\t\t\t\tpopulateDataForCrawler();\n\t\t\t\tkbViewModel.setTableName(knowledgeRecord.getTableName() + \"\");\n\t\t\t\tdata.attachments = kbViewModel.getAttachments();\n\t\t\t\tpopulateMessages();\n\t\t\t\tdata.page_title = getPageTitle();\n\t\t\t\tdata.meta_tag = getMetaTag();\n\n\t\t\t\tif(data.articleType === 'wiki'){\n\t\t\t\t\tinitGlideWiki();\n\t\t\t\t}\n\n\t\t\t\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = gs.getMessage(\"You do not have sufficient privileges to access this knowledge item\");\n\t\t\tdata.messages.RECORD_NOT_FOUND = gs.getMessage(\"Knowledge record not found\");\n\t\t}\n\t}\n\t\n\telse{\n\t\n\t\tvar hasViewAsUserAccess = true;\n\t\t\n\t\tif(!gs.nil(data.params.view_as_user)){\n\t\t\tvar response = isUserAllowedToViewAs(data.params.sys_kb_id, data.params.view_as_user, data.params.extension_type);\n\t\t\t\n\t\t\tif(response.hasAccess == false){\n\t\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = response.message;\n\t\t\tdata.isValid = false;\n\t\t\tdata.knowledgeExists = true;\n\t\t\t\thasViewAsUserAccess = false;\n\t\t\t}\n\t\t}\n\t\t\t\n\t\tif(hasViewAsUserAccess){\n\t\tkbViewModel.setShowVersionHistory(options.show_version_info);\n\t\tkbViewModel.getInfoForSP(data.params);\n\n\t\tvar isValidRecord = kbViewModel.isValid;\n\t\t\tvar canAdminOverrideRedirect = ($sp.getParameter('sysparm_redirect') + '' === 'false') && kbViewModel.isAdminUser(kbViewModel.knowledgeRecord);\n\t\t\t\n\t\t\tif(isValidRecord && !canAdminOverrideRedirect) {\n\t\t\t\tvar articleIdentifier = !gs.nil(data.params.sys_kb_id) ? 'sys_kb_id' : !gs.nil(data.params.sysparm_article) ? 'sysparm_article' : 'sys_id'\n\t\t\t\tvar baseArticleURL = $sp.getPortalRecord().getDisplayValue('url_suffix') + '?id=' + $sp.getParameter('id') + '&' + articleIdentifier + '=' + data.params[articleIdentifier] + '&sysparm_redirect=false';\n\t\t\t\t\n\t\t\t\tif(kbViewModel.isAdminUser(kbViewModel.knowledgeRecord)) {\n\t\t\t\t\tdata.replacementAlert = gs.getMessage(\"The article <a href={0}>{1}</a> has been retired and replaced with the current article.\", [baseArticleURL, kbViewModel.knowledgeRecord.getValue('number')]);\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tdata.replacementAlert = gs.getMessage(\"The article {0} has been retired and replaced with the current article.\", [kbViewModel.knowledgeRecord.getValue('number')]);\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twhile(isValidRecord && kbViewModel.hasReplacementAvailable()) {\n\t\t\t\t\tif(articleIdentifier === 'sysparm_article') {\n\t\t\t\t\t\tdata.params[articleIdentifier] = kbViewModel.knowledgeRecord.getElement('replacement_article.number') + '';\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.params[articleIdentifier] = kbViewModel.knowledgeRecord.getValue('replacement_article');\t\t\t\t\t\t\n\t\t\t\t\t}\n\n\t\t\t\t\tdata.replacementArticleId = data.params[articleIdentifier];\n\t\t\t\t\t\n\t\t\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\t\t\tkbViewModel.setShowVersionHistory(options.show_version_info);\n\t\t\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\t\t\t\n\t\t\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\tif (options.redirect_latest == 'true' && isValidRecord && kbViewModel.knowledgeRecord && kbViewModel.versioningInfo.newVersionAvailable) {\t\n\t\t\tdata.params.sys_kb_id = kbViewModel.versioningInfo.newVersion.getValue('sys_id');\n\t\t\tdata.redirect = data.params.sys_kb_id;\n\t\t\tkbViewModel = new global.KBViewModel();\n\t\t\tkbViewModel.getInfoForSP(data.params);\n\t\t\tisValidRecord = kbViewModel.isValid;\n\t\t}\t\n\t\t\n\t\t\tvar knowledgeRecord = kbViewModel.knowledgeRecord;\n\t\t\t\n\t\t\tif(isValidRecord && data.params.view_as_user.length > 0 && knowledgeRecord.getValue(\"view_as_allowed\") == 0)\n\t\t\t\tisValidRecord = false;\n\t\t\t\n\t\tvar kbPortal = new KBPortalService();\n\t\tdata.knowledgeExists = kbViewModel.knowledgeExists;\n\t\tdata.kb_knowledge_page = $sp.getDisplayValue(\"kb_knowledge_page\") || \"kb_view2\";\n\t\tdata.langList = [];\n\t\tvar tsQueryId = $sp.getParameter(\"sysparm_tsqueryId\");\n\t\tvar rank = $sp.getParameter(\"sysparm_rank\");\n\t\tif(tsQueryId && rank && tsQueryId != \"\"){\n\t\t\tkbViewModel.updateTsQueryKbWithRank(tsQueryId,rank);\n\t\t}\n\n\t\toptions.knowledge_bases = options.knowledge_bases || String(kbPortal.getServicePortalKnowledgeBases($sp.getPortalRecord().url_suffix)) || \"\";\n\t\t\n\t\t\n\t\tif(options.knowledge_bases && knowledgeRecord && knowledgeRecord.kb_knowledge_base ){\n\t\t\tif(options.knowledge_bases.indexOf(knowledgeRecord.kb_knowledge_base) == -1)\n\t\t\t\tisValidRecord = false;\n\t\t}\n\t\t\t\n\t\tdata.isArticleExpired = false;\n\t\t\tdata.viewAsUser = data.params.view_as_user;\n\n\t\tif (isValidRecord && knowledgeRecord) {\n\t\t\tdata.isKBAdmin = kbViewModel.isAdminUser(knowledgeRecord);\n\t\t\tdata.isArticleExpired = kbViewModel.isArticleExpired(knowledgeRecord);\n\t\t\tif (data.isArticleExpired && !data.isKBAdmin) {\n\t\t\t\tdata.messages.ARTICLE_EXPIRED = gs.getMessage(\"This knowledge item has expired\");\n\t\t\t} else {\n\t\t\t\tdata.isKBOwner = (gs.getUserID() == knowledgeRecord.kb_knowledge_base.owner);\n\t\t\t\tpopulateDataFromKBViewModel();\n\t\t\t\t// fetching default page title to support km seo\n\t\t\t\tdata.page_title = getPageTitle();\n\t\t\t\t\tdata.meta_tag = getMetaTag();\n\t\t\t\tpopulateMessages();\n\t\t\t\tpopulateCommonProperties();\n\t\t\t\tif(!isMESP){\n\t\t\t\tpopulateBreadCrumbs();\n\t\t\t\tpopulateVersionInfo();\n\t\t\t\t}\n\t\t\t\thandleViewCountIncrement();\n\t\t\t\tif(!isMESP)\n\t\t\t\tpopulateContributorInfo();\n\n\n\t\t\t\tif(data.articleType === 'wiki'){\n\t\t\t\t\tinitGlideWiki();\n\t\t\t\t}\n\n\t\t\t\tdata.sys_updated_on = \"\";\n\t\t\t\tif (kbViewModel.publishedRecord) {\n\t\t\t\t\tpublished = kbViewModel.publishedRecord.published;\n\t\t\t\t\tdata.sys_updated_on = kbViewModel.publishedRecord.sys_updated_on + \"\";\n\t\t\t\t}\n\n\t\t\t\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\n\t\t\t\tpopulateSystemProperties();\n\t\t\t\tgetFeedbackReasonValues();\n\t\t\t\tif(data.properties.showAffectedProducts === 'true' || data.properties.showAffectedProducts === true){\n\t\t\t\t\tpopulateAffectedProducts();\n\t\t\t\t}\n\n\t\t\t\tif(data.properties.showAttachedTasks === true || data.properties.showAttachedTasks === 'true'){\n\t\t\t\t\tpopulateAttachedTasks();\n\t\t\t\t}\n\n\t\t\tdata.favoriteWidget = $sp.getWidget('ec_favorite', {'table': 'kb_knowledge', 'sys_id': data.article_sys_id});\n\n\t\t\t\t$sp.logStat('KB Article View', \"kb_knowledge\", knowledgeRecord.sys_id, knowledgeRecord.short_description);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tdata.messages.INSUFFICIENT_PREVILEGES = gs.getMessage(\"You do not have sufficient privileges to access this knowledge item\");\n\t\t\tdata.messages.RECORD_NOT_FOUND = gs.getMessage(\"Knowledge record not found\");\n\t\t}\n\t}\n}\n}\n\nif(input){\n\tif(input.action === 'saveFlagComment'){\n\t\tvar kbPortal = new KBPortalService();\n\t\tvar params = {};\n\t\tparams.sysparm_id = input.article_sys_id;\n\t\tparams.feedback = input.comment;\n\t\tparams.sysparm_flag = \"true\";\n\t\tparams.ts_queryId = data.tsQueryId;\n\t\tvar response = kbPortal.kbWriteCommentWithParams(params);\n\t\tvar resp = new global.JSON().decode(response);\n\n\t\tdata.feedbackSuccess=resp.success;\n\t}\n\tif(input.action == 'createFeedbackTask'){\n\t\tvar response;\n\t\tvar kbPortal = new KBPortalService();\n\t\tvar successMessage = options.feedback_message ? options.feedback_message : gs.getMessage('Thank you, we appreciate your feedback');\n\t\tvar max_daily_comments = gs.getProperty(\"glide.knowman.max_comments_per_user_daily\",'0');\n\t\tvar failureMessage = parseInt(max_daily_comments)>0? gs.getMessage(\"You have reached the daily limit for comments posted by a user.\"):gs.getMessage('Failed to save feedback');\n\t\tvar params = buildParams();\n\t\tparams.reason = input.reason;\n\t\tparams.comments = input.details;\n\t\tif(input.feedback_action == \"useful_no\"){\n\t\t\tparams.useful = \"no\";\n\t\t\tresponse = kbPortal.saveUsefulWithParams(params) + '';\n\t\t}else if(input.feedback_action == \"rating\"){\n\t\t\tparams.rating = input.rating;\n\t\t\tresponse = kbPortal.saveStarRatingWithParams(params) + '';\n\t\t}\n\t\tdata.responseMessage = response.includes('true') ? successMessage : failureMessage;\n\t\tvar resp = new global.JSON().decode(response);\n\t\tdata.feedbackSuccess = resp.success;\n\t}\n\tif(input.action === 'subscribe'){\n\t\tvar subResult = subscribeObject('Article', input.articleSysId, gs.getUserID());\n\t\tif(subResult){\n\t\t\tdata.responseMessage = gs.getMessage(\"You are now subscribed to {0}. You will be notified of any new activity according to your notification settings.\", input.articleNum);\n\t\t}\n\t}\n\tif(input.action === 'unsubscribe'){\n\n\t\tvar subResult = false;\n\t\tif(input.unsubscribeKB){\n\t\t\tsubResult = unsubscribeObject('KB', input.articleSysId, input.kbSysId);\n\t\t\tif(subResult === 'Article'){\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscriptions to {0} Knowledge Base and {1} have been removed.\", [input.kbName, input.articleNum]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscription to {0} Knowledge Base has been removed.\", input.kbName);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tsubResult = unsubscribeObject('Article', input.articleSysId, null);\n\t\t\tif(subResult){\n\t\t\t\tdata.responseMessage = gs.getMessage(\"Your subscription to {0} has been removed.\", input.articleNum);\n\t\t\t}\n\t\t}\n\t}\n\n\t if(input.action == 'kbAttachArticle'){\n\t\tvar kAjax = new global.KnowledgeAjax();\n\t\tdata.articleContent = kAjax.kbAttachArticleImpl(input.value);\n\t}\n}\n\nfunction buildParams(){\n\tvar params = {};\n\tparams.article = input.article_sys_id;\n\tparams.sysparm_id = input.article_sys_id;\n\tparams.ts_queryId = data.tsQueryId;\n\tparams.session_id = gs.getSessionID();\n\tparams.user = gs.getUserID();\n\treturn params;\n}\n\nfunction subscribeObject(type, sysId, userId){\n\tvar kAjax = new global.KnowledgeAjax();\n\treturn kAjax.subscribeKbArticle(sysId, \"7d8f537453003200fa9bd7b08cc5872c\");\n}\n\nfunction unsubscribeObject(type, articleSysId, kbSysId){\n\tvar kAjax = new global.KnowledgeAjax();\n\tif(type === 'Article'){\n\t\treturn kAjax.unsubscribeKbArticle(articleSysId);\n\t}\n\telse{\n\t\treturn kAjax.unsubscribeKB(articleSysId, kbSysId);\n\t}\n}\n\nfunction populateMessages(){\n\n\tdata.messages.REASON = gs.getMessage(\"Reason\");\n\tdata.messages.DETAILS = gs.getMessage(\"Details\");\n\tdata.messages.FEEDBACK = gs.getMessage(\"Feedback\");\n\tdata.messages.THANKYOU_FEEDBACK = gs.getMessage(\"Thank you for the feedback\");\n\tdata.messages.ADDTIONAL_DETAILS = gs.getMessage(\"Please provide additional details\");\n\tdata.messages.NO_THANKS = gs.getMessage(\"No thanks\");\n\tdata.messages.ADD_DETAIL = gs.getMessage(\"Add a Detail Comment\");\n\tdata.messages.ARTICLE_FLAGGED = gs.getMessage(\"Article has been flagged\");\n\tdata.messages.FLAG_THIS_ARTICLE = gs.getMessage(\"Flag this article\");\n\tdata.messages.ADD_COMMENT = gs.getMessage(\"Add a comment (mandatory)\");\n\tdata.messages.NOT_RETIRED = gs.getMessage(\"Article not retired\");\n\tdata.messages.NOT_PUBLISHED = gs.getMessage(\"Article not published\");\n\tdata.messages.NOT_SAVED = gs.getMessage(\"Article not saved\");\n\tdata.messages.SAVED = gs.getMessage(\"Article saved\");\n\tdata.messages.HOME = gs.getMessage('Home');\n\tdata.messages.DISCARDED = gs.getMessage(\"Article changes discarded\");\n\tdata.messages.SUBMITTED = gs.getMessage(\"Your article has been submitted\");\n\tdata.messages.PREVIEW = gs.getMessage(\" Preview \");\n\tdata.messages.PREVIEW_HINT = gs.getMessage(\"Preview changes\");\n\tdata.messages.DELETE = gs.getMessage(\"Delete\");\n\tdata.messages.CONFIRM_DELETE = gs.getMessage(\"Confirm deletion of this article?\");\n\tdata.messages.TITLE_CANCEL = gs.getMessage(\"Cancel changes\");\n\tdata.messages.MESSAGE_CANCEL = gs.getMessage(\"Discard all changes?\");\n\tdata.messages.TITLE_RETIRE = gs.getMessage(\"Retire\");\n\tdata.messages.MESSAGE_RETIRE = gs.getMessage(\"Retire this article?\");\n\t// Status messages for the message bar.\n\tdata.messages.DRAFT_MSG = gs.getMessage(\"This knowledge item has been created\");\n\tdata.messages.REVIEW_MSG = gs.getMessage(\"This knowledge item has been published\");\n\tdata.messages.PUBLISHED_MSG = gs.getMessage(\"This knowledge item has been published\");\n\tdata.messages.PEND_RETIRE_MSG = gs.getMessage(\"This knowledge item has been retired\");\n\tdata.messages.RETIRED_MSG = gs.getMessage(\"This knowledge item has been retired\");\n\tdata.messages.DELETE_FAIL_MSG = gs.getMessage(\"This article could not be deleted\");\n\tdata.messages.TXT_PLACEHOLDER = gs.getMessage(\"Add content\");\n\tdata.messages.LATEST_VERSION = gs.getMessage(\"Latest version\");\n\tdata.messages.SUBSCRIBE = gs.getMessage(\"Subscribe\");\n\tdata.messages.UNSUBSCRIBE = gs.getMessage(\"Unsubscribe\");\n\tdata.messages.COPY_PERMALINK = gs.getMessage(\"Copy Permalink\");\n\tdata.messages.SUBMIT = gs.getMessage('Submit');\n\tdata.messages.COMMENTS = gs.getMessage('Comments');\n\tdata.messages.AFFECTED_PRODUCTS = gs.getMessage('Affected Products');\n\tdata.messages.OUTDATED = gs.getMessage('Outdated');\n\tdata.messages.KNOWLEDGE_BASE = gs.getMessage('Knowledge Base');\n\tdata.messages.KNOWLEDGE = gs.getMessage('Knowledge');\n\tdata.messages.ATTACHED_INCIDENTS = gs.getMessage(\"Most recent tasks\");\n\tdata.messages.THANK_YOU = gs.getMessage(\"Thank you\");\n\tdata.messages.RATE_LIMIT_REACHED = gs.getMessage(\"You have reached the daily limit for comments posted by a user.\");\n\tdata.messages.NO_ATTACHMENTS = gs.getMessage(\"No attachments found\");\n\tdata.messages.NO_INCIDENTS = gs.getMessage(\"No tasks found\");\n\tdata.messages.NO_PRODUCTS = gs.getMessage(\"No affected products found\");\n\tdata.messages.EDIT = gs.getMessage(\"Edit Article\");\n\tdata.messages.ATTACHMENTS = gs.getMessage('Attachments');\n\tdata.messages.CREATE_INCIDENT = gs.getMessage(\"Create Incident\");\n\tdata.messages.FLAG_ARTICLE = gs.getMessage(\"Flag Article\");\n\tdata.messages.PERMALINK_COPIED = gs.getMessage(\"Permalink copied successfully\");\n\tdata.messages.SUBSCRIPTION_CONFIRMATION = gs.getMessage(\"You are now subscribed to {0}. You will be notified of any new activity according to your notification settings\", data.number);\n\tdata.messages.SUBSCRIBED = gs.getMessage(\"Subscribed\");\n\tdata.messages.YES = gs.getMessage(\"Yes\");\n\tdata.messages.NO = gs.getMessage(\"No\");\n\tdata.messages.UNSUBSCRIBE_CONTENT = gs.getMessage(\"In order to unsubsrcibe from this article, you will need to unsubscribe from the parent knowledge base: {0}. \", data.kbName);\n\tdata.messages.UNSUBSCRIBE_CONFIRMATION = gs.getMessage(\"Would you like to unsubscribe from {0}\", data.kbName);\n\tdata.messages.CANCEL = gs.getMessage(\"Cancel\");\n\tdata.messages.ACTION_MENU = gs.getMessage(\"More actions.\");\n\tdata.messages.ACTION_MENU_LABEL = gs.getMessage(\"Actions\");\n\tdata.messages.CLOSE = gs.getMessage(\"Close\");\n\tdata.messages.JUST_NOW = gs.getMessage(\"just now\");\n\tdata.messages.ARTICLE_RATING = gs.getMessage(\"Average article rating - {0} out of 5 stars\", data.avgRating);\n\tdata.messages.EXTERNAL_CONTENT = gs.getMessage(gs.getProperty(\"sn_km_intg.glide.knowman.external.ui_label_for_external_content\", \"External Content\"));\n\tdata.messages.DOWNLOAD_DOCUMENT = gs.getMessage('Download as Word (.docx)');\n\tdata.messages.COLLAPSED_FIELD = gs.getMessage('section is in collapsed mode');\n\tdata.messages.EXPANDED_FIELD = gs.getMessage('section is in expanded mode');\n\t\n\tif(data.params.sysparm_kb_search_table){\n\t\tvar label = new GlideRecord(data.params.sysparm_kb_search_table).getLabel();\n\t\tif(label)\n\t\t\tdata.messages.ATTACH_TO_TASK_LABEL = gs.getMessage(\"Attach to {0}\", label);\n\t\telse\n\t\t\tdata.messages.ATTACH_TO_TASK_LABEL = gs.getMessage(\"Attach to record\");\n\t}\n}\n\nfunction populateParameters(){\n\tdata.params = {};\n\tdata.params.sysparm_article = $sp.getParameter('sysparm_article');\n\tdata.params.sysparm_language = $sp.getParameter('sysparm_language');\n\tdata.params.sys_kb_id = $sp.getParameter('sys_kb_id') || $sp.getParameter('sys_id');\n\tdata.params.sysparm_no_update = $sp.getParameter('sysparm_no_update');\n\tdata.params.sysparm_no_suggest = $sp.getParameter('sysparm_no_suggest');\n\tdata.params.sysparm_no_info = $sp.getParameter('sysparm_no_info');\n\tdata.params.sysparm_no_create_incident = $sp.getParameter('sysparm_no_create_incident');\n\tdata.params.sysparm_ts_queryId = $sp.getParameter('sysparm_tsqueryId');\n\tdata.params.sysparm_article_view_page_id = $sp.getParameter('id');\n\tdata.params.view_as_user = $sp.getParameter('view_as_user') || '';\n\tdata.params.extension_type = $sp.getParameter('extension_type') || '';\n\t\n\tif(data.params.view_as_user.length > 0)\n\t\tdata.params.override_LoggedInUser_Access = true;\n\n\tdata.params.sysparm_kb_search_table = $sp.getParameter('sysparm_kb_search_table')||'';\n}\n\nfunction populateSystemProperties(){\n\tdata.properties = {};\n\n\tdata.properties.showStarRating = getProperty(\"glide.knowman.show_star_rating\", \"show_star_rating\", true, true);\n\tdata.properties.showRatingOptions = getProperty(\"glide.knowman.show_rating_options\", \"show_rating_options\", true, true);\n\tdata.properties.showYesNoRatings = getProperty(\"glide.knowman.show_yn_rating\", \"show_yn_rating\", true, true);\n\t//data.properties.showFlagArticle = getProperty(\"glide.knowman.show_flag\", \"show_flag\", true, true);\n\t//data.properties.showFlagArticle = data.properties.showFlagArticle && !params.sysparm_no_suggest && !knowledgeRecord.disable_suggesting;\n\n\tdata.properties.showUserComments = getProperty(\"glide.knowman.show_user_feedback\", \"show_user_feedback\", 'onload');\n\tdata.properties.showAffectedProducts = gs.getProperty('glide.knowman.affected_products.display','true');\n\tdata.properties.showAttachedTasks = gs.getProperty('glide.knowman.recent_tasks.display','true');\n\n\tdata.properties.attachFields = gs.getProperty('glide.knowman.attach.fields');\n\tif(data.properties.showAttachedTasks === 'true'){\n\t\tdata.properties.showAttachedTasks = gs.hasRole('itil') || gs.hasRole('knowledge');\n\t}\n\tdata.properties.showCreateIncident = !kbViewModel.isInPopup && !data.params.sysparm_no_create_incident;\n\tdata.properties.createIncidentURL = getProperty('glide.knowman.create_incident_link', 'create_incident_link', '', false);\n\tdata.properties.isSubscriptionEnabled = kbViewModel.isSubscriptionEnabled;\n\n\n\tdata.properties.isEditable = kbViewModel.isEditable;\n\tdata.properties.showFeedBack = kbViewModel.showKBFeedback;\n\tdata.properties.showKBRatingOptions =\tkbViewModel.showKBRatingOptions;\n\n\tdata.properties.showKBHelpfullRating =\tkbViewModel.showKBHelpfullRating;\n\tdata.properties.showKBStarRating = kbViewModel.showKBStarRating;\n\n\tdata.properties.showKBCreateIncident =\tkbViewModel.showKBCreateIncident;// && !kbViewModel.isInPopup && !params.sysparm_no_create_incident;\n\tdata.properties.showKBFlagArticle = kbViewModel.showKBFlagArticle && !data.params.sysparm_no_suggest && !knowledgeRecord.disable_suggesting;\n\tdata.properties.showKBUpdateAction =\tkbViewModel.showKBUpdateAction;\n\t\n\tdata.properties.readOnlyPage = gs.getProperty('glide.knowman.contextual_search.show_read_only_article','false');\n}\nfunction getPolicyDetails(articleSysId){\n\tvar policyDetails = {};\n\tif(gs.nil(articleSysId))\n\t\treturn policyDetails;\n\n\tvar policyGR = new GlideRecord('sn_compliance_policy');\n\tpolicyGR.addQuery('kb_article', articleSysId);\n\tpolicyGR.setLimit(1);\n\tpolicyGR.query();\n\n\tif(policyGR.next()){\n\t\tpolicyDetails.number = policyGR.getDisplayValue('number');\n\t\tpolicyDetails.type = policyGR.getDisplayValue('type');\n\t\tpolicyDetails.name = policyGR.getDisplayValue('name');\n\t\tpolicyDetails.policy_category = policyGR.getDisplayValue('policy_category');\n\t\tpolicyDetails.grading_level = policyGR.getDisplayValue('u_graderingsniv');\n\t\tpolicyDetails.valid_from = policyGR.getDisplayValue('valid_from');\n\t\tpolicyDetails.approvers = policyGR.getDisplayValue('approvers');\n\t\tpolicyDetails.owner = policyGR.getDisplayValue('owner');\n\t\tpolicyDetails.state = policyGR.getDisplayValue('state');\n\t\tvar articleVersion = policyGR.getDisplayValue('kb_article.version');\n\t\tif(gs.nil(articleVersion) && knowledgeRecord)\n\t\t\tarticleVersion = knowledgeRecord.getDisplayValue('version');\n\t\tpolicyDetails.article_version = articleVersion;\n\t}\n\n\treturn policyDetails;\n}\n\nfunction getLogoDataUrl(kbRecord){\n\tvar logoDataUrl = '';\n\ttry{\n\t\tvar gsa = new GlideSysAttachment();\n\t\tvar encoder = GlideStringUtil;\n\n\t\t// Prefer the knowledge base icon from the current knowledge record\n\t\tif(kbRecord && kbRecord.kb_knowledge_base){\n\t\t\tvar kbBase = kbRecord.kb_knowledge_base;\n\t\t\tvar iconId = kbBase.icon + '';\n\t\t\tif(!gs.nil(iconId)){\n\t\t\t\t// Try reading the icon as bytes\n\t\t\t\tvar iconBytes = gsa.getBytes(iconId);\n\t\t\t\tif(iconBytes){\n\t\t\t\t\tlogoDataUrl = 'data:image/png;base64,' + encoder.base64Encode(iconBytes);\n\t\t\t\t}\n\t\t\t\t// Fallback to direct attachment URL\n\t\t\t\tif(!logoDataUrl){\n\t\t\t\t\tlogoDataUrl = '/sys_attachment.do?sys_id=' + iconId;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback: look up the policy and dot-walk to its knowledge base icon\n\t\tif(!logoDataUrl && kbRecord){\n\t\t\tvar policy = new GlideRecord('sn_compliance_policy');\n\t\t\tpolicy.addQuery('kb_article', kbRecord.sys_id);\n\t\t\tpolicy.setLimit(1);\n\t\t\tpolicy.query();\n\t\t\tif(policy.next() && policy.kb_knowledge_base){\n\t\t\t\tvar fallbackIconId = policy.kb_knowledge_base.icon + '';\n\t\t\t\tif(!gs.nil(fallbackIconId)){\n\t\t\t\t\tvar fallbackBytes = gsa.getBytes(fallbackIconId);\n\t\t\t\t\tif(fallbackBytes){\n\t\t\t\t\t\tlogoDataUrl = 'data:image/png;base64,' + encoder.base64Encode(fallbackBytes);\n\t\t\t\t\t}\n\t\t\t\t\tif(!logoDataUrl){\n\t\t\t\t\t\tlogoDataUrl = '/sys_attachment.do?sys_id=' + fallbackIconId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// No db_image fallback; rely on base64/icon or client-side inline fallback\n\t}catch(e){\n\t\t// ignore logo load failures to keep print working\n\t}\n\treturn logoDataUrl;\n}\nfunction getProperty(propertyName, optionName, defaultValue, checkRoles){\n\tvar optionVal = options[optionName];\n\tif(!optionVal || optionVal === 'use_system' || !(optionVal === 'yes' || optionVal === 'no') ){\n\t\tvar propValue = gs.getProperty(propertyName, defaultValue);\n\t\tif(propValue && checkRoles){\n\t\t\tvar roles = gs.getProperty(propertyName + '.roles');\n\t\t\tif (roles != null && roles != ''){\n\t\t\t\tpropValue = gs.hasRole(roles);\n\t\t\t}\n\t\t}\n\t\treturn propValue;\n\t}\n\telse {\n\t\treturn optionVal === 'yes' ? true : false;\n\t}\n}\n\nfunction populateCommonProperties(){\n\tdata.isMobileView = ($sp.getParameter('sysparm_device') != \"\" && $sp.getParameter('sysparm_device') == \"mobile\");\n\tdata.isKBLanguagesNewUI = GlidePluginManager.isActive('com.glideapp.knowledge.i18n2');\n\tif(data.isKBLanguagesNewUI){\n\t\tdata.langList = kbViewModel.getLanguagesToDisplay(knowledgeRecord);\n\t}\n}\n\nfunction populateDataForCrawler(){\n\tdata.isValid = true;\n\tdata.article_sys_id = knowledgeRecord.sys_id + '';\n\tdata.kbContentData = kbViewModel.getArticleViewData();//.getArticleContentBySysId(data.article_sys_id);\n\tdata.number = knowledgeRecord.number + '';\n\tdata.articleType = knowledgeRecord.article_type + '';\n\tdata.attachments = kbViewModel.attachments;\n\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\tdata.authorUserName = knowledgeRecord.getDisplayValue('author.user_name');\n\tdata.authorDepartment = knowledgeRecord.getDisplayValue('author.department');\n\tdata.authorEmail = knowledgeRecord.getDisplayValue('author.email');\n\tdata.policyInfo = getPolicyDetails(knowledgeRecord.sys_id + '');\n\tdata.logoDataUrl = getLogoDataUrl(knowledgeRecord);\n\tdata.displayAttachments = knowledgeRecord.display_attachments + '';\n\tdata.kbSysId = knowledgeRecord.kb_knowledge_base.sys_id + '';\n\tdata.hasComments = false;\n\tdata.tableName = knowledgeRecord.sys_class_name + '';\n}\n\nfunction populateDataFromKBViewModel(){\n\tdata.isValid = true;\n\tdata.isLoggedInUser = gs.getSession().isLoggedIn();\n\tdata.canContributeToKnowledge = kbViewModel.canContributeToKnowledgeBase; //canContributeHelper.canContribute(kbViewModel.knowledgeRecord);\n\tdata.article_sys_id = knowledgeRecord.sys_id + '';\n\tdata.authorTitle = kbViewModel.authorTitle || kbViewModel.getAuthorInfo(\"author.title\");\n\tdata.authorUserName = knowledgeRecord.getDisplayValue('author.user_name');\n\tdata.authorDepartment = knowledgeRecord.getDisplayValue('author.department');\n\tdata.authorEmail = knowledgeRecord.getDisplayValue('author.email');\n\tdata.policyInfo = getPolicyDetails(knowledgeRecord.sys_id + '');\n\tdata.logoDataUrl = getLogoDataUrl(knowledgeRecord);\n\tdata.kbContentData = kbViewModel.getArticleViewData();\n\tdata.avgRating = Math.round(knowledgeRecord.rating);\n\tdata.number = knowledgeRecord.number + '';\n\tdata.articleType = knowledgeRecord.article_type + '';\n\tdata.permalink = kbViewModel.permalink;\n\tdata.category = knowledgeRecord.category;\n\tdata.attachments = kbViewModel.attachments;\n\tdata.shortDesc = knowledgeRecord.short_description.getDisplayValue() + \"\";\n\tdata.viewCount = knowledgeRecord.getDisplayValue('sys_view_count');\n\tdata.displayAttachments = knowledgeRecord.display_attachments + '';\n\tdata.tableName = knowledgeRecord.sys_class_name + '';\n\tdata.disableSuggesting = knowledgeRecord.disable_suggesting;\n\tdata.revisionString = kbViewModel.revisionString;\n\tdata.articleTemplate = kbViewModel.articleTemplateName;\n\tdata.isSubscriptionEnabled = kbViewModel.isSubscriptionEnabled;\n\tdata.helpfulContent = kbViewModel.helpfulText;\n\tif(data.isSubscriptionEnabled === true && !isMESP){\n\t\tdata.isArticleSubscribed = (new global.ActivitySubscriptionContext().getSubscriptionService().isSubscribed(knowledgeRecord.sys_id).subscriptionId) ? true : false;//kbViewModel.isArticleSubscribed;\n\t\tdata.isArticleSubscribedAtKB = (new global.ActivitySubscriptionContext().getSubscriptionService().isSubscribed(knowledgeRecord.kb_knowledge_base).subscriptionId) ? true : false;//kbViewModel.isArticleSubsrcibedAtKB;\n\t}\n\telse{\n\t\tdata.isArticleSubscribed = false;\n\t\tdata.isArticleSubscribedAtKB = false;\n\t}\n\n\tdata.kbSysId = knowledgeRecord.kb_knowledge_base.sys_id + '';\n\tdata.kbName = knowledgeRecord.kb_knowledge_base.getDisplayValue() + '';\n\tdata.externalArticle = kbViewModel.externalArticle;\n\tdata.hasComments = !kbViewModel.feedbackEntryInitialDisplay;\n\tdata.isTaskTable = data.params.sysparm_kb_search_table ? kbViewModel.isTaskTable(data.params.sysparm_kb_search_table) : false;\n\tdata.kbDocSysId = kbViewModel.kbDocSysId;\n\tdata.wordOnlineUrl = kbViewModel.wordOnlineUrl;\n\n}\n\nfunction populateBreadCrumbs(){\n\tvar breadCrumb = kbViewModel.getBreadcrumb();\n\tdata.breadCrumb = [];\n\tdata.breadCrumb.push({label: knowledgeRecord.kb_knowledge_base.title + ' (' + data.messages.KNOWLEDGE_BASE + ')', type: 'kb_knowledge_base', values: {kb_knowledge_base: knowledgeRecord.kb_knowledge_base.sys_id + ''}});\n\tvar ctg = '';\n\tfor(var i = 0; i < breadCrumb.length; i++){\n\t\tctg += breadCrumb[i].name;\n\t\tif(i != breadCrumb.length - 1){\n\t\t\tctg += ' - ';\n\t\t}\n\t}\n\tif(ctg !== '' && breadCrumb && breadCrumb.length > 0){\n\t\tdata.breadCrumb.push({label: ctg + '', type: 'kb_category', values: {kb_knowledge_base: breadCrumb[breadCrumb.length - 1].knowledge_base + '', kb_category:  breadCrumb[breadCrumb.length - 1].value + ''}});\n\t}\n}\n\nfunction handleViewCountIncrement(){\n\tvar incrementedViewCount = new global.KBViewModel().incrementAndReturnKBView(knowledgeRecord);\n\tif(incrementedViewCount)\n\t\tdata.viewCount = parseInt(incrementedViewCount);\n}\n\nfunction initGlideWiki(){\n\ttry{\n\t\tdata.kbWiki = kbViewModel.getWikiContent();\n\t}\n\tcatch(e){\n\t\tdata.kbWiki = '';\n\t}\n}\n\nfunction populateAttachedTasks(){\n\tdata.attachedIncidents = [];\n\tdata.attachedIncidents = kbViewModel.getAttachedTasks();\n}\n\nfunction populateAffectedProducts(){\n\tdata.affectedProducts = [];\n\tdata.affectedProducts = kbViewModel.getAffectedProducts();\n}\n\nfunction populateVersionInfo(){\n\tdata.isVersioningEnabled = kbViewModel.versioningInfo.isEnabled;\n\tdata.versionList = kbViewModel.versioningInfo.history;\n\tdata.version = knowledgeRecord.getDisplayValue('version');\n\tdata.isLatestVersion = !(kbViewModel.versioningInfo.newVersionAvailable === true);\n\tdata.workflowState = (knowledgeRecord.workflow_state != 'published') ? ('(' + knowledgeRecord.workflow_state.getDisplayValue() + ')') : '';\n\tdata.versionInfo = kbViewModel.versioningInfo.versionDisplay;//((kbViewModel.versioningInfo.newVersionAvailable === true) ? 'v' + data.version  : data.messages.LATEST_VERSION);\n\tdata.versionInfoLabel = kbViewModel.versioningInfo.versionDisplayLabel;\n\tdata.showHistory = kbViewModel.versioningInfo.showHistory;\n\tdata.hideFeedbackOptions = kbViewModel.hideFeedbackOptions;\n\tdata.versionWarningMessage = kbViewModel.versioningInfo.warningMessage;\n\tif(data.versionWarningMessage){\n\t\tdata.versionWarningMessage = data.versionWarningMessage.replace('kb_view.do?', '?id='+data.params.sysparm_article_view_page_id+'&');\n\t}\n}\n\n\nfunction populateContributorInfo(){\n\tif(!GlidePluginManager.isActive('com.sn_communities')) return;\n\tif(sn_communities.CommunityKnowledgeHarvest){\n\t\tvar h = new sn_communities.CommunityKnowledgeHarvest();\n\t\tvar res = h.getHarvestedContentInfo(''+knowledgeRecord.sys_id);\n\t\tif(res && res.status == 200){\n\t\t\tdata.hInfo = res.data;\n\t\t\tif(data.hInfo){\n\t\t\t\tvar message = gs.getMessage(\"Created from the Community by {0}\");\n\t\t\t\tvar contributor = data.hInfo.contributor;\n\t\t\t\tvar profile = gs.getMessage('Community user');\n\t\t\t\tif(contributor){\n\t\t\t\t\tprofile = contributor.name.length > 0 ? contributor.name : profile;\n\t\t\t\t\tif(contributor.userId)\n\t\t\t\t\t\tprofile = '<a href=\"?id=community_user_profile&user='+contributor.userId+'\" target=\"_blank_cm1\" >'+profile+'</a>';\n\t\t\t\t}\n\t\t\t\tmessage = message.replace('{0}', profile);\n\t\t\t\tdata.hInfo.profileMessage = message;\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nfunction getFeedbackReasonValues(){\n\tdata.feedback_reasons=[];\n\tvar kbFbTask = new global.KBFeedbackTask();\n\tvar response = kbFbTask.getReasonValues();\n\tif(response){\n\t\tdata.feedback_reasons = new global.JSON().decode(response);\n\t}\n}\n\nfunction getPageTitle() {\n\n\tvar title = gs.getMessage(\"Knowledge Article View\");\n\n\tif (!gs.nil(data.article_sys_id)) // kb record found\n\t\ttitle = knowledgeRecord.kb_knowledge_base.getDisplayValue() + \" - \" + data.shortDesc; // kb name - kb short_desc\n\telse if (!gs.nil(data.params.sysparm_article_view_page_id)) {\n\t\t// kb record NOT found - fetching the kb_article_view portal page title\n\t\tvar kbPage = new GlideRecord('sp_page');\n\t\tkbPage.addQuery(\"id\",data.params.sysparm_article_view_page_id+\"\");\n\t\tkbPage.query();\n\t\tif(kbPage.next())\n\t\t\ttitle = kbPage.getValue('title');\n\t}\n\n\treturn title;\n}\n\nfunction getMetaTag() {\n\n\tvar content = '';\n\n\t// kb record found\n\tif (!gs.nil(data.article_sys_id)){\n\t\tcontent = knowledgeRecord.kb_knowledge_base.getDisplayValue() + \" - \"\n\t\t\t+ knowledgeRecord.kb_category.getDisplayValue() + \" - \"\n\t\t\t+ knowledgeRecord.meta_description.getDisplayValue();\n\t}\n\treturn content;\n}\n\nfunction isUserAllowedToViewAs(articleSysId, userId, extensionType){\n\treturn new KBPortalService().isUserAllowedToViewAs(userId, extensionType, articleSysId);\n}\n",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function($rootScope, $scope, $window, $timeout, spUtil, $sce, spModal, $uibModal, $location, cabrillo, snAnalytics) {\r\n    /* widget controller */\r\n    var c = this;\r\n    // Fallback inline logo for FFI text mark (Forsvarets forskningsinstitutt)\r\n    var fallbackLogoSvg =\r\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 520 120\" aria-label=\"FFI\">' +\r\n          '<rect width=\"380\" height=\"110\" fill=\"white\"/>' +\r\n          '<g fill=\"#111\" font-family=\"Arial, sans-serif\" font-weight=\"700\" font-size=\"72\">' +\r\n            '<text x=\"10\" y=\"78\">FFI</text>' +\r\n          '</g>' +\r\n          '<g fill=\"#111\" font-family=\"Arial, sans-serif\" font-size=\"36\">' +\r\n            '<text x=\"140\" y=\"54\">Forsvarets</text>' +\r\n            '<text x=\"140\" y=\"98\">forskningsinstitutt</text>' +\r\n          '</g>' +\r\n        '</svg>';\r\n    var fallbackLogoUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(fallbackLogoSvg);\r\n    c.logoFallbackSvg = fallbackLogoSvg;\r\n    c.logoFallbackUrl = fallbackLogoUrl;\r\n    if (c.data.redirect) {\r\n        var id = $location.search().sys_kb_id ? 'sys_kb_id' : 'sys_id';\r\n        if ($location.search()[id] && $location.search()[id] !== c.data.redirect) {\r\n            $location.state({\r\n                addSPA: true\r\n            });\r\n            $location.search('spa', 1);\r\n            $location.search(id, c.data.redirect);\r\n            $location.replace();\r\n        }\r\n    }\r\n\r\n    c.printArticle = function(myID) {\r\n        // Keep a copy of the current DOM so we can restore it later\r\n        var originalHTML = document.body.innerHTML;\r\n\r\n        // Grab the current article HTML\r\n        var articleElement = document.getElementById(myID);\r\n        if (!articleElement) {\r\n            // Fallback: if the element id is wrong, just do a normal print\r\n            window.print();\r\n            return;\r\n        }\r\n\r\n        var escapeHtml = function(value) {\r\n            if (value === undefined || value === null)\r\n                return '';\r\n            return String(value).replace(/[&<>\"']/g, function(char) {\r\n                return {\r\n                    '&': '&amp;',\r\n                    '<': '&lt;',\r\n                    '>': '&gt;',\r\n                    '\"': '&quot;',\r\n                    \"'\": '&#39;'\r\n                }[char];\r\n            });\r\n        };\r\n\r\n        var articleHTML = articleElement.innerHTML;\r\n        var policyDetails = c.data.policyInfo || {};\r\n        var policyNumber = escapeHtml(policyDetails.number || '');\r\n        var policyType = escapeHtml(policyDetails.type || '');\r\n        var policyName = escapeHtml(policyDetails.name || '');\r\n        var policyCategory = escapeHtml(policyDetails.policy_category || '');\r\n        var policyGradingLevel = escapeHtml(policyDetails.grading_level || '');\r\n        var policyValidFrom = escapeHtml(policyDetails.valid_from || '');\r\n        var policyApprovers = escapeHtml(policyDetails.approvers || '');\r\n        var policyOwner = escapeHtml(policyDetails.owner || '');\r\n        var policyState = escapeHtml(policyDetails.state || '');\r\n        var policyArticleVersion = escapeHtml(policyDetails.article_version || '');\r\n\r\n        // Simple text-only \"logo\" placeholder\r\n        var logoMarkup =\r\n            '<div style=\"display:flex; justify-content:center; align-items:center; width:100%; padding:10px 6px;\">' +\r\n                '<div style=\"display:flex; align-items:center;\">' +\r\n                    '<div style=\"font-family: \\'Segoe UI\\', \\'Helvetica Neue\\', Roboto, Arial, sans-serif; font-size:36px; font-weight:700; color:#1f1f1f; letter-spacing:0.18px; margin-right:10px;\">FFI</div>' +\r\n                    '<div style=\"display:flex; flex-direction:column; align-items:flex-start; text-align:left; font-family: \\'Segoe UI\\', \\'Helvetica Neue\\', Roboto, Arial, sans-serif; color:#1f1f1f; line-height:1.15;\">' +\r\n                        '<span style=\"font-size:14px; font-weight:400; padding:0; margin:0; letter-spacing:0.05px;\">Forsvarets</span>' +\r\n                        '<span style=\"font-size:14px; font-weight:400; padding:0; margin:0; letter-spacing:0.05px;\">forskningsinstitutt</span>' +\r\n                    '</div>' +\r\n                '</div>' +\r\n            '</div>';\r\n\r\n        var metadataHeaderHTML =\r\n            '<div style=\"font-family: Arial, sans-serif; font-size: 11px; color:#000; padding: 0 4px; box-sizing: border-box;\">' +\r\n            '<table style=\"width: 100%; border-collapse: collapse; border: 1px solid #000; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<tr style=\"height: 60px;\">' +\r\n            '<td style=\"width: 18%; min-width: 150px; border: 1px solid #000; text-align: center; vertical-align: middle; padding: 8px 8px; box-sizing: border-box;\">' +\r\n            logoMarkup +\r\n            '</td>' +\r\n            '<td colspan=\"3\" style=\"border: 1px solid #000; text-align: center; padding: 5px 10px; box-sizing: border-box;\">' +\r\n            '<div style=\"font-size: 11px; margin-bottom: 2px;\">' + (policyType || '&nbsp;') + '</div>' +\r\n            '<div style=\"font-size: 18px; font-weight: bold; margin-bottom: 2px; color:#003366;\">' + (policyName || '&nbsp;') + '</div>' +\r\n            '<div style=\"font-size: 11px;\">' + (policyCategory || '&nbsp;') + '</div>' +\r\n            '</td>' +\r\n            '</tr>' +\r\n            '<tr>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Dokument-ID:</strong> ' + (policyNumber || 'N/A') + '</div>' +\r\n            '<div><strong>Versjon:</strong> ' + (policyArticleVersion || 'N/A') + '</div>' +\r\n            '<div><strong>Status:</strong> ' + (policyState || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Dokumentansvarlig:</strong> ' + (policyOwner || 'N/A') + '</div>' +\r\n            '<div style=\"margin-top: 4px;\"><strong>Utarbeidet av:</strong> ' + (policyOwner || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Godkjent av:</strong> ' + (policyApprovers || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; width: 18%; box-sizing: border-box;\">' +\r\n            '<div><strong>Godkjent fra:</strong> ' + (policyValidFrom || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '</tr>' +\r\n            '</table>' +\r\n            '<div style=\"display: flex; justify-content: flex-end; color:#003366; font-size: 11px; margin: 0 4px 12px 4px;\">' +\r\n            '<span>Graderingsniv&aring;: ' + (policyGradingLevel || '&nbsp;') + '</span>' +\r\n            '</div>' +\r\n            '</div>';\r\n\r\n        // Build the printable document: metadata header + article content\r\n        document.body.innerHTML = metadataHeaderHTML + articleHTML;\r\n\r\n        // Remove elements you dont want in the PDF\r\n        document.querySelectorAll('.title-secondary-data, .transparent-button')\r\n            .forEach(function(el) {\r\n                el.parentNode && el.parentNode.removeChild(el);\r\n            });\r\n\r\n        // Wait for images (logo/attachments) to load before printing\r\n        var printed = false;\r\n        var restoreAndReload = function() {\r\n            if (printed)\r\n                return;\r\n            printed = true;\r\n            window.print();\r\n            document.body.innerHTML = originalHTML;\r\n            window.location.reload();\r\n        };\r\n\r\n        var imgs = Array.prototype.slice.call(document.querySelectorAll('img'));\r\n        if (imgs.length === 0) {\r\n            restoreAndReload();\r\n        } else {\r\n            var remaining = imgs.length;\r\n            var done = function() {\r\n                remaining--;\r\n                if (remaining <= 0)\r\n                    restoreAndReload();\r\n            };\r\n            imgs.forEach(function(img) {\r\n                if (img.complete && img.naturalWidth !== 0) {\r\n                    done();\r\n                } else {\r\n                    img.onload = done;\r\n                    img.onerror = done;\r\n                }\r\n            });\r\n            // Fallback: ensure print still happens even if an image never finishes\r\n            $timeout(restoreAndReload, 500);\r\n        }\r\n    };\r\n\r\n\r\n    if (c.data.replacementArticleId) {\r\n        var queryParameters = $location.search();\r\n        var articleIdentifier = queryParameters.hasOwnProperty('sys_kb_id') ? 'sys_kb_id' : queryParameters.hasOwnProperty('sysparm_article') ? 'sysparm_article' : 'sys_id';\r\n\r\n        if (queryParameters[articleIdentifier] !== c.data.replacementArticleId) {\r\n            $location.state({\r\n                addSPA: true\r\n            });\r\n            $location.search('spa', 1);\r\n            $location.search(articleIdentifier, c.data.replacementArticleId);\r\n            $location.replace();\r\n        }\r\n\r\n        if (c.data.page_title && c.data.page_title != $window.document.title) {\r\n            $window.document.title = c.data.page_title;\r\n        }\r\n    }\r\n\r\n    $window.onpopstate = function(e) {\r\n        if (e && e.state && e.state.addSPA) {\r\n            $location.search('spa', null);\r\n            $location.replace();\r\n        }\r\n    };\r\n\r\n    if (c.data.isValid) {\r\n        if (c.data.kbContentData && c.data.kbContentData.isTemplate) {\r\n            //alert(c.data.kbContentData.data);\r\n            c.data.kbContentData.data.forEach(function(field) {\r\n                if (field.type == 'html')\r\n                    field.content = $sce.trustAsHtml(field.content);\r\n                //alert(field.content);\r\n\r\n            });\r\n\r\n            if (c.data.articleType === 'wiki') {\r\n                c.data.kbWiki = $sce.trustAsHtml(c.data.kbWiki);\r\n                //alert(c.data.kbWiki);\r\n            }\r\n        } else if (c.data.articleType === 'wiki') {\r\n            c.data.kbWiki = $sce.trustAsHtml(c.data.kbWiki);\r\n            //alert(c.data.kbWiki);\r\n        } else {\r\n            c.data.kbContentData.data = $sce.trustAsHtml(c.data.kbContentData.data);\r\n            c.data.wordCount = c.data.kbContentData.data.toString().replace(/(<([^>]+)>)/ig, '').split(' ').length;\r\n        }\r\n    }\r\n\r\n    $scope.submitted = false;\r\n    c.flagMessage = null;\r\n    $timeout(function() {\r\n        $rootScope.$broadcast(\"sp.update.breadcrumbs\", $scope.data.breadCrumb);\r\n    });\r\n    $rootScope.properties = $scope.data.properties;\r\n    $rootScope.messages = $scope.data.messages;\r\n    $rootScope.isValid = c.data.isValid;\r\n    $rootScope.isKBAdmin = $scope.data.isKBAdmin;\r\n    $rootScope.isKBOwner = $scope.data.isKBOwner;\r\n    $rootScope.article_sys_id = $scope.data.article_sys_id;\r\n    $rootScope.attachments = $scope.data.attachments;\r\n    $rootScope.attachedIncidents = $scope.data.attachedIncidents;\r\n    $rootScope.affectedProducts = $scope.data.affectedProducts;\r\n    $rootScope.displayAttachments = $scope.data.displayAttachments;\r\n    $rootScope.hideFeedbackOptions = $scope.data.hideFeedbackOptions;\r\n    $rootScope.helpfulContent = $scope.data.helpfulContent;\r\n    $rootScope.tableName = $scope.data.tableName;\r\n    $rootScope.hasComments = $scope.data.hasComments;\r\n    $scope.data.isSubscribed = $scope.data.isArticleSubscribed || $scope.data.isArticleSubscribedAtKB;\r\n    $scope.data.subscribeLabel = ($scope.data.isSubscribed ? $scope.data.messages.SUBSCRIBED : $scope.data.messages.SUBSCRIBE);\r\n    c.createIncidentURL = c.options.create_task_url || ($scope.data.properties && $scope.data.properties.createIncidentURL);\r\n    c.createIncidentLabel = c.options.create_task_prompt || $scope.data.messages.CREATE_INCIDENT;\r\n    c.showCreateIncident = c.data.isLoggedInUser && c.options.show_create_incident_action != 'false' && c.data.properties && c.data.properties.showKBCreateIncident && c.createIncidentURL;\r\n    c.showFlagArticle = c.data.properties && c.data.properties.showKBFlagArticle && c.data.properties.showRatingOptions;\r\n    c.showMenu = c.data.properties && (c.showFlagArticle || c.data.properties.isEditable || c.showCreateIncident);\r\n    $rootScope.stackUrl = window.location.pathname + '?id=' + c.data.params.sysparm_article_view_page_id + '%26' + (c.data.params.sysparm_article ? 'sysparm_article=' + c.data.params.sysparm_article : 'sys_kb_id=' + c.data.params.sys_kb_id);\r\n    c.stackUrl = $rootScope.stackUrl;\r\n    c.flagMessage = '';\r\n    c.task = {};\r\n    c.imageInstance = '';\r\n    $scope.data.toggleSubscribed = ($scope.data.isSubscribed ? true : false);\r\n    c.reasons = c.data.feedback_reasons;\r\n    c.data.reason = '4';\r\n    c.imageInstance = '';\r\n    c.minImageHeight = parseInt(c.options.min_image_height) || 100;\r\n    c.minImageWidth = parseInt(c.options.min_image_width) || 185;\r\n    c.readOnly = false;\r\n    c.isMobile = spUtil.isMobile() || cabrillo.isNative();\r\n    c.isAgentApp = navigator.userAgent.indexOf('Agent') > -1;\r\n    c.editUrl = c.data.wordOnlineUrl || 'kb_knowledge.do?sys_id=' + c.data.article_sys_id + '&sysparm_stack=' + c.stackUrl;\r\n\r\n    //Use KB specific stylic for all portals unless rating style is set\r\n    c.KBRatingStyle = c.options.kb_rating_style;\r\n\r\n    if (c.data.langList && c.data.langList.length > 1) {\r\n        for (var lng in c.data.langList) {\r\n            if (c.data.langList[lng].selected == true) {\r\n                c.selectedLanguage = c.data.langList[lng];\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    var payload = {};\r\n    payload.name = \"View Knowledge Article\";\r\n    payload.data = {};\r\n    payload.data[\"Article Title\"] = c.data.shortDesc;\r\n    payload.data[\"Article SysID\"] = c.data.article_sys_id;\r\n    payload.data[\"Language\"] = c.selectedLanguage || \"en\";\r\n    snAnalytics.addEvent(payload);\r\n\r\n    populateBreadCrumbURLs();\r\n\r\n    function populateBreadCrumbURLs() {\r\n        if (c.data.breadCrumb) {\r\n            if (c.data.breadCrumb[0].type == 'kb_knowledge_base') {\r\n                if (c.data.showKbHomeLink && c.data.kb_knowledge_page != 'kb_search') {\r\n                    c.data.breadCrumb[0].url = '?id=' + c.data.kb_knowledge_page + '&kb_id=' + c.data.breadCrumb[0].values.kb_knowledge_base;\r\n                } else {\r\n                    c.data.breadCrumb[0].url = '?id=kb_search&kb_knowledge_base=' + c.data.breadCrumb[0].values.kb_knowledge_base;\r\n                }\r\n            }\r\n\r\n            for (var i = 1; i < c.data.breadCrumb.length; i++) {\r\n                if (c.data.breadCrumb[i].type == 'kb_category') {\r\n                    if (c.data.showKbHomeLink && c.data.kb_knowledge_page != 'kb_search') {\r\n                        if (c.data.breadCrumb[i].values.kb_category == \"NULL_VALUE\") {\r\n                            c.data.breadCrumb.splice(i, 1);\r\n                        } else {\r\n                            c.data.breadCrumb[i].url = '?id=kb_category&kb_id=' + c.data.breadCrumb[i].values.kb_knowledge_base + '&kb_category=' + c.data.breadCrumb[i].values.kb_category;\r\n                        }\r\n                    } else {\r\n                        c.data.breadCrumb[i].url = '?id=kb_search&kb_knowledge_base=' + c.data.breadCrumb[i].values.kb_knowledge_base + '&kb_category=' + c.data.breadCrumb[i].values.kb_category;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var shouldSetTitle = c.data.params.sysparm_language && (c.data.number != c.data.params.sysparm_article);\r\n    if (c.options.set_page_title != 'false' || shouldSetTitle) {\r\n        if (c.data.page_title) {\r\n            // setting default page title for supporting km seo\r\n            $window.document.title = c.data.page_title;\r\n            var metaTag = $('meta[custom-tag][name=\"description\"]')[0];\r\n\r\n            if (metaTag)\r\n                metaTag.content = c.data.meta_tag;\r\n        }\r\n    }\r\n\r\n    c.showVersions = false;\r\n    c.toggleVersions = function() {\r\n        c.showVersions = !c.showVersions;\r\n    };\r\n\r\n    c.selectLanguage = function(ind) {\r\n        var viewAsUser = \"\";\r\n\r\n        if (c.data.params.view_as_user.length > 0)\r\n            viewAsUser = \"&view_as_user=\" + c.data.params.view_as_user;\r\n\r\n        $window.location.replace('?id=' + c.data.params.sysparm_article_view_page_id + '&sys_kb_id=' + c.data.langList[ind].sys_id + viewAsUser);\r\n    };\r\n\r\n    c.showActionMenu = function() {\r\n        if (c.showMenu) {\r\n            return true;\r\n        } else {\r\n            if (c.data.properties && c.data.properties.isSubscriptionEnabled && $window.innerWidth < 992)\r\n                return true;\r\n            else\r\n                return false;\r\n        }\r\n    }\r\n\r\n    c.toggleSection = function(field) {\r\n        field.collapsed = !field.collapsed;\r\n        $('#' + field.column).slideToggle(\"fast\");\r\n    };\r\n\r\n    c.handleSubscribeButtonFocus = function() {\r\n        if ($scope.data.isSubscribed) {\r\n            $scope.data.subscribeLabel = $rootScope.messages.UNSUBSCRIBE;\r\n            $scope.data.toggleSubscribed = !$scope.data.toggleSubscribed;\r\n        }\r\n\r\n    };\r\n\r\n    c.handleSubscribeButtonBlur = function() {\r\n        if ($scope.data.isSubscribed) {\r\n            $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBED;\r\n            $scope.data.toggleSubscribed = !$scope.data.toggleSubscribed;\r\n        }\r\n    }\r\n    c.closeUnsubscribeModal = function() {\r\n        $(\"#unSubscribeModal\").modal('hide');\r\n    };\r\n\r\n    c.handleSubscription = function(confirmation) {\r\n        c.data.actionName = null;\r\n        if (!$scope.data.isSubscribed) {\r\n            c.data.actionName = 'subscribe';\r\n            c.data.articleSysId = $scope.data.article_sys_id;\r\n            c.data.articleNum = $scope.data.number;\r\n        } else {\r\n            if ($scope.data.isArticleSubscribed && !$scope.data.isArticleSubscribedAtKB) {\r\n                c.data.actionName = \"unsubscribe\";\r\n                c.data.articleSysId = $scope.data.article_sys_id;\r\n                c.data.articleNum = $scope.data.number;\r\n                c.data.unsubscribeKB = false;\r\n            } else if (!confirmation) {\r\n                //$(\"#unSubscribeModal\").modal();\r\n                var unsubscribeMessage = \"<p>\" + c.data.messages.UNSUBSCRIBE_CONTENT + \"</p><p><b>\" + c.data.messages.UNSUBSCRIBE_CONFIRMATION + \"</b></p>\";\r\n                spModal.open({\r\n                    title: c.data.messages.UNSUBSCRIBE,\r\n                    buttons: [{\r\n                        label: c.data.messages.NO,\r\n                        cancel: true\r\n                    }, {\r\n                        label: c.data.messages.YES,\r\n                        primary: true\r\n                    }],\r\n                    message: unsubscribeMessage\r\n                }).then(function() {\r\n                    c.handleSubscription('Y');\r\n                }, function() {\r\n                    c.closeUnsubscribeModal();\r\n                });\r\n\r\n                return;\r\n            } else if (confirmation === 'Y') {\r\n                c.data.actionName = \"unsubscribe\";\r\n                c.closeUnsubscribeModal();\r\n                c.data.articleSysId = $scope.data.article_sys_id;\r\n                c.data.kbSysId = $scope.data.kbSysId;\r\n                c.data.articleNum = $scope.data.number;\r\n                c.data.kbName = $scope.data.kbName;\r\n                c.data.unsubscribeKB = true;\r\n            }\r\n        }\r\n        c.server.get({\r\n            action: c.data.actionName,\r\n            kbSysId: c.data.kbSysId,\r\n            kbName: c.data.kbName,\r\n            articleSysId: c.data.articleSysId,\r\n            articleNum: c.data.articleNum,\r\n            unsubscribeKB: c.data.unsubscribeKB,\r\n            isArticleSubscribed: c.data.isArticleSubscribed,\r\n            isKBSubscribed: c.data.isArticleSubscribedAtKB\r\n        }).then(function(resp) {\r\n            if (c.data.actionName == 'subscribe') {\r\n                $scope.data.isArticleSubscribed = true;\r\n                $scope.data.isSubscribed = true;\r\n                $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBED;\r\n            } else {\r\n                $scope.data.isArticleSubscribed = false;\r\n                $scope.data.isSubscribed = false;\r\n                $scope.data.isArticleSubscribedAtKB = false;\r\n                $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBE;\r\n            }\r\n            c.showUIMessage('info', resp.data.responseMessage);\r\n\r\n        });\r\n    };\r\n\r\n\r\n\r\n    c.submitFlagComments = function() {\r\n        if (!c.data.comment) {\r\n            c.flagMessage = \"${Please provide a comment to flag the article}\";\r\n            $(\"#flagComment\").focus();\r\n            return false;\r\n        } else {\r\n            $(\"#submitFlagComment\").attr(\"disabled\", true);\r\n            c.server.get({\r\n                action: 'saveFlagComment',\r\n                article_sys_id: c.data.article_sys_id,\r\n                comment: c.data.comment\r\n            }).then(function(resp) {\r\n                if (resp.data.feedbackSuccess)\r\n                    c.showUIMessage('info', c.data.messages.ARTICLE_FLAGGED);\r\n                else\r\n                    c.showUIMessage('error', c.data.messages.RATE_LIMIT_REACHED);\r\n            });\r\n            c.clearComment();\r\n\r\n        }\r\n\r\n    };\r\n\r\n    c.copyPermalink = function() {\r\n        var v = document.createElement('textarea');\r\n        var permalink = document.location.origin + document.location.pathname + '?id=' + c.data.params.sysparm_article_view_page_id + '&sysparm_article=' + $scope.data.number;\r\n        v.innerHTML = permalink;\r\n        v.className = \"sr-only\";\r\n        document.body.appendChild(v);\r\n        v.select();\r\n        var result = true;\r\n        try {\r\n            result = document.execCommand('copy');\r\n        } catch (err) {\r\n            result = false;\r\n        } finally {\r\n            document.body.removeChild(v);\r\n        }\r\n        if (result === true) {\r\n            c.showUIMessage('info', c.data.messages.PERMALINK_COPIED);\r\n        } else {\r\n            $window.prompt(\"${Because of a browser limitation the URL can not be placed directly in the clipboard. Please use Ctrl-C to copy the data and escape to dismiss this dialog}\", permalink);\r\n        }\r\n        $('p.kb-permalink button').focus();\r\n    };\r\n    var modal = null;\r\n    c.launchFlagModal = function(e) {\r\n        c.clearComment();\r\n        var pageRoot = angular.element('.sp-page-root');\r\n        modal = $uibModal.open({\r\n            title: c.data.messages.FLAG_THIS_ARTICLE,\r\n            scope: $scope,\r\n            templateUrl: 'kb-flag-article-modal',\r\n            keyboard: true,\r\n            controller: function($scope) {\r\n                $scope.$on('modal.closing', function() {\r\n                    pageRoot.attr('aria-hidden', 'false');\r\n                    // Toggle dropdown if not already visible:\r\n                    if ($('.dropdown').find('.moreActionsMenuList').is(\":hidden\") && !$(\"#submitFlagComment\").attr(\"disabled\")) {\r\n                        $('.more-actions-menu').dropdown('toggle');\r\n                        //Give focus to the flagArticle \r\n                        $('#flagArticleButton').focus();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        modal.rendered.then(function() {\r\n            //hide the root page headings when modal is active\r\n            pageRoot.attr('aria-hidden', 'true');\r\n            $(\"#flagComment\").focus();\r\n\r\n        });\r\n        e.stopPropagation();\r\n    }\r\n\r\n    var taskPopUp = $rootScope.$on(\"sp.kb.feedback.openTaskPopup\", function(event, data) {\r\n        c.ftask = {};\r\n        if (data) {\r\n            c.launchFeedbackTaskModal();\r\n            c.ftask.feedback_action = data.feedback_data.action;\r\n            c.ftask.feedback_rating = data.feedback_data.rating\r\n            c.ftask.action = \"createFeedbackTask\";\r\n\r\n        }\r\n    });\r\n\r\n    c.launchFeedbackTaskModal = function() {\r\n        var pageRoot = angular.element('.sp-page-root');\r\n        c.clearFeedbackTask();\r\n        modal = $uibModal.open({\r\n            title: c.data.messages.FEEDBACK,\r\n            windowClass: 'app-modal-window',\r\n            scope: $scope,\r\n            templateUrl: 'kb-feedback-task-modal',\r\n            keyboard: true,\r\n            controller: function($scope) {\r\n                $scope.$on(\"modal.closing\", function() {\r\n                    pageRoot.attr('aria-hidden', 'false');\r\n                    $('#useful_no').focus();\r\n\r\n                    if (!c.submitted) {\r\n                        c.data.reason = \"4\";\r\n                        c.data.details = \"\";\r\n                    }\r\n                    if (c.ftask.action == \"createFeedbackTaskWithFlagComment\" && !c.submitted)\r\n                        return;\r\n                    modal = null;\r\n                    c.server.get({\r\n                        action: c.ftask.action,\r\n                        article_sys_id: c.data.article_sys_id,\r\n                        reason: c.data.reason,\r\n                        details: c.data.details,\r\n                        feedback_action: c.ftask.feedback_action,\r\n                        rating: c.ftask.feedback_rating\r\n                    }).then(function(resp) {\r\n                        if (resp.data.responseMessage) {\r\n                            if (resp.data.feedbackSuccess) {\r\n                                c.showUIMessage('info', resp.data.responseMessage);\r\n                            } else {\r\n                                c.showUIMessage('error', resp.data.responseMessage);\r\n                            }\r\n\r\n                        }\r\n                    });\r\n                    c.clearFeedbackTask();\r\n                });\r\n            }\r\n        });\r\n        modal.rendered.then(function() {\r\n            //hide the root page headings when modal is active\r\n            pageRoot.attr('aria-hidden', 'true');\r\n            $('.type-multiple_choice input[aria-checked=\"true\"]').focus();\r\n        });\r\n\r\n    }\r\n\r\n    c.clearComment = function(e) {\r\n        if (e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        $scope.data.comment = '';\r\n        c.flagMessage = '';\r\n        c.closePopup();\r\n    }\r\n\r\n    c.closeTaskPopup = function(e) {\r\n        if (e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        modal.dismiss({\r\n            $value: \"dismiss\"\r\n        });\r\n        $('#useful_no').focus();\r\n    }\r\n\r\n    c.selectReason = function(e, elem) {\r\n        // space keycode to select the radio button\r\n        if (e.keyCode == 32) {\r\n            $(\"div.type-multiple_choice\").find(\"input[type=radio]\").each(function() {\r\n                $(this).attr(\"checked\", false);\r\n                $(this).attr(\"aria-checked\", false);\r\n                $(this).find(\"input[type=radio]\").attr(\"checked\", false);\r\n                $(this).find(\"input[type=radio]\").attr(\"aria-checked\", false);\r\n            });\r\n            $(e.target).click();\r\n            $(e.target).find(\"input[type=radio]\").click();\r\n        }\r\n\r\n    }\r\n\r\n    c.showUIMessage = function(type, msg) {\r\n        if (cabrillo.isNative()) {\r\n            cabrillo.message.showMessage(type != 'error' ? cabrillo.message.SUCCESS_MESSAGE_STYLE : cabrillo.message.ERROR_MESSAGE_STYLE, msg);\r\n        } else {\r\n            if (type == 'error')\r\n                spUtil.addErrorMessage(msg);\r\n            else\r\n                spUtil.addInfoMessage(msg);\r\n        }\r\n    }\r\n\r\n    c.closePopup = function() {\r\n        if (modal) {\r\n            modal.dismiss();\r\n        }\r\n    }\r\n\r\n    c.clearFeedbackTask = function() {\r\n        c.submitted = false;\r\n        c.data.reason = '4';\r\n        c.data.details = '';\r\n        c.flagMessage = '';\r\n        c.ftask = {};\r\n        c.closePopup();\r\n    }\r\n\r\n    c.submitFeedbackTask = function() {\r\n        if (!c.data.reason) {\r\n            c.flagMessage = \"${Please provide the mandatory details}\";\r\n            $(\"#detailsComment\").focus();\r\n            return false;\r\n        } else {\r\n            c.submitted = true;\r\n            c.closePopup();\r\n        }\r\n    }\r\n\r\n    c.imgModalClose = function() {\r\n        c.imageInstance.close();\r\n    }\r\n\r\n    c.getLabelForTemplateField = function(label, isCollapsed) {\r\n        if (isCollapsed)\r\n            return label + \" \" + c.data.messages.COLLAPSED_FIELD;\r\n        else\r\n            return label + \" \" + c.data.messages.EXPANDED_FIELD;\r\n    }\r\n\r\n    $scope.$on(\"$destroy\", taskPopUp);\r\n\r\n    $(\"#flagComment\").keydown(function(ev) {\r\n        if (ev.which == 13)\r\n            $(\"#flagComment\").click();\r\n    });\r\n\r\n    c.handleKeyDown = function(ev) {\r\n        if (ev.which == 13)\r\n            $(ev.target).click();\r\n    }\r\n\r\n    var favoriteEvent = $rootScope.$on('favorite', function(e, favorite) {\r\n        $scope.showFavorite = favorite.showFavorite;\r\n        $scope.isFavorite = favorite.isFavorite;\r\n    });\r\n    $scope.$on(\"$destroy\", favoriteEvent);\r\n\r\n    $scope.toggleFavorite = function($event) {\r\n        $event.preventDefault();\r\n        $event.stopPropagation();\r\n        $scope.$broadcast('toggleFavorite');\r\n    }\r\n\r\n}\r\n",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function($rootScope, $scope, $window, $timeout, spUtil, $sce, spModal, $uibModal, $location, cabrillo, snAnalytics) {\r\n    /* widget controller */\r\n    var c = this;\r\n    // Fallback inline logo for FFI text mark (Forsvarets forskningsinstitutt)\r\n    var fallbackLogoSvg =\r\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 520 120\" aria-label=\"FFI\">' +\r\n          '<rect width=\"380\" height=\"110\" fill=\"white\"/>' +\r\n          '<g fill=\"#111\" font-family=\"Arial, sans-serif\" font-weight=\"700\" font-size=\"72\">' +\r\n            '<text x=\"10\" y=\"78\">FFI</text>' +\r\n          '</g>' +\r\n          '<g fill=\"#111\" font-family=\"Arial, sans-serif\" font-size=\"36\">' +\r\n            '<text x=\"140\" y=\"54\">Forsvarets</text>' +\r\n            '<text x=\"140\" y=\"98\">forskningsinstitutt</text>' +\r\n          '</g>' +\r\n        '</svg>';\r\n    var fallbackLogoUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(fallbackLogoSvg);\r\n    c.logoFallbackSvg = fallbackLogoSvg;\r\n    c.logoFallbackUrl = fallbackLogoUrl;\r\n    if (c.data.redirect) {\r\n        var id = $location.search().sys_kb_id ? 'sys_kb_id' : 'sys_id';\r\n        if ($location.search()[id] && $location.search()[id] !== c.data.redirect) {\r\n            $location.state({\r\n                addSPA: true\r\n            });\r\n            $location.search('spa', 1);\r\n            $location.search(id, c.data.redirect);\r\n            $location.replace();\r\n        }\r\n    }\r\n\r\n    c.printArticle = function(myID) {\r\n        // Keep a copy of the current DOM so we can restore it later\r\n        var originalHTML = document.body.innerHTML;\r\n\r\n        // Grab the current article HTML\r\n        var articleElement = document.getElementById(myID);\r\n        if (!articleElement) {\r\n            // Fallback: if the element id is wrong, just do a normal print\r\n            window.print();\r\n            return;\r\n        }\r\n\r\n        var escapeHtml = function(value) {\r\n            if (value === undefined || value === null)\r\n                return '';\r\n            return String(value).replace(/[&<>\"']/g, function(char) {\r\n                return {\r\n                    '&': '&amp;',\r\n                    '<': '&lt;',\r\n                    '>': '&gt;',\r\n                    '\"': '&quot;',\r\n                    \"'\": '&#39;'\r\n                }[char];\r\n            });\r\n        };\r\n\r\n        var articleHTML = articleElement.innerHTML;\r\n        var policyDetails = c.data.policyInfo || {};\r\n        var policyNumber = escapeHtml(policyDetails.number || '');\r\n        var policyType = escapeHtml(policyDetails.type || '');\r\n        var policyName = escapeHtml(policyDetails.name || '');\r\n        var policyCategory = escapeHtml(policyDetails.policy_category || '');\r\n        var policyGradingLevel = escapeHtml(policyDetails.grading_level || '');\r\n        var policyValidFrom = escapeHtml(policyDetails.valid_from || '');\r\n        var policyApprovers = escapeHtml(policyDetails.approvers || '');\r\n        var policyOwner = escapeHtml(policyDetails.owner || '');\r\n        var policyState = escapeHtml(policyDetails.state || '');\r\n        var policyArticleVersion = escapeHtml(policyDetails.article_version || '');\r\n\r\n        // Simple text-only \"logo\" placeholder\r\n        var logoMarkup =\r\n            '<div style=\"display:flex; justify-content:center; align-items:center; width:100%; padding:10px 6px;\">' +\r\n                '<div style=\"display:flex; align-items:center;\">' +\r\n                    '<div style=\"font-family: \\'Segoe UI\\', \\'Helvetica Neue\\', Roboto, Arial, sans-serif; font-size:36px; font-weight:700; color:#1f1f1f; letter-spacing:0.18px; margin-right:10px;\">FFI</div>' +\r\n                    '<div style=\"display:flex; flex-direction:column; align-items:flex-start; text-align:left; font-family: \\'Segoe UI\\', \\'Helvetica Neue\\', Roboto, Arial, sans-serif; color:#1f1f1f; line-height:1.15;\">' +\r\n                        '<span style=\"font-size:14px; font-weight:400; padding:0; margin:0; letter-spacing:0.05px;\">Forsvarets</span>' +\r\n                        '<span style=\"font-size:14px; font-weight:400; padding:0; margin:0; letter-spacing:0.05px;\">forskningsinstitutt</span>' +\r\n                    '</div>' +\r\n                '</div>' +\r\n            '</div>';\r\n\r\n        var metadataHeaderHTML =\r\n            '<div style=\"font-family: Arial, sans-serif; font-size: 11px; color:#000; padding: 0 4px; box-sizing: border-box;\">' +\r\n            '<table style=\"width: 100%; border-collapse: collapse; border: 1px solid #000; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<tr style=\"height: 60px;\">' +\r\n            '<td style=\"width: 18%; min-width: 150px; border: 1px solid #000; text-align: center; vertical-align: middle; padding: 8px 8px; box-sizing: border-box;\">' +\r\n            logoMarkup +\r\n            '</td>' +\r\n            '<td colspan=\"3\" style=\"border: 1px solid #000; text-align: center; padding: 5px 10px; box-sizing: border-box;\">' +\r\n            '<div style=\"font-size: 11px; margin-bottom: 2px;\">' + (policyType || '&nbsp;') + '</div>' +\r\n            '<div style=\"font-size: 18px; font-weight: bold; margin-bottom: 2px; color:#003366;\">' + (policyName || '&nbsp;') + '</div>' +\r\n            '<div style=\"font-size: 11px;\">' + (policyCategory || '&nbsp;') + '</div>' +\r\n            '</td>' +\r\n            '</tr>' +\r\n            '<tr>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Dokument-ID:</strong> ' + (policyNumber || 'N/A') + '</div>' +\r\n            '<div><strong>Versjon:</strong> ' + (policyArticleVersion || 'N/A') + '</div>' +\r\n            '<div><strong>Status:</strong> ' + (policyState || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Dokumentansvarlig:</strong> ' + (policyOwner || 'N/A') + '</div>' +\r\n            '<div style=\"margin-top: 4px;\"><strong>Utarbeidet av:</strong> ' + (policyOwner || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; box-sizing: border-box;\">' +\r\n            '<div><strong>Godkjent av:</strong> ' + (policyApprovers || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '<td style=\"border: 1px solid #000; padding: 6px; font-size: 11px; width: 18%; box-sizing: border-box;\">' +\r\n            '<div><strong>Godkjent fra:</strong> ' + (policyValidFrom || 'N/A') + '</div>' +\r\n            '</td>' +\r\n            '</tr>' +\r\n            '</table>' +\r\n            '<div style=\"display: flex; justify-content: flex-end; color:#003366; font-size: 11px; margin: 0 4px 12px 4px;\">' +\r\n            '<span>Graderingsniv&aring;: ' + (policyGradingLevel || '&nbsp;') + '</span>' +\r\n            '</div>' +\r\n            '</div>';\r\n\r\n        // Build the printable document: metadata header + article content\r\n        document.body.innerHTML = metadataHeaderHTML + articleHTML;\r\n\r\n        // Remove elements you dont want in the PDF\r\n        document.querySelectorAll('.title-secondary-data, .transparent-button')\r\n            .forEach(function(el) {\r\n                el.parentNode && el.parentNode.removeChild(el);\r\n            });\r\n\r\n        // Wait for images (logo/attachments) to load before printing\r\n        var printed = false;\r\n        var restoreAndReload = function() {\r\n            if (printed)\r\n                return;\r\n            printed = true;\r\n            window.print();\r\n            document.body.innerHTML = originalHTML;\r\n            window.location.reload();\r\n        };\r\n\r\n        var imgs = Array.prototype.slice.call(document.querySelectorAll('img'));\r\n        if (imgs.length === 0) {\r\n            restoreAndReload();\r\n        } else {\r\n            var remaining = imgs.length;\r\n            var done = function() {\r\n                remaining--;\r\n                if (remaining <= 0)\r\n                    restoreAndReload();\r\n            };\r\n            imgs.forEach(function(img) {\r\n                if (img.complete && img.naturalWidth !== 0) {\r\n                    done();\r\n                } else {\r\n                    img.onload = done;\r\n                    img.onerror = done;\r\n                }\r\n            });\r\n            // Fallback: ensure print still happens even if an image never finishes\r\n            $timeout(restoreAndReload, 500);\r\n        }\r\n    };\r\n\r\n\r\n    if (c.data.replacementArticleId) {\r\n        var queryParameters = $location.search();\r\n        var articleIdentifier = queryParameters.hasOwnProperty('sys_kb_id') ? 'sys_kb_id' : queryParameters.hasOwnProperty('sysparm_article') ? 'sysparm_article' : 'sys_id';\r\n\r\n        if (queryParameters[articleIdentifier] !== c.data.replacementArticleId) {\r\n            $location.state({\r\n                addSPA: true\r\n            });\r\n            $location.search('spa', 1);\r\n            $location.search(articleIdentifier, c.data.replacementArticleId);\r\n            $location.replace();\r\n        }\r\n\r\n        if (c.data.page_title && c.data.page_title != $window.document.title) {\r\n            $window.document.title = c.data.page_title;\r\n        }\r\n    }\r\n\r\n    $window.onpopstate = function(e) {\r\n        if (e && e.state && e.state.addSPA) {\r\n            $location.search('spa', null);\r\n            $location.replace();\r\n        }\r\n    };\r\n\r\n    if (c.data.isValid) {\r\n        if (c.data.kbContentData && c.data.kbContentData.isTemplate) {\r\n            //alert(c.data.kbContentData.data);\r\n            c.data.kbContentData.data.forEach(function(field) {\r\n                if (field.type == 'html')\r\n                    field.content = $sce.trustAsHtml(field.content);\r\n                //alert(field.content);\r\n\r\n            });\r\n\r\n            if (c.data.articleType === 'wiki') {\r\n                c.data.kbWiki = $sce.trustAsHtml(c.data.kbWiki);\r\n                //alert(c.data.kbWiki);\r\n            }\r\n        } else if (c.data.articleType === 'wiki') {\r\n            c.data.kbWiki = $sce.trustAsHtml(c.data.kbWiki);\r\n            //alert(c.data.kbWiki);\r\n        } else {\r\n            c.data.kbContentData.data = $sce.trustAsHtml(c.data.kbContentData.data);\r\n            c.data.wordCount = c.data.kbContentData.data.toString().replace(/(<([^>]+)>)/ig, '').split(' ').length;\r\n        }\r\n    }\r\n\r\n    $scope.submitted = false;\r\n    c.flagMessage = null;\r\n    $timeout(function() {\r\n        $rootScope.$broadcast(\"sp.update.breadcrumbs\", $scope.data.breadCrumb);\r\n    });\r\n    $rootScope.properties = $scope.data.properties;\r\n    $rootScope.messages = $scope.data.messages;\r\n    $rootScope.isValid = c.data.isValid;\r\n    $rootScope.isKBAdmin = $scope.data.isKBAdmin;\r\n    $rootScope.isKBOwner = $scope.data.isKBOwner;\r\n    $rootScope.article_sys_id = $scope.data.article_sys_id;\r\n    $rootScope.attachments = $scope.data.attachments;\r\n    $rootScope.attachedIncidents = $scope.data.attachedIncidents;\r\n    $rootScope.affectedProducts = $scope.data.affectedProducts;\r\n    $rootScope.displayAttachments = $scope.data.displayAttachments;\r\n    $rootScope.hideFeedbackOptions = $scope.data.hideFeedbackOptions;\r\n    $rootScope.helpfulContent = $scope.data.helpfulContent;\r\n    $rootScope.tableName = $scope.data.tableName;\r\n    $rootScope.hasComments = $scope.data.hasComments;\r\n    $scope.data.isSubscribed = $scope.data.isArticleSubscribed || $scope.data.isArticleSubscribedAtKB;\r\n    $scope.data.subscribeLabel = ($scope.data.isSubscribed ? $scope.data.messages.SUBSCRIBED : $scope.data.messages.SUBSCRIBE);\r\n    c.createIncidentURL = c.options.create_task_url || ($scope.data.properties && $scope.data.properties.createIncidentURL);\r\n    c.createIncidentLabel = c.options.create_task_prompt || $scope.data.messages.CREATE_INCIDENT;\r\n    c.showCreateIncident = c.data.isLoggedInUser && c.options.show_create_incident_action != 'false' && c.data.properties && c.data.properties.showKBCreateIncident && c.createIncidentURL;\r\n    c.showFlagArticle = c.data.properties && c.data.properties.showKBFlagArticle && c.data.properties.showRatingOptions;\r\n    c.showMenu = c.data.properties && (c.showFlagArticle || c.data.properties.isEditable || c.showCreateIncident);\r\n    $rootScope.stackUrl = window.location.pathname + '?id=' + c.data.params.sysparm_article_view_page_id + '%26' + (c.data.params.sysparm_article ? 'sysparm_article=' + c.data.params.sysparm_article : 'sys_kb_id=' + c.data.params.sys_kb_id);\r\n    c.stackUrl = $rootScope.stackUrl;\r\n    c.flagMessage = '';\r\n    c.task = {};\r\n    c.imageInstance = '';\r\n    $scope.data.toggleSubscribed = ($scope.data.isSubscribed ? true : false);\r\n    c.reasons = c.data.feedback_reasons;\r\n    c.data.reason = '4';\r\n    c.imageInstance = '';\r\n    c.minImageHeight = parseInt(c.options.min_image_height) || 100;\r\n    c.minImageWidth = parseInt(c.options.min_image_width) || 185;\r\n    c.readOnly = false;\r\n    c.isMobile = spUtil.isMobile() || cabrillo.isNative();\r\n    c.isAgentApp = navigator.userAgent.indexOf('Agent') > -1;\r\n    c.editUrl = c.data.wordOnlineUrl || 'kb_knowledge.do?sys_id=' + c.data.article_sys_id + '&sysparm_stack=' + c.stackUrl;\r\n\r\n    //Use KB specific stylic for all portals unless rating style is set\r\n    c.KBRatingStyle = c.options.kb_rating_style;\r\n\r\n    if (c.data.langList && c.data.langList.length > 1) {\r\n        for (var lng in c.data.langList) {\r\n            if (c.data.langList[lng].selected == true) {\r\n                c.selectedLanguage = c.data.langList[lng];\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    var payload = {};\r\n    payload.name = \"View Knowledge Article\";\r\n    payload.data = {};\r\n    payload.data[\"Article Title\"] = c.data.shortDesc;\r\n    payload.data[\"Article SysID\"] = c.data.article_sys_id;\r\n    payload.data[\"Language\"] = c.selectedLanguage || \"en\";\r\n    snAnalytics.addEvent(payload);\r\n\r\n    populateBreadCrumbURLs();\r\n\r\n    function populateBreadCrumbURLs() {\r\n        if (c.data.breadCrumb) {\r\n            if (c.data.breadCrumb[0].type == 'kb_knowledge_base') {\r\n                if (c.data.showKbHomeLink && c.data.kb_knowledge_page != 'kb_search') {\r\n                    c.data.breadCrumb[0].url = '?id=' + c.data.kb_knowledge_page + '&kb_id=' + c.data.breadCrumb[0].values.kb_knowledge_base;\r\n                } else {\r\n                    c.data.breadCrumb[0].url = '?id=kb_search&kb_knowledge_base=' + c.data.breadCrumb[0].values.kb_knowledge_base;\r\n                }\r\n            }\r\n\r\n            for (var i = 1; i < c.data.breadCrumb.length; i++) {\r\n                if (c.data.breadCrumb[i].type == 'kb_category') {\r\n                    if (c.data.showKbHomeLink && c.data.kb_knowledge_page != 'kb_search') {\r\n                        if (c.data.breadCrumb[i].values.kb_category == \"NULL_VALUE\") {\r\n                            c.data.breadCrumb.splice(i, 1);\r\n                        } else {\r\n                            c.data.breadCrumb[i].url = '?id=kb_category&kb_id=' + c.data.breadCrumb[i].values.kb_knowledge_base + '&kb_category=' + c.data.breadCrumb[i].values.kb_category;\r\n                        }\r\n                    } else {\r\n                        c.data.breadCrumb[i].url = '?id=kb_search&kb_knowledge_base=' + c.data.breadCrumb[i].values.kb_knowledge_base + '&kb_category=' + c.data.breadCrumb[i].values.kb_category;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    var shouldSetTitle = c.data.params.sysparm_language && (c.data.number != c.data.params.sysparm_article);\r\n    if (c.options.set_page_title != 'false' || shouldSetTitle) {\r\n        if (c.data.page_title) {\r\n            // setting default page title for supporting km seo\r\n            $window.document.title = c.data.page_title;\r\n            var metaTag = $('meta[custom-tag][name=\"description\"]')[0];\r\n\r\n            if (metaTag)\r\n                metaTag.content = c.data.meta_tag;\r\n        }\r\n    }\r\n\r\n    c.showVersions = false;\r\n    c.toggleVersions = function() {\r\n        c.showVersions = !c.showVersions;\r\n    };\r\n\r\n    c.selectLanguage = function(ind) {\r\n        var viewAsUser = \"\";\r\n\r\n        if (c.data.params.view_as_user.length > 0)\r\n            viewAsUser = \"&view_as_user=\" + c.data.params.view_as_user;\r\n\r\n        $window.location.replace('?id=' + c.data.params.sysparm_article_view_page_id + '&sys_kb_id=' + c.data.langList[ind].sys_id + viewAsUser);\r\n    };\r\n\r\n    c.showActionMenu = function() {\r\n        if (c.showMenu) {\r\n            return true;\r\n        } else {\r\n            if (c.data.properties && c.data.properties.isSubscriptionEnabled && $window.innerWidth < 992)\r\n                return true;\r\n            else\r\n                return false;\r\n        }\r\n    }\r\n\r\n    c.toggleSection = function(field) {\r\n        field.collapsed = !field.collapsed;\r\n        $('#' + field.column).slideToggle(\"fast\");\r\n    };\r\n\r\n    c.handleSubscribeButtonFocus = function() {\r\n        if ($scope.data.isSubscribed) {\r\n            $scope.data.subscribeLabel = $rootScope.messages.UNSUBSCRIBE;\r\n            $scope.data.toggleSubscribed = !$scope.data.toggleSubscribed;\r\n        }\r\n\r\n    };\r\n\r\n    c.handleSubscribeButtonBlur = function() {\r\n        if ($scope.data.isSubscribed) {\r\n            $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBED;\r\n            $scope.data.toggleSubscribed = !$scope.data.toggleSubscribed;\r\n        }\r\n    }\r\n    c.closeUnsubscribeModal = function() {\r\n        $(\"#unSubscribeModal\").modal('hide');\r\n    };\r\n\r\n    c.handleSubscription = function(confirmation) {\r\n        c.data.actionName = null;\r\n        if (!$scope.data.isSubscribed) {\r\n            c.data.actionName = 'subscribe';\r\n            c.data.articleSysId = $scope.data.article_sys_id;\r\n            c.data.articleNum = $scope.data.number;\r\n        } else {\r\n            if ($scope.data.isArticleSubscribed && !$scope.data.isArticleSubscribedAtKB) {\r\n                c.data.actionName = \"unsubscribe\";\r\n                c.data.articleSysId = $scope.data.article_sys_id;\r\n                c.data.articleNum = $scope.data.number;\r\n                c.data.unsubscribeKB = false;\r\n            } else if (!confirmation) {\r\n                //$(\"#unSubscribeModal\").modal();\r\n                var unsubscribeMessage = \"<p>\" + c.data.messages.UNSUBSCRIBE_CONTENT + \"</p><p><b>\" + c.data.messages.UNSUBSCRIBE_CONFIRMATION + \"</b></p>\";\r\n                spModal.open({\r\n                    title: c.data.messages.UNSUBSCRIBE,\r\n                    buttons: [{\r\n                        label: c.data.messages.NO,\r\n                        cancel: true\r\n                    }, {\r\n                        label: c.data.messages.YES,\r\n                        primary: true\r\n                    }],\r\n                    message: unsubscribeMessage\r\n                }).then(function() {\r\n                    c.handleSubscription('Y');\r\n                }, function() {\r\n                    c.closeUnsubscribeModal();\r\n                });\r\n\r\n                return;\r\n            } else if (confirmation === 'Y') {\r\n                c.data.actionName = \"unsubscribe\";\r\n                c.closeUnsubscribeModal();\r\n                c.data.articleSysId = $scope.data.article_sys_id;\r\n                c.data.kbSysId = $scope.data.kbSysId;\r\n                c.data.articleNum = $scope.data.number;\r\n                c.data.kbName = $scope.data.kbName;\r\n                c.data.unsubscribeKB = true;\r\n            }\r\n        }\r\n        c.server.get({\r\n            action: c.data.actionName,\r\n            kbSysId: c.data.kbSysId,\r\n            kbName: c.data.kbName,\r\n            articleSysId: c.data.articleSysId,\r\n            articleNum: c.data.articleNum,\r\n            unsubscribeKB: c.data.unsubscribeKB,\r\n            isArticleSubscribed: c.data.isArticleSubscribed,\r\n            isKBSubscribed: c.data.isArticleSubscribedAtKB\r\n        }).then(function(resp) {\r\n            if (c.data.actionName == 'subscribe') {\r\n                $scope.data.isArticleSubscribed = true;\r\n                $scope.data.isSubscribed = true;\r\n                $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBED;\r\n            } else {\r\n                $scope.data.isArticleSubscribed = false;\r\n                $scope.data.isSubscribed = false;\r\n                $scope.data.isArticleSubscribedAtKB = false;\r\n                $scope.data.subscribeLabel = $rootScope.messages.SUBSCRIBE;\r\n            }\r\n            c.showUIMessage('info', resp.data.responseMessage);\r\n\r\n        });\r\n    };\r\n\r\n\r\n\r\n    c.submitFlagComments = function() {\r\n        if (!c.data.comment) {\r\n            c.flagMessage = \"${Please provide a comment to flag the article}\";\r\n            $(\"#flagComment\").focus();\r\n            return false;\r\n        } else {\r\n            $(\"#submitFlagComment\").attr(\"disabled\", true);\r\n            c.server.get({\r\n                action: 'saveFlagComment',\r\n                article_sys_id: c.data.article_sys_id,\r\n                comment: c.data.comment\r\n            }).then(function(resp) {\r\n                if (resp.data.feedbackSuccess)\r\n                    c.showUIMessage('info', c.data.messages.ARTICLE_FLAGGED);\r\n                else\r\n                    c.showUIMessage('error', c.data.messages.RATE_LIMIT_REACHED);\r\n            });\r\n            c.clearComment();\r\n\r\n        }\r\n\r\n    };\r\n\r\n    c.copyPermalink = function() {\r\n        var v = document.createElement('textarea');\r\n        var permalink = document.location.origin + document.location.pathname + '?id=' + c.data.params.sysparm_article_view_page_id + '&sysparm_article=' + $scope.data.number;\r\n        v.innerHTML = permalink;\r\n        v.className = \"sr-only\";\r\n        document.body.appendChild(v);\r\n        v.select();\r\n        var result = true;\r\n        try {\r\n            result = document.execCommand('copy');\r\n        } catch (err) {\r\n            result = false;\r\n        } finally {\r\n            document.body.removeChild(v);\r\n        }\r\n        if (result === true) {\r\n            c.showUIMessage('info', c.data.messages.PERMALINK_COPIED);\r\n        } else {\r\n            $window.prompt(\"${Because of a browser limitation the URL can not be placed directly in the clipboard. Please use Ctrl-C to copy the data and escape to dismiss this dialog}\", permalink);\r\n        }\r\n        $('p.kb-permalink button').focus();\r\n    };\r\n    var modal = null;\r\n    c.launchFlagModal = function(e) {\r\n        c.clearComment();\r\n        var pageRoot = angular.element('.sp-page-root');\r\n        modal = $uibModal.open({\r\n            title: c.data.messages.FLAG_THIS_ARTICLE,\r\n            scope: $scope,\r\n            templateUrl: 'kb-flag-article-modal',\r\n            keyboard: true,\r\n            controller: function($scope) {\r\n                $scope.$on('modal.closing', function() {\r\n                    pageRoot.attr('aria-hidden', 'false');\r\n                    // Toggle dropdown if not already visible:\r\n                    if ($('.dropdown').find('.moreActionsMenuList').is(\":hidden\") && !$(\"#submitFlagComment\").attr(\"disabled\")) {\r\n                        $('.more-actions-menu').dropdown('toggle');\r\n                        //Give focus to the flagArticle \r\n                        $('#flagArticleButton').focus();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        modal.rendered.then(function() {\r\n            //hide the root page headings when modal is active\r\n            pageRoot.attr('aria-hidden', 'true');\r\n            $(\"#flagComment\").focus();\r\n\r\n        });\r\n        e.stopPropagation();\r\n    }\r\n\r\n    var taskPopUp = $rootScope.$on(\"sp.kb.feedback.openTaskPopup\", function(event, data) {\r\n        c.ftask = {};\r\n        if (data) {\r\n            c.launchFeedbackTaskModal();\r\n            c.ftask.feedback_action = data.feedback_data.action;\r\n            c.ftask.feedback_rating = data.feedback_data.rating\r\n            c.ftask.action = \"createFeedbackTask\";\r\n\r\n        }\r\n    });\r\n\r\n    c.launchFeedbackTaskModal = function() {\r\n        var pageRoot = angular.element('.sp-page-root');\r\n        c.clearFeedbackTask();\r\n        modal = $uibModal.open({\r\n            title: c.data.messages.FEEDBACK,\r\n            windowClass: 'app-modal-window',\r\n            scope: $scope,\r\n            templateUrl: 'kb-feedback-task-modal',\r\n            keyboard: true,\r\n            controller: function($scope) {\r\n                $scope.$on(\"modal.closing\", function() {\r\n                    pageRoot.attr('aria-hidden', 'false');\r\n                    $('#useful_no').focus();\r\n\r\n                    if (!c.submitted) {\r\n                        c.data.reason = \"4\";\r\n                        c.data.details = \"\";\r\n                    }\r\n                    if (c.ftask.action == \"createFeedbackTaskWithFlagComment\" && !c.submitted)\r\n                        return;\r\n                    modal = null;\r\n                    c.server.get({\r\n                        action: c.ftask.action,\r\n                        article_sys_id: c.data.article_sys_id,\r\n                        reason: c.data.reason,\r\n                        details: c.data.details,\r\n                        feedback_action: c.ftask.feedback_action,\r\n                        rating: c.ftask.feedback_rating\r\n                    }).then(function(resp) {\r\n                        if (resp.data.responseMessage) {\r\n                            if (resp.data.feedbackSuccess) {\r\n                                c.showUIMessage('info', resp.data.responseMessage);\r\n                            } else {\r\n                                c.showUIMessage('error', resp.data.responseMessage);\r\n                            }\r\n\r\n                        }\r\n                    });\r\n                    c.clearFeedbackTask();\r\n                });\r\n            }\r\n        });\r\n        modal.rendered.then(function() {\r\n            //hide the root page headings when modal is active\r\n            pageRoot.attr('aria-hidden', 'true');\r\n            $('.type-multiple_choice input[aria-checked=\"true\"]').focus();\r\n        });\r\n\r\n    }\r\n\r\n    c.clearComment = function(e) {\r\n        if (e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        $scope.data.comment = '';\r\n        c.flagMessage = '';\r\n        c.closePopup();\r\n    }\r\n\r\n    c.closeTaskPopup = function(e) {\r\n        if (e) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        modal.dismiss({\r\n            $value: \"dismiss\"\r\n        });\r\n        $('#useful_no').focus();\r\n    }\r\n\r\n    c.selectReason = function(e, elem) {\r\n        // space keycode to select the radio button\r\n        if (e.keyCode == 32) {\r\n            $(\"div.type-multiple_choice\").find(\"input[type=radio]\").each(function() {\r\n                $(this).attr(\"checked\", false);\r\n                $(this).attr(\"aria-checked\", false);\r\n                $(this).find(\"input[type=radio]\").attr(\"checked\", false);\r\n                $(this).find(\"input[type=radio]\").attr(\"aria-checked\", false);\r\n            });\r\n            $(e.target).click();\r\n            $(e.target).find(\"input[type=radio]\").click();\r\n        }\r\n\r\n    }\r\n\r\n    c.showUIMessage = function(type, msg) {\r\n        if (cabrillo.isNative()) {\r\n            cabrillo.message.showMessage(type != 'error' ? cabrillo.message.SUCCESS_MESSAGE_STYLE : cabrillo.message.ERROR_MESSAGE_STYLE, msg);\r\n        } else {\r\n            if (type == 'error')\r\n                spUtil.addErrorMessage(msg);\r\n            else\r\n                spUtil.addInfoMessage(msg);\r\n        }\r\n    }\r\n\r\n    c.closePopup = function() {\r\n        if (modal) {\r\n            modal.dismiss();\r\n        }\r\n    }\r\n\r\n    c.clearFeedbackTask = function() {\r\n        c.submitted = false;\r\n        c.data.reason = '4';\r\n        c.data.details = '';\r\n        c.flagMessage = '';\r\n        c.ftask = {};\r\n        c.closePopup();\r\n    }\r\n\r\n    c.submitFeedbackTask = function() {\r\n        if (!c.data.reason) {\r\n            c.flagMessage = \"${Please provide the mandatory details}\";\r\n            $(\"#detailsComment\").focus();\r\n            return false;\r\n        } else {\r\n            c.submitted = true;\r\n            c.closePopup();\r\n        }\r\n    }\r\n\r\n    c.imgModalClose = function() {\r\n        c.imageInstance.close();\r\n    }\r\n\r\n    c.getLabelForTemplateField = function(label, isCollapsed) {\r\n        if (isCollapsed)\r\n            return label + \" \" + c.data.messages.COLLAPSED_FIELD;\r\n        else\r\n            return label + \" \" + c.data.messages.EXPANDED_FIELD;\r\n    }\r\n\r\n    $scope.$on(\"$destroy\", taskPopUp);\r\n\r\n    $(\"#flagComment\").keydown(function(ev) {\r\n        if (ev.which == 13)\r\n            $(\"#flagComment\").click();\r\n    });\r\n\r\n    c.handleKeyDown = function(ev) {\r\n        if (ev.which == 13)\r\n            $(ev.target).click();\r\n    }\r\n\r\n    var favoriteEvent = $rootScope.$on('favorite', function(e, favorite) {\r\n        $scope.showFavorite = favorite.showFavorite;\r\n        $scope.isFavorite = favorite.isFavorite;\r\n    });\r\n    $scope.$on(\"$destroy\", favoriteEvent);\r\n\r\n    $scope.toggleFavorite = function($event) {\r\n        $event.preventDefault();\r\n        $event.stopPropagation();\r\n        $scope.$broadcast('toggleFavorite');\r\n    }\r\n\r\n}\r\n",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "Knowledge Article Content (word/print)",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {},
            "choice": 0,
            "value": "Knowledge Article Content (word/print)",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_store_app",
            "reference_type": "table",
            "displayValue": "Knowledge Management - Service Portal",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "bab6dea3db20320099f93691f0b8f590",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "kb-article-content-word-count",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "kb-article-content-word-count",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "color,css",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "color,css",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}